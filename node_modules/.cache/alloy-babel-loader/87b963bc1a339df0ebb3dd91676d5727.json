{"remainingRequest":"/Users/ssaddique/Axway/KitchenSink-v2-update/kitchensink-v2/node_modules/babel-loader/lib/index.js??ref--4-1!/Users/ssaddique/Axway/KitchenSink-v2-update/kitchensink-v2/node_modules/alloy-loader/lib/index.js??ref--4-2!/Users/ssaddique/Axway/KitchenSink-v2-update/kitchensink-v2/node_modules/imports-loader/index.js?define=>false!/Users/ssaddique/Axway/KitchenSink-v2-update/kitchensink-v2/node_modules/alloy/Alloy/lib/alloy/backbone/0.9.2/backbone.js","dependencies":[{"path":"/Users/ssaddique/Axway/KitchenSink-v2-update/kitchensink-v2/node_modules/alloy/Alloy/lib/alloy/backbone/0.9.2/backbone.js","mtime":499162500000},{"path":"/Users/ssaddique/Axway/KitchenSink-v2-update/kitchensink-v2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/ssaddique/Axway/KitchenSink-v2-update/kitchensink-v2/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/ssaddique/Axway/KitchenSink-v2-update/kitchensink-v2/node_modules/alloy-loader/lib/index.js","mtime":499162500000},{"path":"/Users/ssaddique/Axway/KitchenSink-v2-update/kitchensink-v2/node_modules/imports-loader/index.js","mtime":1519153988000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyoqKiBJTVBPUlRTIEZST00gaW1wb3J0cy1sb2FkZXIgKioqLwp2YXIgZGVmaW5lID0gZmFsc2U7IC8vICAgICBCYWNrYm9uZS5qcyAwLjkuMgovLyAgICAgKGMpIDIwMTAtMjAxMiBKZXJlbXkgQXNoa2VuYXMsIERvY3VtZW50Q2xvdWQgSW5jLgovLyAgICAgQmFja2JvbmUgbWF5IGJlIGZyZWVseSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCi8vICAgICBGb3IgYWxsIGRldGFpbHMgYW5kIGRvY3VtZW50YXRpb246Ci8vICAgICBodHRwOi8vYmFja2JvbmVqcy5vcmcKCihmdW5jdGlvbiAoKSB7CiAgLy8gSW5pdGlhbCBTZXR1cAogIC8vIC0tLS0tLS0tLS0tLS0KICAvLyBTYXZlIGEgcmVmZXJlbmNlIHRvIHRoZSBnbG9iYWwgb2JqZWN0IChgd2luZG93YCBpbiB0aGUgYnJvd3NlciwgYGdsb2JhbGAKICAvLyBvbiB0aGUgc2VydmVyKS4KICB2YXIgcm9vdCA9IHRoaXM7IC8vIFNhdmUgdGhlIHByZXZpb3VzIHZhbHVlIG9mIHRoZSBgQmFja2JvbmVgIHZhcmlhYmxlLCBzbyB0aGF0IGl0IGNhbiBiZQogIC8vIHJlc3RvcmVkIGxhdGVyIG9uLCBpZiBgbm9Db25mbGljdGAgaXMgdXNlZC4KCiAgdmFyIHByZXZpb3VzQmFja2JvbmUgPSByb290LkJhY2tib25lOyAvLyBDcmVhdGUgYSBsb2NhbCByZWZlcmVuY2UgdG8gc2xpY2Uvc3BsaWNlLgoKICB2YXIgc2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7CiAgdmFyIHNwbGljZSA9IEFycmF5LnByb3RvdHlwZS5zcGxpY2U7IC8vIFRoZSB0b3AtbGV2ZWwgbmFtZXNwYWNlLiBBbGwgcHVibGljIEJhY2tib25lIGNsYXNzZXMgYW5kIG1vZHVsZXMgd2lsbAogIC8vIGJlIGF0dGFjaGVkIHRvIHRoaXMuIEV4cG9ydGVkIGZvciBib3RoIENvbW1vbkpTIGFuZCB0aGUgYnJvd3Nlci4KCiAgdmFyIEJhY2tib25lOwoKICBpZiAodHlwZW9mIGV4cG9ydHMgIT09ICd1bmRlZmluZWQnKSB7CiAgICBCYWNrYm9uZSA9IGV4cG9ydHM7CiAgfSBlbHNlIHsKICAgIEJhY2tib25lID0gcm9vdC5CYWNrYm9uZSA9IHt9OwogIH0gLy8gQ3VycmVudCB2ZXJzaW9uIG9mIHRoZSBsaWJyYXJ5LiBLZWVwIGluIHN5bmMgd2l0aCBgcGFja2FnZS5qc29uYC4KCgogIEJhY2tib25lLlZFUlNJT04gPSAnMC45LjInOyAvLyBSZXF1aXJlIFVuZGVyc2NvcmUsIGlmIHdlJ3JlIG9uIHRoZSBzZXJ2ZXIsIGFuZCBpdCdzIG5vdCBhbHJlYWR5IHByZXNlbnQuCgogIHZhciBfID0gcm9vdC5fOwogIGlmICghXyAmJiB0eXBlb2YgcmVxdWlyZSAhPT0gJ3VuZGVmaW5lZCcpIF8gPSByZXF1aXJlKCcvYWxsb3kvdW5kZXJzY29yZScpOyAvLyBGb3IgQmFja2JvbmUncyBwdXJwb3NlcywgalF1ZXJ5LCBaZXB0bywgb3IgRW5kZXIgb3ducyB0aGUgYCRgIHZhcmlhYmxlLgoKICB2YXIgJCA9IHJvb3QualF1ZXJ5IHx8IHJvb3QuWmVwdG8gfHwgcm9vdC5lbmRlcjsgLy8gU2V0IHRoZSBKYXZhU2NyaXB0IGxpYnJhcnkgdGhhdCB3aWxsIGJlIHVzZWQgZm9yIERPTSBtYW5pcHVsYXRpb24gYW5kCiAgLy8gQWpheCBjYWxscyAoYS5rLmEuIHRoZSBgJGAgdmFyaWFibGUpLiBCeSBkZWZhdWx0IEJhY2tib25lIHdpbGwgdXNlOiBqUXVlcnksCiAgLy8gWmVwdG8sIG9yIEVuZGVyOyBidXQgdGhlIGBzZXREb21MaWJyYXJ5KClgIG1ldGhvZCBsZXRzIHlvdSBpbmplY3QgYW4KICAvLyBhbHRlcm5hdGUgSmF2YVNjcmlwdCBsaWJyYXJ5IChvciBhIG1vY2sgbGlicmFyeSBmb3IgdGVzdGluZyB5b3VyIHZpZXdzCiAgLy8gb3V0c2lkZSBvZiBhIGJyb3dzZXIpLgoKICBCYWNrYm9uZS5zZXREb21MaWJyYXJ5ID0gZnVuY3Rpb24gKGxpYikgewogICAgJCA9IGxpYjsKICB9OyAvLyBSdW5zIEJhY2tib25lLmpzIGluICpub0NvbmZsaWN0KiBtb2RlLCByZXR1cm5pbmcgdGhlIGBCYWNrYm9uZWAgdmFyaWFibGUKICAvLyB0byBpdHMgcHJldmlvdXMgb3duZXIuIFJldHVybnMgYSByZWZlcmVuY2UgdG8gdGhpcyBCYWNrYm9uZSBvYmplY3QuCgoKICBCYWNrYm9uZS5ub0NvbmZsaWN0ID0gZnVuY3Rpb24gKCkgewogICAgcm9vdC5CYWNrYm9uZSA9IHByZXZpb3VzQmFja2JvbmU7CiAgICByZXR1cm4gdGhpczsKICB9OyAvLyBUdXJuIG9uIGBlbXVsYXRlSFRUUGAgdG8gc3VwcG9ydCBsZWdhY3kgSFRUUCBzZXJ2ZXJzLiBTZXR0aW5nIHRoaXMgb3B0aW9uCiAgLy8gd2lsbCBmYWtlIGAiUFVUImAgYW5kIGAiREVMRVRFImAgcmVxdWVzdHMgdmlhIHRoZSBgX21ldGhvZGAgcGFyYW1ldGVyIGFuZAogIC8vIHNldCBhIGBYLUh0dHAtTWV0aG9kLU92ZXJyaWRlYCBoZWFkZXIuCgoKICBCYWNrYm9uZS5lbXVsYXRlSFRUUCA9IGZhbHNlOyAvLyBUdXJuIG9uIGBlbXVsYXRlSlNPTmAgdG8gc3VwcG9ydCBsZWdhY3kgc2VydmVycyB0aGF0IGNhbid0IGRlYWwgd2l0aCBkaXJlY3QKICAvLyBgYXBwbGljYXRpb24vanNvbmAgcmVxdWVzdHMgLi4uIHdpbGwgZW5jb2RlIHRoZSBib2R5IGFzCiAgLy8gYGFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZGAgaW5zdGVhZCBhbmQgd2lsbCBzZW5kIHRoZSBtb2RlbCBpbiBhCiAgLy8gZm9ybSBwYXJhbSBuYW1lZCBgbW9kZWxgLgoKICBCYWNrYm9uZS5lbXVsYXRlSlNPTiA9IGZhbHNlOyAvLyBCYWNrYm9uZS5FdmVudHMKICAvLyAtLS0tLS0tLS0tLS0tLS0tLQogIC8vIFJlZ3VsYXIgZXhwcmVzc2lvbiB1c2VkIHRvIHNwbGl0IGV2ZW50IHN0cmluZ3MKCiAgdmFyIGV2ZW50U3BsaXR0ZXIgPSAvXHMrLzsgLy8gQSBtb2R1bGUgdGhhdCBjYW4gYmUgbWl4ZWQgaW4gdG8gKmFueSBvYmplY3QqIGluIG9yZGVyIHRvIHByb3ZpZGUgaXQgd2l0aAogIC8vIGN1c3RvbSBldmVudHMuIFlvdSBtYXkgYmluZCB3aXRoIGBvbmAgb3IgcmVtb3ZlIHdpdGggYG9mZmAgY2FsbGJhY2sgZnVuY3Rpb25zCiAgLy8gdG8gYW4gZXZlbnQ7IHRyaWdnZXJgLWluZyBhbiBldmVudCBmaXJlcyBhbGwgY2FsbGJhY2tzIGluIHN1Y2Nlc3Npb24uCiAgLy8KICAvLyAgICAgdmFyIG9iamVjdCA9IHt9OwogIC8vICAgICBfLmV4dGVuZChvYmplY3QsIEJhY2tib25lLkV2ZW50cyk7CiAgLy8gICAgIG9iamVjdC5vbignZXhwYW5kJywgZnVuY3Rpb24oKXsgYWxlcnQoJ2V4cGFuZGVkJyk7IH0pOwogIC8vICAgICBvYmplY3QudHJpZ2dlcignZXhwYW5kJyk7CiAgLy8KCiAgdmFyIEV2ZW50cyA9IEJhY2tib25lLkV2ZW50cyA9IHsKICAgIC8vIEJpbmQgb25lIG9yIG1vcmUgc3BhY2Ugc2VwYXJhdGVkIGV2ZW50cywgYGV2ZW50c2AsIHRvIGEgYGNhbGxiYWNrYAogICAgLy8gZnVuY3Rpb24uIFBhc3NpbmcgYCJhbGwiYCB3aWxsIGJpbmQgdGhlIGNhbGxiYWNrIHRvIGFsbCBldmVudHMgZmlyZWQuCiAgICBvbjogZnVuY3Rpb24gKGV2ZW50cywgY2FsbGJhY2ssIGNvbnRleHQpIHsKICAgICAgdmFyIGNhbGxzLCBldmVudCwgbm9kZSwgdGFpbCwgbGlzdDsKICAgICAgaWYgKCFjYWxsYmFjaykgcmV0dXJuIHRoaXM7CiAgICAgIGV2ZW50cyA9IGV2ZW50cy5zcGxpdChldmVudFNwbGl0dGVyKTsKICAgICAgY2FsbHMgPSB0aGlzLl9jYWxsYmFja3MgfHwgKHRoaXMuX2NhbGxiYWNrcyA9IHt9KTsgLy8gQ3JlYXRlIGFuIGltbXV0YWJsZSBjYWxsYmFjayBsaXN0LCBhbGxvd2luZyB0cmF2ZXJzYWwgZHVyaW5nCiAgICAgIC8vIG1vZGlmaWNhdGlvbi4gIFRoZSB0YWlsIGlzIGFuIGVtcHR5IG9iamVjdCB0aGF0IHdpbGwgYWx3YXlzIGJlIHVzZWQKICAgICAgLy8gYXMgdGhlIG5leHQgbm9kZS4KCiAgICAgIHdoaWxlIChldmVudCA9IGV2ZW50cy5zaGlmdCgpKSB7CiAgICAgICAgbGlzdCA9IGNhbGxzW2V2ZW50XTsKICAgICAgICBub2RlID0gbGlzdCA/IGxpc3QudGFpbCA6IHt9OwogICAgICAgIG5vZGUubmV4dCA9IHRhaWwgPSB7fTsKICAgICAgICBub2RlLmNvbnRleHQgPSBjb250ZXh0OwogICAgICAgIG5vZGUuY2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgICBjYWxsc1tldmVudF0gPSB7CiAgICAgICAgICB0YWlsOiB0YWlsLAogICAgICAgICAgbmV4dDogbGlzdCA/IGxpc3QubmV4dCA6IG5vZGUKICAgICAgICB9OwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0sCiAgICAvLyBSZW1vdmUgb25lIG9yIG1hbnkgY2FsbGJhY2tzLiBJZiBgY29udGV4dGAgaXMgbnVsbCwgcmVtb3ZlcyBhbGwgY2FsbGJhY2tzCiAgICAvLyB3aXRoIHRoYXQgZnVuY3Rpb24uIElmIGBjYWxsYmFja2AgaXMgbnVsbCwgcmVtb3ZlcyBhbGwgY2FsbGJhY2tzIGZvciB0aGUKICAgIC8vIGV2ZW50LiBJZiBgZXZlbnRzYCBpcyBudWxsLCByZW1vdmVzIGFsbCBib3VuZCBjYWxsYmFja3MgZm9yIGFsbCBldmVudHMuCiAgICBvZmY6IGZ1bmN0aW9uIChldmVudHMsIGNhbGxiYWNrLCBjb250ZXh0KSB7CiAgICAgIHZhciBldmVudCwgY2FsbHMsIG5vZGUsIHRhaWwsIGNiLCBjdHg7IC8vIE5vIGV2ZW50cywgb3IgcmVtb3ZpbmcgKmFsbCogZXZlbnRzLgoKICAgICAgaWYgKCEoY2FsbHMgPSB0aGlzLl9jYWxsYmFja3MpKSByZXR1cm47CgogICAgICBpZiAoIShldmVudHMgfHwgY2FsbGJhY2sgfHwgY29udGV4dCkpIHsKICAgICAgICBkZWxldGUgdGhpcy5fY2FsbGJhY2tzOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9IC8vIExvb3AgdGhyb3VnaCB0aGUgbGlzdGVkIGV2ZW50cyBhbmQgY29udGV4dHMsIHNwbGljaW5nIHRoZW0gb3V0IG9mIHRoZQogICAgICAvLyBsaW5rZWQgbGlzdCBvZiBjYWxsYmFja3MgaWYgYXBwcm9wcmlhdGUuCgoKICAgICAgZXZlbnRzID0gZXZlbnRzID8gZXZlbnRzLnNwbGl0KGV2ZW50U3BsaXR0ZXIpIDogXy5rZXlzKGNhbGxzKTsKCiAgICAgIHdoaWxlIChldmVudCA9IGV2ZW50cy5zaGlmdCgpKSB7CiAgICAgICAgbm9kZSA9IGNhbGxzW2V2ZW50XTsKICAgICAgICBkZWxldGUgY2FsbHNbZXZlbnRdOwogICAgICAgIGlmICghbm9kZSB8fCAhKGNhbGxiYWNrIHx8IGNvbnRleHQpKSBjb250aW51ZTsgLy8gQ3JlYXRlIGEgbmV3IGxpc3QsIG9taXR0aW5nIHRoZSBpbmRpY2F0ZWQgY2FsbGJhY2tzLgoKICAgICAgICB0YWlsID0gbm9kZS50YWlsOwoKICAgICAgICB3aGlsZSAoKG5vZGUgPSBub2RlLm5leHQpICE9PSB0YWlsKSB7CiAgICAgICAgICBjYiA9IG5vZGUuY2FsbGJhY2s7CiAgICAgICAgICBjdHggPSBub2RlLmNvbnRleHQ7CgogICAgICAgICAgaWYgKGNhbGxiYWNrICYmIGNiICE9PSBjYWxsYmFjayB8fCBjb250ZXh0ICYmIGN0eCAhPT0gY29udGV4dCkgewogICAgICAgICAgICB0aGlzLm9uKGV2ZW50LCBjYiwgY3R4KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKICAgIC8vIFRyaWdnZXIgb25lIG9yIG1hbnkgZXZlbnRzLCBmaXJpbmcgYWxsIGJvdW5kIGNhbGxiYWNrcy4gQ2FsbGJhY2tzIGFyZQogICAgLy8gcGFzc2VkIHRoZSBzYW1lIGFyZ3VtZW50cyBhcyBgdHJpZ2dlcmAgaXMsIGFwYXJ0IGZyb20gdGhlIGV2ZW50IG5hbWUKICAgIC8vICh1bmxlc3MgeW91J3JlIGxpc3RlbmluZyBvbiBgImFsbCJgLCB3aGljaCB3aWxsIGNhdXNlIHlvdXIgY2FsbGJhY2sgdG8KICAgIC8vIHJlY2VpdmUgdGhlIHRydWUgbmFtZSBvZiB0aGUgZXZlbnQgYXMgdGhlIGZpcnN0IGFyZ3VtZW50KS4KICAgIHRyaWdnZXI6IGZ1bmN0aW9uIChldmVudHMpIHsKICAgICAgdmFyIGV2ZW50LCBub2RlLCBjYWxscywgdGFpbCwgYXJncywgYWxsLCByZXN0OwogICAgICBpZiAoIShjYWxscyA9IHRoaXMuX2NhbGxiYWNrcykpIHJldHVybiB0aGlzOwogICAgICBhbGwgPSBjYWxscy5hbGw7CiAgICAgIGV2ZW50cyA9IGV2ZW50cy5zcGxpdChldmVudFNwbGl0dGVyKTsKICAgICAgcmVzdCA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsgLy8gRm9yIGVhY2ggZXZlbnQsIHdhbGsgdGhyb3VnaCB0aGUgbGlua2VkIGxpc3Qgb2YgY2FsbGJhY2tzIHR3aWNlLAogICAgICAvLyBmaXJzdCB0byB0cmlnZ2VyIHRoZSBldmVudCwgdGhlbiB0byB0cmlnZ2VyIGFueSBgImFsbCJgIGNhbGxiYWNrcy4KCiAgICAgIHdoaWxlIChldmVudCA9IGV2ZW50cy5zaGlmdCgpKSB7CiAgICAgICAgaWYgKG5vZGUgPSBjYWxsc1tldmVudF0pIHsKICAgICAgICAgIHRhaWwgPSBub2RlLnRhaWw7CgogICAgICAgICAgd2hpbGUgKChub2RlID0gbm9kZS5uZXh0KSAhPT0gdGFpbCkgewogICAgICAgICAgICBub2RlLmNhbGxiYWNrLmFwcGx5KG5vZGUuY29udGV4dCB8fCB0aGlzLCByZXN0KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChub2RlID0gYWxsKSB7CiAgICAgICAgICB0YWlsID0gbm9kZS50YWlsOwogICAgICAgICAgYXJncyA9IFtldmVudF0uY29uY2F0KHJlc3QpOwoKICAgICAgICAgIHdoaWxlICgobm9kZSA9IG5vZGUubmV4dCkgIT09IHRhaWwpIHsKICAgICAgICAgICAgbm9kZS5jYWxsYmFjay5hcHBseShub2RlLmNvbnRleHQgfHwgdGhpcywgYXJncyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9OyAvLyBBbGlhc2VzIGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eS4KCiAgRXZlbnRzLmJpbmQgPSBFdmVudHMub247CiAgRXZlbnRzLnVuYmluZCA9IEV2ZW50cy5vZmY7IC8vIEJhY2tib25lLk1vZGVsCiAgLy8gLS0tLS0tLS0tLS0tLS0KICAvLyBDcmVhdGUgYSBuZXcgbW9kZWwsIHdpdGggZGVmaW5lZCBhdHRyaWJ1dGVzLiBBIGNsaWVudCBpZCAoYGNpZGApCiAgLy8gaXMgYXV0b21hdGljYWxseSBnZW5lcmF0ZWQgYW5kIGFzc2lnbmVkIGZvciB5b3UuCgogIHZhciBNb2RlbCA9IEJhY2tib25lLk1vZGVsID0gZnVuY3Rpb24gKGF0dHJpYnV0ZXMsIG9wdGlvbnMpIHsKICAgIHZhciBkZWZhdWx0czsKICAgIGF0dHJpYnV0ZXMgfHwgKGF0dHJpYnV0ZXMgPSB7fSk7CiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnBhcnNlKSBhdHRyaWJ1dGVzID0gdGhpcy5wYXJzZShhdHRyaWJ1dGVzKTsKCiAgICBpZiAoZGVmYXVsdHMgPSBnZXRWYWx1ZSh0aGlzLCAnZGVmYXVsdHMnKSkgewogICAgICBhdHRyaWJ1dGVzID0gXy5leHRlbmQoe30sIGRlZmF1bHRzLCBhdHRyaWJ1dGVzKTsKICAgIH0KCiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmNvbGxlY3Rpb24pIHRoaXMuY29sbGVjdGlvbiA9IG9wdGlvbnMuY29sbGVjdGlvbjsKICAgIHRoaXMuYXR0cmlidXRlcyA9IHt9OwogICAgdGhpcy5fZXNjYXBlZEF0dHJpYnV0ZXMgPSB7fTsKICAgIHRoaXMuY2lkID0gXy51bmlxdWVJZCgnYycpOwogICAgdGhpcy5jaGFuZ2VkID0ge307CiAgICB0aGlzLl9zaWxlbnQgPSB7fTsKICAgIHRoaXMuX3BlbmRpbmcgPSB7fTsKICAgIHRoaXMuc2V0KGF0dHJpYnV0ZXMsIHsKICAgICAgc2lsZW50OiB0cnVlCiAgICB9KTsgLy8gUmVzZXQgY2hhbmdlIHRyYWNraW5nLgoKICAgIHRoaXMuY2hhbmdlZCA9IHt9OwogICAgdGhpcy5fc2lsZW50ID0ge307CiAgICB0aGlzLl9wZW5kaW5nID0ge307CiAgICB0aGlzLl9wcmV2aW91c0F0dHJpYnV0ZXMgPSBfLmNsb25lKHRoaXMuYXR0cmlidXRlcyk7CiAgICB0aGlzLmluaXRpYWxpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9OyAvLyBBdHRhY2ggYWxsIGluaGVyaXRhYmxlIG1ldGhvZHMgdG8gdGhlIE1vZGVsIHByb3RvdHlwZS4KCgogIF8uZXh0ZW5kKE1vZGVsLnByb3RvdHlwZSwgRXZlbnRzLCB7CiAgICAvLyBBIGhhc2ggb2YgYXR0cmlidXRlcyB3aG9zZSBjdXJyZW50IGFuZCBwcmV2aW91cyB2YWx1ZSBkaWZmZXIuCiAgICBjaGFuZ2VkOiBudWxsLAogICAgLy8gQSBoYXNoIG9mIGF0dHJpYnV0ZXMgdGhhdCBoYXZlIHNpbGVudGx5IGNoYW5nZWQgc2luY2UgdGhlIGxhc3QgdGltZQogICAgLy8gYGNoYW5nZWAgd2FzIGNhbGxlZC4gIFdpbGwgYmVjb21lIHBlbmRpbmcgYXR0cmlidXRlcyBvbiB0aGUgbmV4dCBjYWxsLgogICAgX3NpbGVudDogbnVsbCwKICAgIC8vIEEgaGFzaCBvZiBhdHRyaWJ1dGVzIHRoYXQgaGF2ZSBjaGFuZ2VkIHNpbmNlIHRoZSBsYXN0IGAnY2hhbmdlJ2AgZXZlbnQKICAgIC8vIGJlZ2FuLgogICAgX3BlbmRpbmc6IG51bGwsCiAgICAvLyBUaGUgZGVmYXVsdCBuYW1lIGZvciB0aGUgSlNPTiBgaWRgIGF0dHJpYnV0ZSBpcyBgImlkImAuIE1vbmdvREIgYW5kCiAgICAvLyBDb3VjaERCIHVzZXJzIG1heSB3YW50IHRvIHNldCB0aGlzIHRvIGAiX2lkImAuCiAgICBpZEF0dHJpYnV0ZTogJ2lkJywKICAgIC8vIEluaXRpYWxpemUgaXMgYW4gZW1wdHkgZnVuY3Rpb24gYnkgZGVmYXVsdC4gT3ZlcnJpZGUgaXQgd2l0aCB5b3VyIG93bgogICAgLy8gaW5pdGlhbGl6YXRpb24gbG9naWMuCiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7fSwKICAgIC8vIFJldHVybiBhIGNvcHkgb2YgdGhlIG1vZGVsJ3MgYGF0dHJpYnV0ZXNgIG9iamVjdC4KICAgIHRvSlNPTjogZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIF8uY2xvbmUodGhpcy5hdHRyaWJ1dGVzKTsKICAgIH0sCiAgICAvLyBHZXQgdGhlIHZhbHVlIG9mIGFuIGF0dHJpYnV0ZS4KICAgIGdldDogZnVuY3Rpb24gKGF0dHIpIHsKICAgICAgcmV0dXJuIHRoaXMuYXR0cmlidXRlc1thdHRyXTsKICAgIH0sCiAgICAvLyBHZXQgdGhlIEhUTUwtZXNjYXBlZCB2YWx1ZSBvZiBhbiBhdHRyaWJ1dGUuCiAgICBlc2NhcGU6IGZ1bmN0aW9uIChhdHRyKSB7CiAgICAgIHZhciBodG1sOwogICAgICBpZiAoaHRtbCA9IHRoaXMuX2VzY2FwZWRBdHRyaWJ1dGVzW2F0dHJdKSByZXR1cm4gaHRtbDsKICAgICAgdmFyIHZhbCA9IHRoaXMuZ2V0KGF0dHIpOwogICAgICByZXR1cm4gdGhpcy5fZXNjYXBlZEF0dHJpYnV0ZXNbYXR0cl0gPSBfLmVzY2FwZSh2YWwgPT0gbnVsbCA/ICcnIDogJycgKyB2YWwpOwogICAgfSwKICAgIC8vIFJldHVybnMgYHRydWVgIGlmIHRoZSBhdHRyaWJ1dGUgY29udGFpbnMgYSB2YWx1ZSB0aGF0IGlzIG5vdCBudWxsCiAgICAvLyBvciB1bmRlZmluZWQuCiAgICBoYXM6IGZ1bmN0aW9uIChhdHRyKSB7CiAgICAgIHJldHVybiB0aGlzLmdldChhdHRyKSAhPSBudWxsOwogICAgfSwKICAgIC8vIFNldCBhIGhhc2ggb2YgbW9kZWwgYXR0cmlidXRlcyBvbiB0aGUgb2JqZWN0LCBmaXJpbmcgYCJjaGFuZ2UiYCB1bmxlc3MKICAgIC8vIHlvdSBjaG9vc2UgdG8gc2lsZW5jZSBpdC4KICAgIHNldDogZnVuY3Rpb24gKGtleSwgdmFsdWUsIG9wdGlvbnMpIHsKICAgICAgdmFyIGF0dHJzLCBhdHRyLCB2YWw7IC8vIEhhbmRsZSBib3RoCgogICAgICBpZiAoXy5pc09iamVjdChrZXkpIHx8IGtleSA9PSBudWxsKSB7CiAgICAgICAgYXR0cnMgPSBrZXk7CiAgICAgICAgb3B0aW9ucyA9IHZhbHVlOwogICAgICB9IGVsc2UgewogICAgICAgIGF0dHJzID0ge307CiAgICAgICAgYXR0cnNba2V5XSA9IHZhbHVlOwogICAgICB9IC8vIEV4dHJhY3QgYXR0cmlidXRlcyBhbmQgb3B0aW9ucy4KCgogICAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwogICAgICBpZiAoIWF0dHJzKSByZXR1cm4gdGhpczsKICAgICAgaWYgKGF0dHJzIGluc3RhbmNlb2YgTW9kZWwpIGF0dHJzID0gYXR0cnMuYXR0cmlidXRlczsKICAgICAgaWYgKG9wdGlvbnMudW5zZXQpIGZvciAoYXR0ciBpbiBhdHRycykgYXR0cnNbYXR0cl0gPSB2b2lkIDA7IC8vIFJ1biB2YWxpZGF0aW9uLgoKICAgICAgaWYgKCF0aGlzLl92YWxpZGF0ZShhdHRycywgb3B0aW9ucykpIHJldHVybiBmYWxzZTsgLy8gQ2hlY2sgZm9yIGNoYW5nZXMgb2YgYGlkYC4KCiAgICAgIGlmICh0aGlzLmlkQXR0cmlidXRlIGluIGF0dHJzKSB0aGlzLmlkID0gYXR0cnNbdGhpcy5pZEF0dHJpYnV0ZV07CiAgICAgIHZhciBjaGFuZ2VzID0gb3B0aW9ucy5jaGFuZ2VzID0ge307CiAgICAgIHZhciBub3cgPSB0aGlzLmF0dHJpYnV0ZXM7CiAgICAgIHZhciBlc2NhcGVkID0gdGhpcy5fZXNjYXBlZEF0dHJpYnV0ZXM7CiAgICAgIHZhciBwcmV2ID0gdGhpcy5fcHJldmlvdXNBdHRyaWJ1dGVzIHx8IHt9OyAvLyBGb3IgZWFjaCBgc2V0YCBhdHRyaWJ1dGUuLi4KCiAgICAgIGZvciAoYXR0ciBpbiBhdHRycykgewogICAgICAgIHZhbCA9IGF0dHJzW2F0dHJdOyAvLyBJZiB0aGUgbmV3IGFuZCBjdXJyZW50IHZhbHVlIGRpZmZlciwgcmVjb3JkIHRoZSBjaGFuZ2UuCgogICAgICAgIGlmICghXy5pc0VxdWFsKG5vd1thdHRyXSwgdmFsKSB8fCBvcHRpb25zLnVuc2V0ICYmIF8uaGFzKG5vdywgYXR0cikpIHsKICAgICAgICAgIGRlbGV0ZSBlc2NhcGVkW2F0dHJdOwogICAgICAgICAgKG9wdGlvbnMuc2lsZW50ID8gdGhpcy5fc2lsZW50IDogY2hhbmdlcylbYXR0cl0gPSB0cnVlOwogICAgICAgIH0gLy8gVXBkYXRlIG9yIGRlbGV0ZSB0aGUgY3VycmVudCB2YWx1ZS4KCgogICAgICAgIG9wdGlvbnMudW5zZXQgPyBkZWxldGUgbm93W2F0dHJdIDogbm93W2F0dHJdID0gdmFsOyAvLyBJZiB0aGUgbmV3IGFuZCBwcmV2aW91cyB2YWx1ZSBkaWZmZXIsIHJlY29yZCB0aGUgY2hhbmdlLiAgSWYgbm90LAogICAgICAgIC8vIHRoZW4gcmVtb3ZlIGNoYW5nZXMgZm9yIHRoaXMgYXR0cmlidXRlLgoKICAgICAgICBpZiAoIV8uaXNFcXVhbChwcmV2W2F0dHJdLCB2YWwpIHx8IF8uaGFzKG5vdywgYXR0cikgIT0gXy5oYXMocHJldiwgYXR0cikpIHsKICAgICAgICAgIHRoaXMuY2hhbmdlZFthdHRyXSA9IHZhbDsKICAgICAgICAgIGlmICghb3B0aW9ucy5zaWxlbnQpIHRoaXMuX3BlbmRpbmdbYXR0cl0gPSB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBkZWxldGUgdGhpcy5jaGFuZ2VkW2F0dHJdOwogICAgICAgICAgZGVsZXRlIHRoaXMuX3BlbmRpbmdbYXR0cl07CiAgICAgICAgfQogICAgICB9IC8vIEZpcmUgdGhlIGAiY2hhbmdlImAgZXZlbnRzLgoKCiAgICAgIGlmICghb3B0aW9ucy5zaWxlbnQpIHRoaXMuY2hhbmdlKG9wdGlvbnMpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCiAgICAvLyBSZW1vdmUgYW4gYXR0cmlidXRlIGZyb20gdGhlIG1vZGVsLCBmaXJpbmcgYCJjaGFuZ2UiYCB1bmxlc3MgeW91IGNob29zZQogICAgLy8gdG8gc2lsZW5jZSBpdC4gYHVuc2V0YCBpcyBhIG5vb3AgaWYgdGhlIGF0dHJpYnV0ZSBkb2Vzbid0IGV4aXN0LgogICAgdW5zZXQ6IGZ1bmN0aW9uIChhdHRyLCBvcHRpb25zKSB7CiAgICAgIChvcHRpb25zIHx8IChvcHRpb25zID0ge30pKS51bnNldCA9IHRydWU7CiAgICAgIHJldHVybiB0aGlzLnNldChhdHRyLCBudWxsLCBvcHRpb25zKTsKICAgIH0sCiAgICAvLyBDbGVhciBhbGwgYXR0cmlidXRlcyBvbiB0aGUgbW9kZWwsIGZpcmluZyBgImNoYW5nZSJgIHVubGVzcyB5b3UgY2hvb3NlCiAgICAvLyB0byBzaWxlbmNlIGl0LgogICAgY2xlYXI6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgIChvcHRpb25zIHx8IChvcHRpb25zID0ge30pKS51bnNldCA9IHRydWU7CiAgICAgIHJldHVybiB0aGlzLnNldChfLmNsb25lKHRoaXMuYXR0cmlidXRlcyksIG9wdGlvbnMpOwogICAgfSwKICAgIC8vIEZldGNoIHRoZSBtb2RlbCBmcm9tIHRoZSBzZXJ2ZXIuIElmIHRoZSBzZXJ2ZXIncyByZXByZXNlbnRhdGlvbiBvZiB0aGUKICAgIC8vIG1vZGVsIGRpZmZlcnMgZnJvbSBpdHMgY3VycmVudCBhdHRyaWJ1dGVzLCB0aGV5IHdpbGwgYmUgb3ZlcnJpZGVuLAogICAgLy8gdHJpZ2dlcmluZyBhIGAiY2hhbmdlImAgZXZlbnQuCiAgICBmZXRjaDogZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPyBfLmNsb25lKG9wdGlvbnMpIDoge307CiAgICAgIHZhciBtb2RlbCA9IHRoaXM7CiAgICAgIHZhciBzdWNjZXNzID0gb3B0aW9ucy5zdWNjZXNzOwoKICAgICAgb3B0aW9ucy5zdWNjZXNzID0gZnVuY3Rpb24gKHJlc3AsIHN0YXR1cywgeGhyKSB7CiAgICAgICAgaWYgKCFtb2RlbC5zZXQobW9kZWwucGFyc2UocmVzcCwgeGhyKSwgb3B0aW9ucykpIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoc3VjY2Vzcykgc3VjY2Vzcyhtb2RlbCwgcmVzcCk7CiAgICAgIH07CgogICAgICBvcHRpb25zLmVycm9yID0gQmFja2JvbmUud3JhcEVycm9yKG9wdGlvbnMuZXJyb3IsIG1vZGVsLCBvcHRpb25zKTsKICAgICAgcmV0dXJuICh0aGlzLnN5bmMgfHwgQmFja2JvbmUuc3luYykuY2FsbCh0aGlzLCAncmVhZCcsIHRoaXMsIG9wdGlvbnMpOwogICAgfSwKICAgIC8vIFNldCBhIGhhc2ggb2YgbW9kZWwgYXR0cmlidXRlcywgYW5kIHN5bmMgdGhlIG1vZGVsIHRvIHRoZSBzZXJ2ZXIuCiAgICAvLyBJZiB0aGUgc2VydmVyIHJldHVybnMgYW4gYXR0cmlidXRlcyBoYXNoIHRoYXQgZGlmZmVycywgdGhlIG1vZGVsJ3MKICAgIC8vIHN0YXRlIHdpbGwgYmUgYHNldGAgYWdhaW4uCiAgICBzYXZlOiBmdW5jdGlvbiAoa2V5LCB2YWx1ZSwgb3B0aW9ucykgewogICAgICB2YXIgYXR0cnMsIGN1cnJlbnQ7IC8vIEhhbmRsZSBib3RoIGAoImtleSIsIHZhbHVlKWAgYW5kIGAoe2tleTogdmFsdWV9KWAgLXN0eWxlIGNhbGxzLgoKICAgICAgaWYgKF8uaXNPYmplY3Qoa2V5KSB8fCBrZXkgPT0gbnVsbCkgewogICAgICAgIGF0dHJzID0ga2V5OwogICAgICAgIG9wdGlvbnMgPSB2YWx1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhdHRycyA9IHt9OwogICAgICAgIGF0dHJzW2tleV0gPSB2YWx1ZTsKICAgICAgfQoKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPyBfLmNsb25lKG9wdGlvbnMpIDoge307IC8vIElmIHdlJ3JlICJ3YWl0Ii1pbmcgdG8gc2V0IGNoYW5nZWQgYXR0cmlidXRlcywgdmFsaWRhdGUgZWFybHkuCgogICAgICBpZiAob3B0aW9ucy53YWl0KSB7CiAgICAgICAgaWYgKCF0aGlzLl92YWxpZGF0ZShhdHRycywgb3B0aW9ucykpIHJldHVybiBmYWxzZTsKICAgICAgICBjdXJyZW50ID0gXy5jbG9uZSh0aGlzLmF0dHJpYnV0ZXMpOwogICAgICB9IC8vIFJlZ3VsYXIgc2F2ZXMgYHNldGAgYXR0cmlidXRlcyBiZWZvcmUgcGVyc2lzdGluZyB0byB0aGUgc2VydmVyLgoKCiAgICAgIHZhciBzaWxlbnRPcHRpb25zID0gXy5leHRlbmQoe30sIG9wdGlvbnMsIHsKICAgICAgICBzaWxlbnQ6IHRydWUKICAgICAgfSk7CgogICAgICBpZiAoYXR0cnMgJiYgIXRoaXMuc2V0KGF0dHJzLCBvcHRpb25zLndhaXQgPyBzaWxlbnRPcHRpb25zIDogb3B0aW9ucykpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gQWZ0ZXIgYSBzdWNjZXNzZnVsIHNlcnZlci1zaWRlIHNhdmUsIHRoZSBjbGllbnQgaXMgKG9wdGlvbmFsbHkpCiAgICAgIC8vIHVwZGF0ZWQgd2l0aCB0aGUgc2VydmVyLXNpZGUgc3RhdGUuCgoKICAgICAgdmFyIG1vZGVsID0gdGhpczsKICAgICAgdmFyIHN1Y2Nlc3MgPSBvcHRpb25zLnN1Y2Nlc3M7CgogICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbiAocmVzcCwgc3RhdHVzLCB4aHIpIHsKICAgICAgICB2YXIgc2VydmVyQXR0cnMgPSBtb2RlbC5wYXJzZShyZXNwLCB4aHIpOwoKICAgICAgICBpZiAob3B0aW9ucy53YWl0KSB7CiAgICAgICAgICBkZWxldGUgb3B0aW9ucy53YWl0OwogICAgICAgICAgc2VydmVyQXR0cnMgPSBfLmV4dGVuZChhdHRycyB8fCB7fSwgc2VydmVyQXR0cnMpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFtb2RlbC5zZXQoc2VydmVyQXR0cnMsIG9wdGlvbnMpKSByZXR1cm4gZmFsc2U7CgogICAgICAgIGlmIChzdWNjZXNzKSB7CiAgICAgICAgICBzdWNjZXNzKG1vZGVsLCByZXNwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbW9kZWwudHJpZ2dlcignc3luYycsIG1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgICB9CiAgICAgIH07IC8vIEZpbmlzaCBjb25maWd1cmluZyBhbmQgc2VuZGluZyB0aGUgQWpheCByZXF1ZXN0LgoKCiAgICAgIG9wdGlvbnMuZXJyb3IgPSBCYWNrYm9uZS53cmFwRXJyb3Iob3B0aW9ucy5lcnJvciwgbW9kZWwsIG9wdGlvbnMpOwogICAgICB2YXIgbWV0aG9kID0gdGhpcy5pc05ldygpID8gJ2NyZWF0ZScgOiAndXBkYXRlJzsKICAgICAgdmFyIHhociA9ICh0aGlzLnN5bmMgfHwgQmFja2JvbmUuc3luYykuY2FsbCh0aGlzLCBtZXRob2QsIHRoaXMsIG9wdGlvbnMpOwogICAgICBpZiAob3B0aW9ucy53YWl0KSB0aGlzLnNldChjdXJyZW50LCBzaWxlbnRPcHRpb25zKTsKICAgICAgcmV0dXJuIHhocjsKICAgIH0sCiAgICAvLyBEZXN0cm95IHRoaXMgbW9kZWwgb24gdGhlIHNlcnZlciBpZiBpdCB3YXMgYWxyZWFkeSBwZXJzaXN0ZWQuCiAgICAvLyBPcHRpbWlzdGljYWxseSByZW1vdmVzIHRoZSBtb2RlbCBmcm9tIGl0cyBjb2xsZWN0aW9uLCBpZiBpdCBoYXMgb25lLgogICAgLy8gSWYgYHdhaXQ6IHRydWVgIGlzIHBhc3NlZCwgd2FpdHMgZm9yIHRoZSBzZXJ2ZXIgdG8gcmVzcG9uZCBiZWZvcmUgcmVtb3ZhbC4KICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgPSBvcHRpb25zID8gXy5jbG9uZShvcHRpb25zKSA6IHt9OwogICAgICB2YXIgbW9kZWwgPSB0aGlzOwogICAgICB2YXIgc3VjY2VzcyA9IG9wdGlvbnMuc3VjY2VzczsKCiAgICAgIHZhciB0cmlnZ2VyRGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBtb2RlbC50cmlnZ2VyKCdkZXN0cm95JywgbW9kZWwsIG1vZGVsLmNvbGxlY3Rpb24sIG9wdGlvbnMpOwogICAgICB9OwoKICAgICAgaWYgKHRoaXMuaXNOZXcoKSkgewogICAgICAgIHRyaWdnZXJEZXN0cm95KCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbiAocmVzcCkgewogICAgICAgIGlmIChvcHRpb25zLndhaXQpIHRyaWdnZXJEZXN0cm95KCk7CgogICAgICAgIGlmIChzdWNjZXNzKSB7CiAgICAgICAgICBzdWNjZXNzKG1vZGVsLCByZXNwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbW9kZWwudHJpZ2dlcignc3luYycsIG1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBvcHRpb25zLmVycm9yID0gQmFja2JvbmUud3JhcEVycm9yKG9wdGlvbnMuZXJyb3IsIG1vZGVsLCBvcHRpb25zKTsKICAgICAgdmFyIHhociA9ICh0aGlzLnN5bmMgfHwgQmFja2JvbmUuc3luYykuY2FsbCh0aGlzLCAnZGVsZXRlJywgdGhpcywgb3B0aW9ucyk7CiAgICAgIGlmICghb3B0aW9ucy53YWl0KSB0cmlnZ2VyRGVzdHJveSgpOwogICAgICByZXR1cm4geGhyOwogICAgfSwKICAgIC8vIERlZmF1bHQgVVJMIGZvciB0aGUgbW9kZWwncyByZXByZXNlbnRhdGlvbiBvbiB0aGUgc2VydmVyIC0tIGlmIHlvdSdyZQogICAgLy8gdXNpbmcgQmFja2JvbmUncyByZXN0ZnVsIG1ldGhvZHMsIG92ZXJyaWRlIHRoaXMgdG8gY2hhbmdlIHRoZSBlbmRwb2ludAogICAgLy8gdGhhdCB3aWxsIGJlIGNhbGxlZC4KICAgIHVybDogZnVuY3Rpb24gKCkgewogICAgICB2YXIgYmFzZSA9IGdldFZhbHVlKHRoaXMsICd1cmxSb290JykgfHwgZ2V0VmFsdWUodGhpcy5jb2xsZWN0aW9uLCAndXJsJykgfHwgdXJsRXJyb3IoKTsKICAgICAgaWYgKHRoaXMuaXNOZXcoKSkgcmV0dXJuIGJhc2U7CiAgICAgIHJldHVybiBiYXNlICsgKGJhc2UuY2hhckF0KGJhc2UubGVuZ3RoIC0gMSkgPT0gJy8nID8gJycgOiAnLycpICsgZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuaWQpOwogICAgfSwKICAgIC8vICoqcGFyc2UqKiBjb252ZXJ0cyBhIHJlc3BvbnNlIGludG8gdGhlIGhhc2ggb2YgYXR0cmlidXRlcyB0byBiZSBgc2V0YCBvbgogICAgLy8gdGhlIG1vZGVsLiBUaGUgZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBpcyBqdXN0IHRvIHBhc3MgdGhlIHJlc3BvbnNlIGFsb25nLgogICAgcGFyc2U6IGZ1bmN0aW9uIChyZXNwLCB4aHIpIHsKICAgICAgcmV0dXJuIHJlc3A7CiAgICB9LAogICAgLy8gQ3JlYXRlIGEgbmV3IG1vZGVsIHdpdGggaWRlbnRpY2FsIGF0dHJpYnV0ZXMgdG8gdGhpcyBvbmUuCiAgICBjbG9uZTogZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IodGhpcy5hdHRyaWJ1dGVzKTsKICAgIH0sCiAgICAvLyBBIG1vZGVsIGlzIG5ldyBpZiBpdCBoYXMgbmV2ZXIgYmVlbiBzYXZlZCB0byB0aGUgc2VydmVyLCBhbmQgbGFja3MgYW4gaWQuCiAgICBpc05ldzogZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5pZCA9PSBudWxsOwogICAgfSwKICAgIC8vIENhbGwgdGhpcyBtZXRob2QgdG8gbWFudWFsbHkgZmlyZSBhIGAiY2hhbmdlImAgZXZlbnQgZm9yIHRoaXMgbW9kZWwgYW5kCiAgICAvLyBhIGAiY2hhbmdlOmF0dHJpYnV0ZSJgIGV2ZW50IGZvciBlYWNoIGNoYW5nZWQgYXR0cmlidXRlLgogICAgLy8gQ2FsbGluZyB0aGlzIHdpbGwgY2F1c2UgYWxsIG9iamVjdHMgb2JzZXJ2aW5nIHRoZSBtb2RlbCB0byB1cGRhdGUuCiAgICBjaGFuZ2U6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICAgIHZhciBjaGFuZ2luZyA9IHRoaXMuX2NoYW5naW5nOwogICAgICB0aGlzLl9jaGFuZ2luZyA9IHRydWU7IC8vIFNpbGVudCBjaGFuZ2VzIGJlY29tZSBwZW5kaW5nIGNoYW5nZXMuCgogICAgICBmb3IgKHZhciBhdHRyIGluIHRoaXMuX3NpbGVudCkgdGhpcy5fcGVuZGluZ1thdHRyXSA9IHRydWU7IC8vIFNpbGVudCBjaGFuZ2VzIGFyZSB0cmlnZ2VyZWQuCgoKICAgICAgdmFyIGNoYW5nZXMgPSBfLmV4dGVuZCh7fSwgb3B0aW9ucy5jaGFuZ2VzLCB0aGlzLl9zaWxlbnQpOwoKICAgICAgdGhpcy5fc2lsZW50ID0ge307CgogICAgICBmb3IgKHZhciBhdHRyIGluIGNoYW5nZXMpIHsKICAgICAgICB0aGlzLnRyaWdnZXIoJ2NoYW5nZTonICsgYXR0ciwgdGhpcywgdGhpcy5nZXQoYXR0ciksIG9wdGlvbnMpOwogICAgICB9CgogICAgICBpZiAoY2hhbmdpbmcpIHJldHVybiB0aGlzOyAvLyBDb250aW51ZSBmaXJpbmcgYCJjaGFuZ2UiYCBldmVudHMgd2hpbGUgdGhlcmUgYXJlIHBlbmRpbmcgY2hhbmdlcy4KCiAgICAgIHdoaWxlICghXy5pc0VtcHR5KHRoaXMuX3BlbmRpbmcpKSB7CiAgICAgICAgdGhpcy5fcGVuZGluZyA9IHt9OwogICAgICAgIHRoaXMudHJpZ2dlcignY2hhbmdlJywgdGhpcywgb3B0aW9ucyk7IC8vIFBlbmRpbmcgYW5kIHNpbGVudCBjaGFuZ2VzIHN0aWxsIHJlbWFpbi4KCiAgICAgICAgZm9yICh2YXIgYXR0ciBpbiB0aGlzLmNoYW5nZWQpIHsKICAgICAgICAgIGlmICh0aGlzLl9wZW5kaW5nW2F0dHJdIHx8IHRoaXMuX3NpbGVudFthdHRyXSkgY29udGludWU7CiAgICAgICAgICBkZWxldGUgdGhpcy5jaGFuZ2VkW2F0dHJdOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5fcHJldmlvdXNBdHRyaWJ1dGVzID0gXy5jbG9uZSh0aGlzLmF0dHJpYnV0ZXMpOwogICAgICB9CgogICAgICB0aGlzLl9jaGFuZ2luZyA9IGZhbHNlOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCiAgICAvLyBEZXRlcm1pbmUgaWYgdGhlIG1vZGVsIGhhcyBjaGFuZ2VkIHNpbmNlIHRoZSBsYXN0IGAiY2hhbmdlImAgZXZlbnQuCiAgICAvLyBJZiB5b3Ugc3BlY2lmeSBhbiBhdHRyaWJ1dGUgbmFtZSwgZGV0ZXJtaW5lIGlmIHRoYXQgYXR0cmlidXRlIGhhcyBjaGFuZ2VkLgogICAgaGFzQ2hhbmdlZDogZnVuY3Rpb24gKGF0dHIpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gIV8uaXNFbXB0eSh0aGlzLmNoYW5nZWQpOwogICAgICByZXR1cm4gXy5oYXModGhpcy5jaGFuZ2VkLCBhdHRyKTsKICAgIH0sCiAgICAvLyBSZXR1cm4gYW4gb2JqZWN0IGNvbnRhaW5pbmcgYWxsIHRoZSBhdHRyaWJ1dGVzIHRoYXQgaGF2ZSBjaGFuZ2VkLCBvcgogICAgLy8gZmFsc2UgaWYgdGhlcmUgYXJlIG5vIGNoYW5nZWQgYXR0cmlidXRlcy4gVXNlZnVsIGZvciBkZXRlcm1pbmluZyB3aGF0CiAgICAvLyBwYXJ0cyBvZiBhIHZpZXcgbmVlZCB0byBiZSB1cGRhdGVkIGFuZC9vciB3aGF0IGF0dHJpYnV0ZXMgbmVlZCB0byBiZQogICAgLy8gcGVyc2lzdGVkIHRvIHRoZSBzZXJ2ZXIuIFVuc2V0IGF0dHJpYnV0ZXMgd2lsbCBiZSBzZXQgdG8gdW5kZWZpbmVkLgogICAgLy8gWW91IGNhbiBhbHNvIHBhc3MgYW4gYXR0cmlidXRlcyBvYmplY3QgdG8gZGlmZiBhZ2FpbnN0IHRoZSBtb2RlbCwKICAgIC8vIGRldGVybWluaW5nIGlmIHRoZXJlICp3b3VsZCBiZSogYSBjaGFuZ2UuCiAgICBjaGFuZ2VkQXR0cmlidXRlczogZnVuY3Rpb24gKGRpZmYpIHsKICAgICAgaWYgKCFkaWZmKSByZXR1cm4gdGhpcy5oYXNDaGFuZ2VkKCkgPyBfLmNsb25lKHRoaXMuY2hhbmdlZCkgOiBmYWxzZTsKICAgICAgdmFyIHZhbCwKICAgICAgICAgIGNoYW5nZWQgPSBmYWxzZSwKICAgICAgICAgIG9sZCA9IHRoaXMuX3ByZXZpb3VzQXR0cmlidXRlczsKCiAgICAgIGZvciAodmFyIGF0dHIgaW4gZGlmZikgewogICAgICAgIGlmIChfLmlzRXF1YWwob2xkW2F0dHJdLCB2YWwgPSBkaWZmW2F0dHJdKSkgY29udGludWU7CiAgICAgICAgKGNoYW5nZWQgfHwgKGNoYW5nZWQgPSB7fSkpW2F0dHJdID0gdmFsOwogICAgICB9CgogICAgICByZXR1cm4gY2hhbmdlZDsKICAgIH0sCiAgICAvLyBHZXQgdGhlIHByZXZpb3VzIHZhbHVlIG9mIGFuIGF0dHJpYnV0ZSwgcmVjb3JkZWQgYXQgdGhlIHRpbWUgdGhlIGxhc3QKICAgIC8vIGAiY2hhbmdlImAgZXZlbnQgd2FzIGZpcmVkLgogICAgcHJldmlvdXM6IGZ1bmN0aW9uIChhdHRyKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCB8fCAhdGhpcy5fcHJldmlvdXNBdHRyaWJ1dGVzKSByZXR1cm4gbnVsbDsKICAgICAgcmV0dXJuIHRoaXMuX3ByZXZpb3VzQXR0cmlidXRlc1thdHRyXTsKICAgIH0sCiAgICAvLyBHZXQgYWxsIG9mIHRoZSBhdHRyaWJ1dGVzIG9mIHRoZSBtb2RlbCBhdCB0aGUgdGltZSBvZiB0aGUgcHJldmlvdXMKICAgIC8vIGAiY2hhbmdlImAgZXZlbnQuCiAgICBwcmV2aW91c0F0dHJpYnV0ZXM6IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIF8uY2xvbmUodGhpcy5fcHJldmlvdXNBdHRyaWJ1dGVzKTsKICAgIH0sCiAgICAvLyBDaGVjayBpZiB0aGUgbW9kZWwgaXMgY3VycmVudGx5IGluIGEgdmFsaWQgc3RhdGUuIEl0J3Mgb25seSBwb3NzaWJsZSB0bwogICAgLy8gZ2V0IGludG8gYW4gKmludmFsaWQqIHN0YXRlIGlmIHlvdSdyZSB1c2luZyBzaWxlbnQgY2hhbmdlcy4KICAgIGlzVmFsaWQ6IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuICF0aGlzLnZhbGlkYXRlKHRoaXMuYXR0cmlidXRlcyk7CiAgICB9LAogICAgLy8gUnVuIHZhbGlkYXRpb24gYWdhaW5zdCB0aGUgbmV4dCBjb21wbGV0ZSBzZXQgb2YgbW9kZWwgYXR0cmlidXRlcywKICAgIC8vIHJldHVybmluZyBgdHJ1ZWAgaWYgYWxsIGlzIHdlbGwuIElmIGEgc3BlY2lmaWMgYGVycm9yYCBjYWxsYmFjayBoYXMKICAgIC8vIGJlZW4gcGFzc2VkLCBjYWxsIHRoYXQgaW5zdGVhZCBvZiBmaXJpbmcgdGhlIGdlbmVyYWwgYCJlcnJvciJgIGV2ZW50LgogICAgX3ZhbGlkYXRlOiBmdW5jdGlvbiAoYXR0cnMsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMuc2lsZW50IHx8ICF0aGlzLnZhbGlkYXRlKSByZXR1cm4gdHJ1ZTsKICAgICAgYXR0cnMgPSBfLmV4dGVuZCh7fSwgdGhpcy5hdHRyaWJ1dGVzLCBhdHRycyk7CiAgICAgIHZhciBlcnJvciA9IHRoaXMudmFsaWRhdGUoYXR0cnMsIG9wdGlvbnMpOwogICAgICBpZiAoIWVycm9yKSByZXR1cm4gdHJ1ZTsKCiAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuZXJyb3IpIHsKICAgICAgICBvcHRpb25zLmVycm9yKHRoaXMsIGVycm9yLCBvcHRpb25zKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnRyaWdnZXIoJ2Vycm9yJywgdGhpcywgZXJyb3IsIG9wdGlvbnMpOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfSk7IC8vIEJhY2tib25lLkNvbGxlY3Rpb24KICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tCiAgLy8gUHJvdmlkZXMgYSBzdGFuZGFyZCBjb2xsZWN0aW9uIGNsYXNzIGZvciBvdXIgc2V0cyBvZiBtb2RlbHMsIG9yZGVyZWQKICAvLyBvciB1bm9yZGVyZWQuIElmIGEgYGNvbXBhcmF0b3JgIGlzIHNwZWNpZmllZCwgdGhlIENvbGxlY3Rpb24gd2lsbCBtYWludGFpbgogIC8vIGl0cyBtb2RlbHMgaW4gc29ydCBvcmRlciwgYXMgdGhleSdyZSBhZGRlZCBhbmQgcmVtb3ZlZC4KCgogIHZhciBDb2xsZWN0aW9uID0gQmFja2JvbmUuQ29sbGVjdGlvbiA9IGZ1bmN0aW9uIChtb2RlbHMsIG9wdGlvbnMpIHsKICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICBpZiAob3B0aW9ucy5tb2RlbCkgdGhpcy5tb2RlbCA9IG9wdGlvbnMubW9kZWw7CiAgICBpZiAob3B0aW9ucy5jb21wYXJhdG9yKSB0aGlzLmNvbXBhcmF0b3IgPSBvcHRpb25zLmNvbXBhcmF0b3I7CgogICAgdGhpcy5fcmVzZXQoKTsKCiAgICB0aGlzLmluaXRpYWxpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIGlmIChtb2RlbHMpIHRoaXMucmVzZXQobW9kZWxzLCB7CiAgICAgIHNpbGVudDogdHJ1ZSwKICAgICAgcGFyc2U6IG9wdGlvbnMucGFyc2UKICAgIH0pOwogIH07IC8vIERlZmluZSB0aGUgQ29sbGVjdGlvbidzIGluaGVyaXRhYmxlIG1ldGhvZHMuCgoKICBfLmV4dGVuZChDb2xsZWN0aW9uLnByb3RvdHlwZSwgRXZlbnRzLCB7CiAgICAvLyBUaGUgZGVmYXVsdCBtb2RlbCBmb3IgYSBjb2xsZWN0aW9uIGlzIGp1c3QgYSAqKkJhY2tib25lLk1vZGVsKiouCiAgICAvLyBUaGlzIHNob3VsZCBiZSBvdmVycmlkZGVuIGluIG1vc3QgY2FzZXMuCiAgICBtb2RlbDogTW9kZWwsCiAgICAvLyBJbml0aWFsaXplIGlzIGFuIGVtcHR5IGZ1bmN0aW9uIGJ5IGRlZmF1bHQuIE92ZXJyaWRlIGl0IHdpdGggeW91ciBvd24KICAgIC8vIGluaXRpYWxpemF0aW9uIGxvZ2ljLgogICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkge30sCiAgICAvLyBUaGUgSlNPTiByZXByZXNlbnRhdGlvbiBvZiBhIENvbGxlY3Rpb24gaXMgYW4gYXJyYXkgb2YgdGhlCiAgICAvLyBtb2RlbHMnIGF0dHJpYnV0ZXMuCiAgICB0b0pTT046IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgIHJldHVybiB0aGlzLm1hcChmdW5jdGlvbiAobW9kZWwpIHsKICAgICAgICByZXR1cm4gbW9kZWwudG9KU09OKG9wdGlvbnMpOwogICAgICB9KTsKICAgIH0sCiAgICAvLyBBZGQgYSBtb2RlbCwgb3IgbGlzdCBvZiBtb2RlbHMgdG8gdGhlIHNldC4gUGFzcyAqKnNpbGVudCoqIHRvIGF2b2lkCiAgICAvLyBmaXJpbmcgdGhlIGBhZGRgIGV2ZW50IGZvciBldmVyeSBuZXcgbW9kZWwuCiAgICBhZGQ6IGZ1bmN0aW9uIChtb2RlbHMsIG9wdGlvbnMpIHsKICAgICAgdmFyIGksCiAgICAgICAgICBpbmRleCwKICAgICAgICAgIGxlbmd0aCwKICAgICAgICAgIG1vZGVsLAogICAgICAgICAgY2lkLAogICAgICAgICAgaWQsCiAgICAgICAgICBjaWRzID0ge30sCiAgICAgICAgICBpZHMgPSB7fSwKICAgICAgICAgIGR1cHMgPSBbXTsKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgICAgbW9kZWxzID0gXy5pc0FycmF5KG1vZGVscykgPyBtb2RlbHMuc2xpY2UoKSA6IFttb2RlbHNdOyAvLyBCZWdpbiBieSB0dXJuaW5nIGJhcmUgb2JqZWN0cyBpbnRvIG1vZGVsIHJlZmVyZW5jZXMsIGFuZCBwcmV2ZW50aW5nCiAgICAgIC8vIGludmFsaWQgbW9kZWxzIG9yIGR1cGxpY2F0ZSBtb2RlbHMgZnJvbSBiZWluZyBhZGRlZC4KCiAgICAgIGZvciAoaSA9IDAsIGxlbmd0aCA9IG1vZGVscy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIGlmICghKG1vZGVsID0gbW9kZWxzW2ldID0gdGhpcy5fcHJlcGFyZU1vZGVsKG1vZGVsc1tpXSwgb3B0aW9ucykpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbid0IGFkZCBhbiBpbnZhbGlkIG1vZGVsIHRvIGEgY29sbGVjdGlvbiIpOwogICAgICAgIH0KCiAgICAgICAgY2lkID0gbW9kZWwuY2lkOwogICAgICAgIGlkID0gbW9kZWwuaWQ7CgogICAgICAgIGlmIChjaWRzW2NpZF0gfHwgdGhpcy5fYnlDaWRbY2lkXSB8fCBpZCAhPSBudWxsICYmIChpZHNbaWRdIHx8IHRoaXMuX2J5SWRbaWRdKSkgewogICAgICAgICAgZHVwcy5wdXNoKGkpOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICBjaWRzW2NpZF0gPSBpZHNbaWRdID0gbW9kZWw7CiAgICAgIH0gLy8gUmVtb3ZlIGR1cGxpY2F0ZXMuCgoKICAgICAgaSA9IGR1cHMubGVuZ3RoOwoKICAgICAgd2hpbGUgKGktLSkgewogICAgICAgIG1vZGVscy5zcGxpY2UoZHVwc1tpXSwgMSk7CiAgICAgIH0gLy8gTGlzdGVuIHRvIGFkZGVkIG1vZGVscycgZXZlbnRzLCBhbmQgaW5kZXggbW9kZWxzIGZvciBsb29rdXAgYnkKICAgICAgLy8gYGlkYCBhbmQgYnkgYGNpZGAuCgoKICAgICAgZm9yIChpID0gMCwgbGVuZ3RoID0gbW9kZWxzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgKG1vZGVsID0gbW9kZWxzW2ldKS5vbignYWxsJywgdGhpcy5fb25Nb2RlbEV2ZW50LCB0aGlzKTsKICAgICAgICB0aGlzLl9ieUNpZFttb2RlbC5jaWRdID0gbW9kZWw7CiAgICAgICAgaWYgKG1vZGVsLmlkICE9IG51bGwpIHRoaXMuX2J5SWRbbW9kZWwuaWRdID0gbW9kZWw7CiAgICAgIH0gLy8gSW5zZXJ0IG1vZGVscyBpbnRvIHRoZSBjb2xsZWN0aW9uLCByZS1zb3J0aW5nIGlmIG5lZWRlZCwgYW5kIHRyaWdnZXJpbmcKICAgICAgLy8gYGFkZGAgZXZlbnRzIHVubGVzcyBzaWxlbmNlZC4KCgogICAgICB0aGlzLmxlbmd0aCArPSBsZW5ndGg7CiAgICAgIGluZGV4ID0gb3B0aW9ucy5hdCAhPSBudWxsID8gb3B0aW9ucy5hdCA6IHRoaXMubW9kZWxzLmxlbmd0aDsKICAgICAgc3BsaWNlLmFwcGx5KHRoaXMubW9kZWxzLCBbaW5kZXgsIDBdLmNvbmNhdChtb2RlbHMpKTsKICAgICAgaWYgKHRoaXMuY29tcGFyYXRvcikgdGhpcy5zb3J0KHsKICAgICAgICBzaWxlbnQ6IHRydWUKICAgICAgfSk7CiAgICAgIGlmIChvcHRpb25zLnNpbGVudCkgcmV0dXJuIHRoaXM7CgogICAgICBmb3IgKGkgPSAwLCBsZW5ndGggPSB0aGlzLm1vZGVscy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIGlmICghY2lkc1sobW9kZWwgPSB0aGlzLm1vZGVsc1tpXSkuY2lkXSkgY29udGludWU7CiAgICAgICAgb3B0aW9ucy5pbmRleCA9IGk7CiAgICAgICAgbW9kZWwudHJpZ2dlcignYWRkJywgbW9kZWwsIHRoaXMsIG9wdGlvbnMpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0sCiAgICAvLyBSZW1vdmUgYSBtb2RlbCwgb3IgYSBsaXN0IG9mIG1vZGVscyBmcm9tIHRoZSBzZXQuIFBhc3Mgc2lsZW50IHRvIGF2b2lkCiAgICAvLyBmaXJpbmcgdGhlIGByZW1vdmVgIGV2ZW50IGZvciBldmVyeSBtb2RlbCByZW1vdmVkLgogICAgcmVtb3ZlOiBmdW5jdGlvbiAobW9kZWxzLCBvcHRpb25zKSB7CiAgICAgIHZhciBpLCBsLCBpbmRleCwgbW9kZWw7CiAgICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICAgIG1vZGVscyA9IF8uaXNBcnJheShtb2RlbHMpID8gbW9kZWxzLnNsaWNlKCkgOiBbbW9kZWxzXTsKCiAgICAgIGZvciAoaSA9IDAsIGwgPSBtb2RlbHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgbW9kZWwgPSB0aGlzLmdldEJ5Q2lkKG1vZGVsc1tpXSkgfHwgdGhpcy5nZXQobW9kZWxzW2ldKTsKICAgICAgICBpZiAoIW1vZGVsKSBjb250aW51ZTsKICAgICAgICBkZWxldGUgdGhpcy5fYnlJZFttb2RlbC5pZF07CiAgICAgICAgZGVsZXRlIHRoaXMuX2J5Q2lkW21vZGVsLmNpZF07CiAgICAgICAgaW5kZXggPSB0aGlzLmluZGV4T2YobW9kZWwpOwogICAgICAgIHRoaXMubW9kZWxzLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgdGhpcy5sZW5ndGgtLTsKCiAgICAgICAgaWYgKCFvcHRpb25zLnNpbGVudCkgewogICAgICAgICAgb3B0aW9ucy5pbmRleCA9IGluZGV4OwogICAgICAgICAgbW9kZWwudHJpZ2dlcigncmVtb3ZlJywgbW9kZWwsIHRoaXMsIG9wdGlvbnMpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5fcmVtb3ZlUmVmZXJlbmNlKG1vZGVsKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAogICAgLy8gQWRkIGEgbW9kZWwgdG8gdGhlIGVuZCBvZiB0aGUgY29sbGVjdGlvbi4KICAgIHB1c2g6IGZ1bmN0aW9uIChtb2RlbCwgb3B0aW9ucykgewogICAgICBtb2RlbCA9IHRoaXMuX3ByZXBhcmVNb2RlbChtb2RlbCwgb3B0aW9ucyk7CiAgICAgIHRoaXMuYWRkKG1vZGVsLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIG1vZGVsOwogICAgfSwKICAgIC8vIFJlbW92ZSBhIG1vZGVsIGZyb20gdGhlIGVuZCBvZiB0aGUgY29sbGVjdGlvbi4KICAgIHBvcDogZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgdmFyIG1vZGVsID0gdGhpcy5hdCh0aGlzLmxlbmd0aCAtIDEpOwogICAgICB0aGlzLnJlbW92ZShtb2RlbCwgb3B0aW9ucyk7CiAgICAgIHJldHVybiBtb2RlbDsKICAgIH0sCiAgICAvLyBBZGQgYSBtb2RlbCB0byB0aGUgYmVnaW5uaW5nIG9mIHRoZSBjb2xsZWN0aW9uLgogICAgdW5zaGlmdDogZnVuY3Rpb24gKG1vZGVsLCBvcHRpb25zKSB7CiAgICAgIG1vZGVsID0gdGhpcy5fcHJlcGFyZU1vZGVsKG1vZGVsLCBvcHRpb25zKTsKICAgICAgdGhpcy5hZGQobW9kZWwsIF8uZXh0ZW5kKHsKICAgICAgICBhdDogMAogICAgICB9LCBvcHRpb25zKSk7CiAgICAgIHJldHVybiBtb2RlbDsKICAgIH0sCiAgICAvLyBSZW1vdmUgYSBtb2RlbCBmcm9tIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGNvbGxlY3Rpb24uCiAgICBzaGlmdDogZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgdmFyIG1vZGVsID0gdGhpcy5hdCgwKTsKICAgICAgdGhpcy5yZW1vdmUobW9kZWwsIG9wdGlvbnMpOwogICAgICByZXR1cm4gbW9kZWw7CiAgICB9LAogICAgLy8gR2V0IGEgbW9kZWwgZnJvbSB0aGUgc2V0IGJ5IGlkLgogICAgZ2V0OiBmdW5jdGlvbiAoaWQpIHsKICAgICAgaWYgKGlkID09IG51bGwpIHJldHVybiB2b2lkIDA7CiAgICAgIHJldHVybiB0aGlzLl9ieUlkW2lkLmlkICE9IG51bGwgPyBpZC5pZCA6IGlkXTsKICAgIH0sCiAgICAvLyBHZXQgYSBtb2RlbCBmcm9tIHRoZSBzZXQgYnkgY2xpZW50IGlkLgogICAgZ2V0QnlDaWQ6IGZ1bmN0aW9uIChjaWQpIHsKICAgICAgcmV0dXJuIGNpZCAmJiB0aGlzLl9ieUNpZFtjaWQuY2lkIHx8IGNpZF07CiAgICB9LAogICAgLy8gR2V0IHRoZSBtb2RlbCBhdCB0aGUgZ2l2ZW4gaW5kZXguCiAgICBhdDogZnVuY3Rpb24gKGluZGV4KSB7CiAgICAgIHJldHVybiB0aGlzLm1vZGVsc1tpbmRleF07CiAgICB9LAogICAgLy8gUmV0dXJuIG1vZGVscyB3aXRoIG1hdGNoaW5nIGF0dHJpYnV0ZXMuIFVzZWZ1bCBmb3Igc2ltcGxlIGNhc2VzIG9mIGBmaWx0ZXJgLgogICAgd2hlcmU6IGZ1bmN0aW9uIChhdHRycykgewogICAgICBpZiAoXy5pc0VtcHR5KGF0dHJzKSkgcmV0dXJuIFtdOwogICAgICByZXR1cm4gdGhpcy5maWx0ZXIoZnVuY3Rpb24gKG1vZGVsKSB7CiAgICAgICAgZm9yICh2YXIga2V5IGluIGF0dHJzKSB7CiAgICAgICAgICBpZiAoYXR0cnNba2V5XSAhPT0gbW9kZWwuZ2V0KGtleSkpIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9KTsKICAgIH0sCiAgICAvLyBGb3JjZSB0aGUgY29sbGVjdGlvbiB0byByZS1zb3J0IGl0c2VsZi4gWW91IGRvbid0IG5lZWQgdG8gY2FsbCB0aGlzIHVuZGVyCiAgICAvLyBub3JtYWwgY2lyY3Vtc3RhbmNlcywgYXMgdGhlIHNldCB3aWxsIG1haW50YWluIHNvcnQgb3JkZXIgYXMgZWFjaCBpdGVtCiAgICAvLyBpcyBhZGRlZC4KICAgIHNvcnQ6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICAgIGlmICghdGhpcy5jb21wYXJhdG9yKSB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBzb3J0IGEgc2V0IHdpdGhvdXQgYSBjb21wYXJhdG9yJyk7CgogICAgICB2YXIgYm91bmRDb21wYXJhdG9yID0gXy5iaW5kKHRoaXMuY29tcGFyYXRvciwgdGhpcyk7CgogICAgICBpZiAodGhpcy5jb21wYXJhdG9yLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgdGhpcy5tb2RlbHMgPSB0aGlzLnNvcnRCeShib3VuZENvbXBhcmF0b3IpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMubW9kZWxzLnNvcnQoYm91bmRDb21wYXJhdG9yKTsKICAgICAgfQoKICAgICAgaWYgKCFvcHRpb25zLnNpbGVudCkgdGhpcy50cmlnZ2VyKCdyZXNldCcsIHRoaXMsIG9wdGlvbnMpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCiAgICAvLyBQbHVjayBhbiBhdHRyaWJ1dGUgZnJvbSBlYWNoIG1vZGVsIGluIHRoZSBjb2xsZWN0aW9uLgogICAgcGx1Y2s6IGZ1bmN0aW9uIChhdHRyKSB7CiAgICAgIHJldHVybiBfLm1hcCh0aGlzLm1vZGVscywgZnVuY3Rpb24gKG1vZGVsKSB7CiAgICAgICAgcmV0dXJuIG1vZGVsLmdldChhdHRyKTsKICAgICAgfSk7CiAgICB9LAogICAgLy8gV2hlbiB5b3UgaGF2ZSBtb3JlIGl0ZW1zIHRoYW4geW91IHdhbnQgdG8gYWRkIG9yIHJlbW92ZSBpbmRpdmlkdWFsbHksCiAgICAvLyB5b3UgY2FuIHJlc2V0IHRoZSBlbnRpcmUgc2V0IHdpdGggYSBuZXcgbGlzdCBvZiBtb2RlbHMsIHdpdGhvdXQgZmlyaW5nCiAgICAvLyBhbnkgYGFkZGAgb3IgYHJlbW92ZWAgZXZlbnRzLiBGaXJlcyBgcmVzZXRgIHdoZW4gZmluaXNoZWQuCiAgICByZXNldDogZnVuY3Rpb24gKG1vZGVscywgb3B0aW9ucykgewogICAgICBtb2RlbHMgfHwgKG1vZGVscyA9IFtdKTsKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKCiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gdGhpcy5tb2RlbHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgdGhpcy5fcmVtb3ZlUmVmZXJlbmNlKHRoaXMubW9kZWxzW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy5fcmVzZXQoKTsKCiAgICAgIHRoaXMuYWRkKG1vZGVscywgXy5leHRlbmQoewogICAgICAgIHNpbGVudDogdHJ1ZQogICAgICB9LCBvcHRpb25zKSk7CiAgICAgIGlmICghb3B0aW9ucy5zaWxlbnQpIHRoaXMudHJpZ2dlcigncmVzZXQnLCB0aGlzLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAogICAgLy8gRmV0Y2ggdGhlIGRlZmF1bHQgc2V0IG9mIG1vZGVscyBmb3IgdGhpcyBjb2xsZWN0aW9uLCByZXNldHRpbmcgdGhlCiAgICAvLyBjb2xsZWN0aW9uIHdoZW4gdGhleSBhcnJpdmUuIElmIGBhZGQ6IHRydWVgIGlzIHBhc3NlZCwgYXBwZW5kcyB0aGUKICAgIC8vIG1vZGVscyB0byB0aGUgY29sbGVjdGlvbiBpbnN0ZWFkIG9mIHJlc2V0dGluZy4KICAgIGZldGNoOiBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICBvcHRpb25zID0gb3B0aW9ucyA/IF8uY2xvbmUob3B0aW9ucykgOiB7fTsKICAgICAgaWYgKG9wdGlvbnMucGFyc2UgPT09IHVuZGVmaW5lZCkgb3B0aW9ucy5wYXJzZSA9IHRydWU7CiAgICAgIHZhciBjb2xsZWN0aW9uID0gdGhpczsKICAgICAgdmFyIHN1Y2Nlc3MgPSBvcHRpb25zLnN1Y2Nlc3M7CgogICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbiAocmVzcCwgc3RhdHVzLCB4aHIpIHsKICAgICAgICBjb2xsZWN0aW9uW29wdGlvbnMuYWRkID8gJ2FkZCcgOiAncmVzZXQnXShjb2xsZWN0aW9uLnBhcnNlKHJlc3AsIHhociksIG9wdGlvbnMpOwogICAgICAgIGlmIChzdWNjZXNzKSBzdWNjZXNzKGNvbGxlY3Rpb24sIHJlc3ApOwogICAgICB9OwoKICAgICAgb3B0aW9ucy5lcnJvciA9IEJhY2tib25lLndyYXBFcnJvcihvcHRpb25zLmVycm9yLCBjb2xsZWN0aW9uLCBvcHRpb25zKTsKICAgICAgcmV0dXJuICh0aGlzLnN5bmMgfHwgQmFja2JvbmUuc3luYykuY2FsbCh0aGlzLCAncmVhZCcsIHRoaXMsIG9wdGlvbnMpOwogICAgfSwKICAgIC8vIENyZWF0ZSBhIG5ldyBpbnN0YW5jZSBvZiBhIG1vZGVsIGluIHRoaXMgY29sbGVjdGlvbi4gQWRkIHRoZSBtb2RlbCB0byB0aGUKICAgIC8vIGNvbGxlY3Rpb24gaW1tZWRpYXRlbHksIHVubGVzcyBgd2FpdDogdHJ1ZWAgaXMgcGFzc2VkLCBpbiB3aGljaCBjYXNlIHdlCiAgICAvLyB3YWl0IGZvciB0aGUgc2VydmVyIHRvIGFncmVlLgogICAgY3JlYXRlOiBmdW5jdGlvbiAobW9kZWwsIG9wdGlvbnMpIHsKICAgICAgdmFyIGNvbGwgPSB0aGlzOwogICAgICBvcHRpb25zID0gb3B0aW9ucyA/IF8uY2xvbmUob3B0aW9ucykgOiB7fTsKICAgICAgbW9kZWwgPSB0aGlzLl9wcmVwYXJlTW9kZWwobW9kZWwsIG9wdGlvbnMpOwogICAgICBpZiAoIW1vZGVsKSByZXR1cm4gZmFsc2U7CiAgICAgIGlmICghb3B0aW9ucy53YWl0KSBjb2xsLmFkZChtb2RlbCwgb3B0aW9ucyk7CiAgICAgIHZhciBzdWNjZXNzID0gb3B0aW9ucy5zdWNjZXNzOwoKICAgICAgb3B0aW9ucy5zdWNjZXNzID0gZnVuY3Rpb24gKG5leHRNb2RlbCwgcmVzcCwgeGhyKSB7CiAgICAgICAgaWYgKG9wdGlvbnMud2FpdCkgY29sbC5hZGQobmV4dE1vZGVsLCBvcHRpb25zKTsKCiAgICAgICAgaWYgKHN1Y2Nlc3MpIHsKICAgICAgICAgIHN1Y2Nlc3MobmV4dE1vZGVsLCByZXNwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbmV4dE1vZGVsLnRyaWdnZXIoJ3N5bmMnLCBtb2RlbCwgcmVzcCwgb3B0aW9ucyk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgbW9kZWwuc2F2ZShudWxsLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIG1vZGVsOwogICAgfSwKICAgIC8vICoqcGFyc2UqKiBjb252ZXJ0cyBhIHJlc3BvbnNlIGludG8gYSBsaXN0IG9mIG1vZGVscyB0byBiZSBhZGRlZCB0byB0aGUKICAgIC8vIGNvbGxlY3Rpb24uIFRoZSBkZWZhdWx0IGltcGxlbWVudGF0aW9uIGlzIGp1c3QgdG8gcGFzcyBpdCB0aHJvdWdoLgogICAgcGFyc2U6IGZ1bmN0aW9uIChyZXNwLCB4aHIpIHsKICAgICAgcmV0dXJuIHJlc3A7CiAgICB9LAogICAgLy8gUHJveHkgdG8gXydzIGNoYWluLiBDYW4ndCBiZSBwcm94aWVkIHRoZSBzYW1lIHdheSB0aGUgcmVzdCBvZiB0aGUKICAgIC8vIHVuZGVyc2NvcmUgbWV0aG9kcyBhcmUgcHJveGllZCBiZWNhdXNlIGl0IHJlbGllcyBvbiB0aGUgdW5kZXJzY29yZQogICAgLy8gY29uc3RydWN0b3IuCiAgICBjaGFpbjogZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gXyh0aGlzLm1vZGVscykuY2hhaW4oKTsKICAgIH0sCiAgICAvLyBSZXNldCBhbGwgaW50ZXJuYWwgc3RhdGUuIENhbGxlZCB3aGVuIHRoZSBjb2xsZWN0aW9uIGlzIHJlc2V0LgogICAgX3Jlc2V0OiBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICB0aGlzLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMubW9kZWxzID0gW107CiAgICAgIHRoaXMuX2J5SWQgPSB7fTsKICAgICAgdGhpcy5fYnlDaWQgPSB7fTsKICAgIH0sCiAgICAvLyBQcmVwYXJlIGEgbW9kZWwgb3IgaGFzaCBvZiBhdHRyaWJ1dGVzIHRvIGJlIGFkZGVkIHRvIHRoaXMgY29sbGVjdGlvbi4KICAgIF9wcmVwYXJlTW9kZWw6IGZ1bmN0aW9uIChtb2RlbCwgb3B0aW9ucykgewogICAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwoKICAgICAgaWYgKCEobW9kZWwgaW5zdGFuY2VvZiBNb2RlbCkpIHsKICAgICAgICB2YXIgYXR0cnMgPSBtb2RlbDsKICAgICAgICBvcHRpb25zLmNvbGxlY3Rpb24gPSB0aGlzOwogICAgICAgIG1vZGVsID0gbmV3IHRoaXMubW9kZWwoYXR0cnMsIG9wdGlvbnMpOwogICAgICAgIGlmICghbW9kZWwuX3ZhbGlkYXRlKG1vZGVsLmF0dHJpYnV0ZXMsIG9wdGlvbnMpKSBtb2RlbCA9IGZhbHNlOwogICAgICB9IGVsc2UgaWYgKCFtb2RlbC5jb2xsZWN0aW9uKSB7CiAgICAgICAgbW9kZWwuY29sbGVjdGlvbiA9IHRoaXM7CiAgICAgIH0KCiAgICAgIHJldHVybiBtb2RlbDsKICAgIH0sCiAgICAvLyBJbnRlcm5hbCBtZXRob2QgdG8gcmVtb3ZlIGEgbW9kZWwncyB0aWVzIHRvIGEgY29sbGVjdGlvbi4KICAgIF9yZW1vdmVSZWZlcmVuY2U6IGZ1bmN0aW9uIChtb2RlbCkgewogICAgICBpZiAodGhpcyA9PSBtb2RlbC5jb2xsZWN0aW9uKSB7CiAgICAgICAgZGVsZXRlIG1vZGVsLmNvbGxlY3Rpb247CiAgICAgIH0KCiAgICAgIG1vZGVsLm9mZignYWxsJywgdGhpcy5fb25Nb2RlbEV2ZW50LCB0aGlzKTsKICAgIH0sCiAgICAvLyBJbnRlcm5hbCBtZXRob2QgY2FsbGVkIGV2ZXJ5IHRpbWUgYSBtb2RlbCBpbiB0aGUgc2V0IGZpcmVzIGFuIGV2ZW50LgogICAgLy8gU2V0cyBuZWVkIHRvIHVwZGF0ZSB0aGVpciBpbmRleGVzIHdoZW4gbW9kZWxzIGNoYW5nZSBpZHMuIEFsbCBvdGhlcgogICAgLy8gZXZlbnRzIHNpbXBseSBwcm94eSB0aHJvdWdoLiAiYWRkIiBhbmQgInJlbW92ZSIgZXZlbnRzIHRoYXQgb3JpZ2luYXRlCiAgICAvLyBpbiBvdGhlciBjb2xsZWN0aW9ucyBhcmUgaWdub3JlZC4KICAgIF9vbk1vZGVsRXZlbnQ6IGZ1bmN0aW9uIChldmVudCwgbW9kZWwsIGNvbGxlY3Rpb24sIG9wdGlvbnMpIHsKICAgICAgaWYgKChldmVudCA9PSAnYWRkJyB8fCBldmVudCA9PSAncmVtb3ZlJykgJiYgY29sbGVjdGlvbiAhPSB0aGlzKSByZXR1cm47CgogICAgICBpZiAoZXZlbnQgPT0gJ2Rlc3Ryb3knKSB7CiAgICAgICAgdGhpcy5yZW1vdmUobW9kZWwsIG9wdGlvbnMpOwogICAgICB9CgogICAgICBpZiAobW9kZWwgJiYgZXZlbnQgPT09ICdjaGFuZ2U6JyArIG1vZGVsLmlkQXR0cmlidXRlKSB7CiAgICAgICAgZGVsZXRlIHRoaXMuX2J5SWRbbW9kZWwucHJldmlvdXMobW9kZWwuaWRBdHRyaWJ1dGUpXTsKICAgICAgICB0aGlzLl9ieUlkW21vZGVsLmlkXSA9IG1vZGVsOwogICAgICB9CgogICAgICB0aGlzLnRyaWdnZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH0KICB9KTsgLy8gVW5kZXJzY29yZSBtZXRob2RzIHRoYXQgd2Ugd2FudCB0byBpbXBsZW1lbnQgb24gdGhlIENvbGxlY3Rpb24uCgoKICB2YXIgbWV0aG9kcyA9IFsnZm9yRWFjaCcsICdlYWNoJywgJ21hcCcsICdyZWR1Y2UnLCAncmVkdWNlUmlnaHQnLCAnZmluZCcsICdkZXRlY3QnLCAnZmlsdGVyJywgJ3NlbGVjdCcsICdyZWplY3QnLCAnZXZlcnknLCAnYWxsJywgJ3NvbWUnLCAnYW55JywgJ2luY2x1ZGUnLCAnY29udGFpbnMnLCAnaW52b2tlJywgJ21heCcsICdtaW4nLCAnc29ydEJ5JywgJ3NvcnRlZEluZGV4JywgJ3RvQXJyYXknLCAnc2l6ZScsICdmaXJzdCcsICdpbml0aWFsJywgJ3Jlc3QnLCAnbGFzdCcsICd3aXRob3V0JywgJ2luZGV4T2YnLCAnc2h1ZmZsZScsICdsYXN0SW5kZXhPZicsICdpc0VtcHR5JywgJ2dyb3VwQnknXTsgLy8gTWl4IGluIGVhY2ggVW5kZXJzY29yZSBtZXRob2QgYXMgYSBwcm94eSB0byBgQ29sbGVjdGlvbiNtb2RlbHNgLgoKICBfLmVhY2gobWV0aG9kcywgZnVuY3Rpb24gKG1ldGhvZCkgewogICAgQ29sbGVjdGlvbi5wcm90b3R5cGVbbWV0aG9kXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIF9bbWV0aG9kXS5hcHBseShfLCBbdGhpcy5tb2RlbHNdLmNvbmNhdChfLnRvQXJyYXkoYXJndW1lbnRzKSkpOwogICAgfTsKICB9KTsgLy8gQmFja2JvbmUuUm91dGVyCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLQogIC8vIFJvdXRlcnMgbWFwIGZhdXgtVVJMcyB0byBhY3Rpb25zLCBhbmQgZmlyZSBldmVudHMgd2hlbiByb3V0ZXMgYXJlCiAgLy8gbWF0Y2hlZC4gQ3JlYXRpbmcgYSBuZXcgb25lIHNldHMgaXRzIGByb3V0ZXNgIGhhc2gsIGlmIG5vdCBzZXQgc3RhdGljYWxseS4KCgogIHZhciBSb3V0ZXIgPSBCYWNrYm9uZS5Sb3V0ZXIgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgIGlmIChvcHRpb25zLnJvdXRlcykgdGhpcy5yb3V0ZXMgPSBvcHRpb25zLnJvdXRlczsKCiAgICB0aGlzLl9iaW5kUm91dGVzKCk7CgogICAgdGhpcy5pbml0aWFsaXplLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsgLy8gQ2FjaGVkIHJlZ3VsYXIgZXhwcmVzc2lvbnMgZm9yIG1hdGNoaW5nIG5hbWVkIHBhcmFtIHBhcnRzIGFuZCBzcGxhdHRlZAogIC8vIHBhcnRzIG9mIHJvdXRlIHN0cmluZ3MuCgoKICB2YXIgbmFtZWRQYXJhbSA9IC86XHcrL2c7CiAgdmFyIHNwbGF0UGFyYW0gPSAvXCpcdysvZzsKICB2YXIgZXNjYXBlUmVnRXhwID0gL1stW1xde30oKSs/LixcXF4kfCNcc10vZzsgLy8gU2V0IHVwIGFsbCBpbmhlcml0YWJsZSAqKkJhY2tib25lLlJvdXRlcioqIHByb3BlcnRpZXMgYW5kIG1ldGhvZHMuCgogIF8uZXh0ZW5kKFJvdXRlci5wcm90b3R5cGUsIEV2ZW50cywgewogICAgLy8gSW5pdGlhbGl6ZSBpcyBhbiBlbXB0eSBmdW5jdGlvbiBieSBkZWZhdWx0LiBPdmVycmlkZSBpdCB3aXRoIHlvdXIgb3duCiAgICAvLyBpbml0aWFsaXphdGlvbiBsb2dpYy4KICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uICgpIHt9LAogICAgLy8gTWFudWFsbHkgYmluZCBhIHNpbmdsZSBuYW1lZCByb3V0ZSB0byBhIGNhbGxiYWNrLiBGb3IgZXhhbXBsZToKICAgIC8vCiAgICAvLyAgICAgdGhpcy5yb3V0ZSgnc2VhcmNoLzpxdWVyeS9wOm51bScsICdzZWFyY2gnLCBmdW5jdGlvbihxdWVyeSwgbnVtKSB7CiAgICAvLyAgICAgICAuLi4KICAgIC8vICAgICB9KTsKICAgIC8vCiAgICByb3V0ZTogZnVuY3Rpb24gKHJvdXRlLCBuYW1lLCBjYWxsYmFjaykgewogICAgICBCYWNrYm9uZS5oaXN0b3J5IHx8IChCYWNrYm9uZS5oaXN0b3J5ID0gbmV3IEhpc3RvcnkoKSk7CiAgICAgIGlmICghXy5pc1JlZ0V4cChyb3V0ZSkpIHJvdXRlID0gdGhpcy5fcm91dGVUb1JlZ0V4cChyb3V0ZSk7CiAgICAgIGlmICghY2FsbGJhY2spIGNhbGxiYWNrID0gdGhpc1tuYW1lXTsKICAgICAgQmFja2JvbmUuaGlzdG9yeS5yb3V0ZShyb3V0ZSwgXy5iaW5kKGZ1bmN0aW9uIChmcmFnbWVudCkgewogICAgICAgIHZhciBhcmdzID0gdGhpcy5fZXh0cmFjdFBhcmFtZXRlcnMocm91dGUsIGZyYWdtZW50KTsKCiAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2suYXBwbHkodGhpcywgYXJncyk7CiAgICAgICAgdGhpcy50cmlnZ2VyLmFwcGx5KHRoaXMsIFsncm91dGU6JyArIG5hbWVdLmNvbmNhdChhcmdzKSk7CiAgICAgICAgQmFja2JvbmUuaGlzdG9yeS50cmlnZ2VyKCdyb3V0ZScsIHRoaXMsIG5hbWUsIGFyZ3MpOwogICAgICB9LCB0aGlzKSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKICAgIC8vIFNpbXBsZSBwcm94eSB0byBgQmFja2JvbmUuaGlzdG9yeWAgdG8gc2F2ZSBhIGZyYWdtZW50IGludG8gdGhlIGhpc3RvcnkuCiAgICBuYXZpZ2F0ZTogZnVuY3Rpb24gKGZyYWdtZW50LCBvcHRpb25zKSB7CiAgICAgIEJhY2tib25lLmhpc3RvcnkubmF2aWdhdGUoZnJhZ21lbnQsIG9wdGlvbnMpOwogICAgfSwKICAgIC8vIEJpbmQgYWxsIGRlZmluZWQgcm91dGVzIHRvIGBCYWNrYm9uZS5oaXN0b3J5YC4gV2UgaGF2ZSB0byByZXZlcnNlIHRoZQogICAgLy8gb3JkZXIgb2YgdGhlIHJvdXRlcyBoZXJlIHRvIHN1cHBvcnQgYmVoYXZpb3Igd2hlcmUgdGhlIG1vc3QgZ2VuZXJhbAogICAgLy8gcm91dGVzIGNhbiBiZSBkZWZpbmVkIGF0IHRoZSBib3R0b20gb2YgdGhlIHJvdXRlIG1hcC4KICAgIF9iaW5kUm91dGVzOiBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICghdGhpcy5yb3V0ZXMpIHJldHVybjsKICAgICAgdmFyIHJvdXRlcyA9IFtdOwoKICAgICAgZm9yICh2YXIgcm91dGUgaW4gdGhpcy5yb3V0ZXMpIHsKICAgICAgICByb3V0ZXMudW5zaGlmdChbcm91dGUsIHRoaXMucm91dGVzW3JvdXRlXV0pOwogICAgICB9CgogICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHJvdXRlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICB0aGlzLnJvdXRlKHJvdXRlc1tpXVswXSwgcm91dGVzW2ldWzFdLCB0aGlzW3JvdXRlc1tpXVsxXV0pOwogICAgICB9CiAgICB9LAogICAgLy8gQ29udmVydCBhIHJvdXRlIHN0cmluZyBpbnRvIGEgcmVndWxhciBleHByZXNzaW9uLCBzdWl0YWJsZSBmb3IgbWF0Y2hpbmcKICAgIC8vIGFnYWluc3QgdGhlIGN1cnJlbnQgbG9jYXRpb24gaGFzaC4KICAgIF9yb3V0ZVRvUmVnRXhwOiBmdW5jdGlvbiAocm91dGUpIHsKICAgICAgcm91dGUgPSByb3V0ZS5yZXBsYWNlKGVzY2FwZVJlZ0V4cCwgJ1xcJCYnKS5yZXBsYWNlKG5hbWVkUGFyYW0sICcoW15cL10rKScpLnJlcGxhY2Uoc3BsYXRQYXJhbSwgJyguKj8pJyk7CiAgICAgIHJldHVybiBuZXcgUmVnRXhwKCdeJyArIHJvdXRlICsgJyQnKTsKICAgIH0sCiAgICAvLyBHaXZlbiBhIHJvdXRlLCBhbmQgYSBVUkwgZnJhZ21lbnQgdGhhdCBpdCBtYXRjaGVzLCByZXR1cm4gdGhlIGFycmF5IG9mCiAgICAvLyBleHRyYWN0ZWQgcGFyYW1ldGVycy4KICAgIF9leHRyYWN0UGFyYW1ldGVyczogZnVuY3Rpb24gKHJvdXRlLCBmcmFnbWVudCkgewogICAgICByZXR1cm4gcm91dGUuZXhlYyhmcmFnbWVudCkuc2xpY2UoMSk7CiAgICB9CiAgfSk7IC8vIEJhY2tib25lLkhpc3RvcnkKICAvLyAtLS0tLS0tLS0tLS0tLS0tCiAgLy8gSGFuZGxlcyBjcm9zcy1icm93c2VyIGhpc3RvcnkgbWFuYWdlbWVudCwgYmFzZWQgb24gVVJMIGZyYWdtZW50cy4gSWYgdGhlCiAgLy8gYnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IGBvbmhhc2hjaGFuZ2VgLCBmYWxscyBiYWNrIHRvIHBvbGxpbmcuCgoKICB2YXIgSGlzdG9yeSA9IEJhY2tib25lLkhpc3RvcnkgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmhhbmRsZXJzID0gW107CgogICAgXy5iaW5kQWxsKHRoaXMsICdjaGVja1VybCcpOwogIH07IC8vIENhY2hlZCByZWdleCBmb3IgY2xlYW5pbmcgbGVhZGluZyBoYXNoZXMgYW5kIHNsYXNoZXMgLgoKCiAgdmFyIHJvdXRlU3RyaXBwZXIgPSAvXlsjXC9dLzsgLy8gQ2FjaGVkIHJlZ2V4IGZvciBkZXRlY3RpbmcgTVNJRS4KCiAgdmFyIGlzRXhwbG9yZXIgPSAvbXNpZSBbXHcuXSsvOyAvLyBIYXMgdGhlIGhpc3RvcnkgaGFuZGxpbmcgYWxyZWFkeSBiZWVuIHN0YXJ0ZWQ/CgogIEhpc3Rvcnkuc3RhcnRlZCA9IGZhbHNlOyAvLyBTZXQgdXAgYWxsIGluaGVyaXRhYmxlICoqQmFja2JvbmUuSGlzdG9yeSoqIHByb3BlcnRpZXMgYW5kIG1ldGhvZHMuCgogIF8uZXh0ZW5kKEhpc3RvcnkucHJvdG90eXBlLCBFdmVudHMsIHsKICAgIC8vIFRoZSBkZWZhdWx0IGludGVydmFsIHRvIHBvbGwgZm9yIGhhc2ggY2hhbmdlcywgaWYgbmVjZXNzYXJ5LCBpcwogICAgLy8gdHdlbnR5IHRpbWVzIGEgc2Vjb25kLgogICAgaW50ZXJ2YWw6IDUwLAogICAgLy8gR2V0cyB0aGUgdHJ1ZSBoYXNoIHZhbHVlLiBDYW5ub3QgdXNlIGxvY2F0aW9uLmhhc2ggZGlyZWN0bHkgZHVlIHRvIGJ1ZwogICAgLy8gaW4gRmlyZWZveCB3aGVyZSBsb2NhdGlvbi5oYXNoIHdpbGwgYWx3YXlzIGJlIGRlY29kZWQuCiAgICBnZXRIYXNoOiBmdW5jdGlvbiAod2luZG93T3ZlcnJpZGUpIHsKICAgICAgdmFyIGxvYyA9IHdpbmRvd092ZXJyaWRlID8gd2luZG93T3ZlcnJpZGUubG9jYXRpb24gOiB3aW5kb3cubG9jYXRpb247CiAgICAgIHZhciBtYXRjaCA9IGxvYy5ocmVmLm1hdGNoKC8jKC4qKSQvKTsKICAgICAgcmV0dXJuIG1hdGNoID8gbWF0Y2hbMV0gOiAnJzsKICAgIH0sCiAgICAvLyBHZXQgdGhlIGNyb3NzLWJyb3dzZXIgbm9ybWFsaXplZCBVUkwgZnJhZ21lbnQsIGVpdGhlciBmcm9tIHRoZSBVUkwsCiAgICAvLyB0aGUgaGFzaCwgb3IgdGhlIG92ZXJyaWRlLgogICAgZ2V0RnJhZ21lbnQ6IGZ1bmN0aW9uIChmcmFnbWVudCwgZm9yY2VQdXNoU3RhdGUpIHsKICAgICAgaWYgKGZyYWdtZW50ID09IG51bGwpIHsKICAgICAgICBpZiAodGhpcy5faGFzUHVzaFN0YXRlIHx8IGZvcmNlUHVzaFN0YXRlKSB7CiAgICAgICAgICBmcmFnbWVudCA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZTsKICAgICAgICAgIHZhciBzZWFyY2ggPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoOwogICAgICAgICAgaWYgKHNlYXJjaCkgZnJhZ21lbnQgKz0gc2VhcmNoOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmcmFnbWVudCA9IHRoaXMuZ2V0SGFzaCgpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKCFmcmFnbWVudC5pbmRleE9mKHRoaXMub3B0aW9ucy5yb290KSkgZnJhZ21lbnQgPSBmcmFnbWVudC5zdWJzdHIodGhpcy5vcHRpb25zLnJvb3QubGVuZ3RoKTsKICAgICAgcmV0dXJuIGZyYWdtZW50LnJlcGxhY2Uocm91dGVTdHJpcHBlciwgJycpOwogICAgfSwKICAgIC8vIFN0YXJ0IHRoZSBoYXNoIGNoYW5nZSBoYW5kbGluZywgcmV0dXJuaW5nIGB0cnVlYCBpZiB0aGUgY3VycmVudCBVUkwgbWF0Y2hlcwogICAgLy8gYW4gZXhpc3Rpbmcgcm91dGUsIGFuZCBgZmFsc2VgIG90aGVyd2lzZS4KICAgIHN0YXJ0OiBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICBpZiAoSGlzdG9yeS5zdGFydGVkKSB0aHJvdyBuZXcgRXJyb3IoIkJhY2tib25lLmhpc3RvcnkgaGFzIGFscmVhZHkgYmVlbiBzdGFydGVkIik7CiAgICAgIEhpc3Rvcnkuc3RhcnRlZCA9IHRydWU7IC8vIEZpZ3VyZSBvdXQgdGhlIGluaXRpYWwgY29uZmlndXJhdGlvbi4gRG8gd2UgbmVlZCBhbiBpZnJhbWU/CiAgICAgIC8vIElzIHB1c2hTdGF0ZSBkZXNpcmVkIC4uLiBpcyBpdCBhdmFpbGFibGU/CgogICAgICB0aGlzLm9wdGlvbnMgPSBfLmV4dGVuZCh7fSwgewogICAgICAgIHJvb3Q6ICcvJwogICAgICB9LCB0aGlzLm9wdGlvbnMsIG9wdGlvbnMpOwogICAgICB0aGlzLl93YW50c0hhc2hDaGFuZ2UgPSB0aGlzLm9wdGlvbnMuaGFzaENoYW5nZSAhPT0gZmFsc2U7CiAgICAgIHRoaXMuX3dhbnRzUHVzaFN0YXRlID0gISF0aGlzLm9wdGlvbnMucHVzaFN0YXRlOwogICAgICB0aGlzLl9oYXNQdXNoU3RhdGUgPSAhISh0aGlzLm9wdGlvbnMucHVzaFN0YXRlICYmIHdpbmRvdy5oaXN0b3J5ICYmIHdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZSk7CiAgICAgIHZhciBmcmFnbWVudCA9IHRoaXMuZ2V0RnJhZ21lbnQoKTsKICAgICAgdmFyIGRvY01vZGUgPSBkb2N1bWVudC5kb2N1bWVudE1vZGU7CiAgICAgIHZhciBvbGRJRSA9IGlzRXhwbG9yZXIuZXhlYyhuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkpICYmICghZG9jTW9kZSB8fCBkb2NNb2RlIDw9IDcpOwoKICAgICAgaWYgKG9sZElFKSB7CiAgICAgICAgdGhpcy5pZnJhbWUgPSAkKCc8aWZyYW1lIHNyYz0iamF2YXNjcmlwdDowIiB0YWJpbmRleD0iLTEiIC8+JykuaGlkZSgpLmFwcGVuZFRvKCdib2R5JylbMF0uY29udGVudFdpbmRvdzsKICAgICAgICB0aGlzLm5hdmlnYXRlKGZyYWdtZW50KTsKICAgICAgfSAvLyBEZXBlbmRpbmcgb24gd2hldGhlciB3ZSdyZSB1c2luZyBwdXNoU3RhdGUgb3IgaGFzaGVzLCBhbmQgd2hldGhlcgogICAgICAvLyAnb25oYXNoY2hhbmdlJyBpcyBzdXBwb3J0ZWQsIGRldGVybWluZSBob3cgd2UgY2hlY2sgdGhlIFVSTCBzdGF0ZS4KCgogICAgICBpZiAodGhpcy5faGFzUHVzaFN0YXRlKSB7CiAgICAgICAgJCh3aW5kb3cpLmJpbmQoJ3BvcHN0YXRlJywgdGhpcy5jaGVja1VybCk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5fd2FudHNIYXNoQ2hhbmdlICYmICdvbmhhc2hjaGFuZ2UnIGluIHdpbmRvdyAmJiAhb2xkSUUpIHsKICAgICAgICAkKHdpbmRvdykuYmluZCgnaGFzaGNoYW5nZScsIHRoaXMuY2hlY2tVcmwpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuX3dhbnRzSGFzaENoYW5nZSkgewogICAgICAgIHRoaXMuX2NoZWNrVXJsSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCh0aGlzLmNoZWNrVXJsLCB0aGlzLmludGVydmFsKTsKICAgICAgfSAvLyBEZXRlcm1pbmUgaWYgd2UgbmVlZCB0byBjaGFuZ2UgdGhlIGJhc2UgdXJsLCBmb3IgYSBwdXNoU3RhdGUgbGluawogICAgICAvLyBvcGVuZWQgYnkgYSBub24tcHVzaFN0YXRlIGJyb3dzZXIuCgoKICAgICAgdGhpcy5mcmFnbWVudCA9IGZyYWdtZW50OwogICAgICB2YXIgbG9jID0gd2luZG93LmxvY2F0aW9uOwogICAgICB2YXIgYXRSb290ID0gbG9jLnBhdGhuYW1lID09IHRoaXMub3B0aW9ucy5yb290OyAvLyBJZiB3ZSd2ZSBzdGFydGVkIG9mZiB3aXRoIGEgcm91dGUgZnJvbSBhIGBwdXNoU3RhdGVgLWVuYWJsZWQgYnJvd3NlciwKICAgICAgLy8gYnV0IHdlJ3JlIGN1cnJlbnRseSBpbiBhIGJyb3dzZXIgdGhhdCBkb2Vzbid0IHN1cHBvcnQgaXQuLi4KCiAgICAgIGlmICh0aGlzLl93YW50c0hhc2hDaGFuZ2UgJiYgdGhpcy5fd2FudHNQdXNoU3RhdGUgJiYgIXRoaXMuX2hhc1B1c2hTdGF0ZSAmJiAhYXRSb290KSB7CiAgICAgICAgdGhpcy5mcmFnbWVudCA9IHRoaXMuZ2V0RnJhZ21lbnQobnVsbCwgdHJ1ZSk7CiAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlcGxhY2UodGhpcy5vcHRpb25zLnJvb3QgKyAnIycgKyB0aGlzLmZyYWdtZW50KTsgLy8gUmV0dXJuIGltbWVkaWF0ZWx5IGFzIGJyb3dzZXIgd2lsbCBkbyByZWRpcmVjdCB0byBuZXcgdXJsCgogICAgICAgIHJldHVybiB0cnVlOyAvLyBPciBpZiB3ZSd2ZSBzdGFydGVkIG91dCB3aXRoIGEgaGFzaC1iYXNlZCByb3V0ZSwgYnV0IHdlJ3JlIGN1cnJlbnRseQogICAgICAgIC8vIGluIGEgYnJvd3NlciB3aGVyZSBpdCBjb3VsZCBiZSBgcHVzaFN0YXRlYC1iYXNlZCBpbnN0ZWFkLi4uCiAgICAgIH0gZWxzZSBpZiAodGhpcy5fd2FudHNQdXNoU3RhdGUgJiYgdGhpcy5faGFzUHVzaFN0YXRlICYmIGF0Um9vdCAmJiBsb2MuaGFzaCkgewogICAgICAgIHRoaXMuZnJhZ21lbnQgPSB0aGlzLmdldEhhc2goKS5yZXBsYWNlKHJvdXRlU3RyaXBwZXIsICcnKTsKICAgICAgICB3aW5kb3cuaGlzdG9yeS5yZXBsYWNlU3RhdGUoe30sIGRvY3VtZW50LnRpdGxlLCBsb2MucHJvdG9jb2wgKyAnLy8nICsgbG9jLmhvc3QgKyB0aGlzLm9wdGlvbnMucm9vdCArIHRoaXMuZnJhZ21lbnQpOwogICAgICB9CgogICAgICBpZiAoIXRoaXMub3B0aW9ucy5zaWxlbnQpIHsKICAgICAgICByZXR1cm4gdGhpcy5sb2FkVXJsKCk7CiAgICAgIH0KICAgIH0sCiAgICAvLyBEaXNhYmxlIEJhY2tib25lLmhpc3RvcnksIHBlcmhhcHMgdGVtcG9yYXJpbHkuIE5vdCB1c2VmdWwgaW4gYSByZWFsIGFwcCwKICAgIC8vIGJ1dCBwb3NzaWJseSB1c2VmdWwgZm9yIHVuaXQgdGVzdGluZyBSb3V0ZXJzLgogICAgc3RvcDogZnVuY3Rpb24gKCkgewogICAgICAkKHdpbmRvdykudW5iaW5kKCdwb3BzdGF0ZScsIHRoaXMuY2hlY2tVcmwpLnVuYmluZCgnaGFzaGNoYW5nZScsIHRoaXMuY2hlY2tVcmwpOwogICAgICBjbGVhckludGVydmFsKHRoaXMuX2NoZWNrVXJsSW50ZXJ2YWwpOwogICAgICBIaXN0b3J5LnN0YXJ0ZWQgPSBmYWxzZTsKICAgIH0sCiAgICAvLyBBZGQgYSByb3V0ZSB0byBiZSB0ZXN0ZWQgd2hlbiB0aGUgZnJhZ21lbnQgY2hhbmdlcy4gUm91dGVzIGFkZGVkIGxhdGVyCiAgICAvLyBtYXkgb3ZlcnJpZGUgcHJldmlvdXMgcm91dGVzLgogICAgcm91dGU6IGZ1bmN0aW9uIChyb3V0ZSwgY2FsbGJhY2spIHsKICAgICAgdGhpcy5oYW5kbGVycy51bnNoaWZ0KHsKICAgICAgICByb3V0ZTogcm91dGUsCiAgICAgICAgY2FsbGJhY2s6IGNhbGxiYWNrCiAgICAgIH0pOwogICAgfSwKICAgIC8vIENoZWNrcyB0aGUgY3VycmVudCBVUkwgdG8gc2VlIGlmIGl0IGhhcyBjaGFuZ2VkLCBhbmQgaWYgaXQgaGFzLAogICAgLy8gY2FsbHMgYGxvYWRVcmxgLCBub3JtYWxpemluZyBhY3Jvc3MgdGhlIGhpZGRlbiBpZnJhbWUuCiAgICBjaGVja1VybDogZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIGN1cnJlbnQgPSB0aGlzLmdldEZyYWdtZW50KCk7CiAgICAgIGlmIChjdXJyZW50ID09IHRoaXMuZnJhZ21lbnQgJiYgdGhpcy5pZnJhbWUpIGN1cnJlbnQgPSB0aGlzLmdldEZyYWdtZW50KHRoaXMuZ2V0SGFzaCh0aGlzLmlmcmFtZSkpOwogICAgICBpZiAoY3VycmVudCA9PSB0aGlzLmZyYWdtZW50KSByZXR1cm4gZmFsc2U7CiAgICAgIGlmICh0aGlzLmlmcmFtZSkgdGhpcy5uYXZpZ2F0ZShjdXJyZW50KTsKICAgICAgdGhpcy5sb2FkVXJsKCkgfHwgdGhpcy5sb2FkVXJsKHRoaXMuZ2V0SGFzaCgpKTsKICAgIH0sCiAgICAvLyBBdHRlbXB0IHRvIGxvYWQgdGhlIGN1cnJlbnQgVVJMIGZyYWdtZW50LiBJZiBhIHJvdXRlIHN1Y2NlZWRzIHdpdGggYQogICAgLy8gbWF0Y2gsIHJldHVybnMgYHRydWVgLiBJZiBubyBkZWZpbmVkIHJvdXRlcyBtYXRjaGVzIHRoZSBmcmFnbWVudCwKICAgIC8vIHJldHVybnMgYGZhbHNlYC4KICAgIGxvYWRVcmw6IGZ1bmN0aW9uIChmcmFnbWVudE92ZXJyaWRlKSB7CiAgICAgIHZhciBmcmFnbWVudCA9IHRoaXMuZnJhZ21lbnQgPSB0aGlzLmdldEZyYWdtZW50KGZyYWdtZW50T3ZlcnJpZGUpOwoKICAgICAgdmFyIG1hdGNoZWQgPSBfLmFueSh0aGlzLmhhbmRsZXJzLCBmdW5jdGlvbiAoaGFuZGxlcikgewogICAgICAgIGlmIChoYW5kbGVyLnJvdXRlLnRlc3QoZnJhZ21lbnQpKSB7CiAgICAgICAgICBoYW5kbGVyLmNhbGxiYWNrKGZyYWdtZW50KTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICByZXR1cm4gbWF0Y2hlZDsKICAgIH0sCiAgICAvLyBTYXZlIGEgZnJhZ21lbnQgaW50byB0aGUgaGFzaCBoaXN0b3J5LCBvciByZXBsYWNlIHRoZSBVUkwgc3RhdGUgaWYgdGhlCiAgICAvLyAncmVwbGFjZScgb3B0aW9uIGlzIHBhc3NlZC4gWW91IGFyZSByZXNwb25zaWJsZSBmb3IgcHJvcGVybHkgVVJMLWVuY29kaW5nCiAgICAvLyB0aGUgZnJhZ21lbnQgaW4gYWR2YW5jZS4KICAgIC8vCiAgICAvLyBUaGUgb3B0aW9ucyBvYmplY3QgY2FuIGNvbnRhaW4gYHRyaWdnZXI6IHRydWVgIGlmIHlvdSB3aXNoIHRvIGhhdmUgdGhlCiAgICAvLyByb3V0ZSBjYWxsYmFjayBiZSBmaXJlZCAobm90IHVzdWFsbHkgZGVzaXJhYmxlKSwgb3IgYHJlcGxhY2U6IHRydWVgLCBpZgogICAgLy8geW91IHdpc2ggdG8gbW9kaWZ5IHRoZSBjdXJyZW50IFVSTCB3aXRob3V0IGFkZGluZyBhbiBlbnRyeSB0byB0aGUgaGlzdG9yeS4KICAgIG5hdmlnYXRlOiBmdW5jdGlvbiAoZnJhZ21lbnQsIG9wdGlvbnMpIHsKICAgICAgaWYgKCFIaXN0b3J5LnN0YXJ0ZWQpIHJldHVybiBmYWxzZTsKICAgICAgaWYgKCFvcHRpb25zIHx8IG9wdGlvbnMgPT09IHRydWUpIG9wdGlvbnMgPSB7CiAgICAgICAgdHJpZ2dlcjogb3B0aW9ucwogICAgICB9OwogICAgICB2YXIgZnJhZyA9IChmcmFnbWVudCB8fCAnJykucmVwbGFjZShyb3V0ZVN0cmlwcGVyLCAnJyk7CiAgICAgIGlmICh0aGlzLmZyYWdtZW50ID09IGZyYWcpIHJldHVybjsgLy8gSWYgcHVzaFN0YXRlIGlzIGF2YWlsYWJsZSwgd2UgdXNlIGl0IHRvIHNldCB0aGUgZnJhZ21lbnQgYXMgYSByZWFsIFVSTC4KCiAgICAgIGlmICh0aGlzLl9oYXNQdXNoU3RhdGUpIHsKICAgICAgICBpZiAoZnJhZy5pbmRleE9mKHRoaXMub3B0aW9ucy5yb290KSAhPSAwKSBmcmFnID0gdGhpcy5vcHRpb25zLnJvb3QgKyBmcmFnOwogICAgICAgIHRoaXMuZnJhZ21lbnQgPSBmcmFnOwogICAgICAgIHdpbmRvdy5oaXN0b3J5W29wdGlvbnMucmVwbGFjZSA/ICdyZXBsYWNlU3RhdGUnIDogJ3B1c2hTdGF0ZSddKHt9LCBkb2N1bWVudC50aXRsZSwgZnJhZyk7IC8vIElmIGhhc2ggY2hhbmdlcyBoYXZlbid0IGJlZW4gZXhwbGljaXRseSBkaXNhYmxlZCwgdXBkYXRlIHRoZSBoYXNoCiAgICAgICAgLy8gZnJhZ21lbnQgdG8gc3RvcmUgaGlzdG9yeS4KICAgICAgfSBlbHNlIGlmICh0aGlzLl93YW50c0hhc2hDaGFuZ2UpIHsKICAgICAgICB0aGlzLmZyYWdtZW50ID0gZnJhZzsKCiAgICAgICAgdGhpcy5fdXBkYXRlSGFzaCh3aW5kb3cubG9jYXRpb24sIGZyYWcsIG9wdGlvbnMucmVwbGFjZSk7CgogICAgICAgIGlmICh0aGlzLmlmcmFtZSAmJiBmcmFnICE9IHRoaXMuZ2V0RnJhZ21lbnQodGhpcy5nZXRIYXNoKHRoaXMuaWZyYW1lKSkpIHsKICAgICAgICAgIC8vIE9wZW5pbmcgYW5kIGNsb3NpbmcgdGhlIGlmcmFtZSB0cmlja3MgSUU3IGFuZCBlYXJsaWVyIHRvIHB1c2ggYSBoaXN0b3J5IGVudHJ5IG9uIGhhc2gtdGFnIGNoYW5nZS4KICAgICAgICAgIC8vIFdoZW4gcmVwbGFjZSBpcyB0cnVlLCB3ZSBkb24ndCB3YW50IHRoaXMuCiAgICAgICAgICBpZiAoIW9wdGlvbnMucmVwbGFjZSkgdGhpcy5pZnJhbWUuZG9jdW1lbnQub3BlbigpLmNsb3NlKCk7CgogICAgICAgICAgdGhpcy5fdXBkYXRlSGFzaCh0aGlzLmlmcmFtZS5sb2NhdGlvbiwgZnJhZywgb3B0aW9ucy5yZXBsYWNlKTsKICAgICAgICB9IC8vIElmIHlvdSd2ZSB0b2xkIHVzIHRoYXQgeW91IGV4cGxpY2l0bHkgZG9uJ3Qgd2FudCBmYWxsYmFjayBoYXNoY2hhbmdlLQogICAgICAgIC8vIGJhc2VkIGhpc3RvcnksIHRoZW4gYG5hdmlnYXRlYCBiZWNvbWVzIGEgcGFnZSByZWZyZXNoLgoKICAgICAgfSBlbHNlIHsKICAgICAgICB3aW5kb3cubG9jYXRpb24uYXNzaWduKHRoaXMub3B0aW9ucy5yb290ICsgZnJhZ21lbnQpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy50cmlnZ2VyKSB0aGlzLmxvYWRVcmwoZnJhZ21lbnQpOwogICAgfSwKICAgIC8vIFVwZGF0ZSB0aGUgaGFzaCBsb2NhdGlvbiwgZWl0aGVyIHJlcGxhY2luZyB0aGUgY3VycmVudCBlbnRyeSwgb3IgYWRkaW5nCiAgICAvLyBhIG5ldyBvbmUgdG8gdGhlIGJyb3dzZXIgaGlzdG9yeS4KICAgIF91cGRhdGVIYXNoOiBmdW5jdGlvbiAobG9jYXRpb24sIGZyYWdtZW50LCByZXBsYWNlKSB7CiAgICAgIGlmIChyZXBsYWNlKSB7CiAgICAgICAgbG9jYXRpb24ucmVwbGFjZShsb2NhdGlvbi50b1N0cmluZygpLnJlcGxhY2UoLyhqYXZhc2NyaXB0OnwjKS4qJC8sICcnKSArICcjJyArIGZyYWdtZW50KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBsb2NhdGlvbi5oYXNoID0gZnJhZ21lbnQ7CiAgICAgIH0KICAgIH0KICB9KTsgLy8gQmFja2JvbmUuVmlldwogIC8vIC0tLS0tLS0tLS0tLS0KICAvLyBDcmVhdGluZyBhIEJhY2tib25lLlZpZXcgY3JlYXRlcyBpdHMgaW5pdGlhbCBlbGVtZW50IG91dHNpZGUgb2YgdGhlIERPTSwKICAvLyBpZiBhbiBleGlzdGluZyBlbGVtZW50IGlzIG5vdCBwcm92aWRlZC4uLgoKCiAgdmFyIFZpZXcgPSBCYWNrYm9uZS5WaWV3ID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgIHRoaXMuY2lkID0gXy51bmlxdWVJZCgndmlldycpOwoKICAgIHRoaXMuX2NvbmZpZ3VyZShvcHRpb25zIHx8IHt9KTsKCiAgICB0aGlzLl9lbnN1cmVFbGVtZW50KCk7CgogICAgdGhpcy5pbml0aWFsaXplLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB0aGlzLmRlbGVnYXRlRXZlbnRzKCk7CiAgfTsgLy8gQ2FjaGVkIHJlZ2V4IHRvIHNwbGl0IGtleXMgZm9yIGBkZWxlZ2F0ZWAuCgoKICB2YXIgZGVsZWdhdGVFdmVudFNwbGl0dGVyID0gL14oXFMrKVxzKiguKikkLzsgLy8gTGlzdCBvZiB2aWV3IG9wdGlvbnMgdG8gYmUgbWVyZ2VkIGFzIHByb3BlcnRpZXMuCgogIHZhciB2aWV3T3B0aW9ucyA9IFsnbW9kZWwnLCAnY29sbGVjdGlvbicsICdlbCcsICdpZCcsICdhdHRyaWJ1dGVzJywgJ2NsYXNzTmFtZScsICd0YWdOYW1lJ107IC8vIFNldCB1cCBhbGwgaW5oZXJpdGFibGUgKipCYWNrYm9uZS5WaWV3KiogcHJvcGVydGllcyBhbmQgbWV0aG9kcy4KCiAgXy5leHRlbmQoVmlldy5wcm90b3R5cGUsIEV2ZW50cywgewogICAgLy8gVGhlIGRlZmF1bHQgYHRhZ05hbWVgIG9mIGEgVmlldydzIGVsZW1lbnQgaXMgYCJkaXYiYC4KICAgIHRhZ05hbWU6ICdkaXYnLAogICAgLy8galF1ZXJ5IGRlbGVnYXRlIGZvciBlbGVtZW50IGxvb2t1cCwgc2NvcGVkIHRvIERPTSBlbGVtZW50cyB3aXRoaW4gdGhlCiAgICAvLyBjdXJyZW50IHZpZXcuIFRoaXMgc2hvdWxkIGJlIHByZWZlcmVkIHRvIGdsb2JhbCBsb29rdXBzIHdoZXJlIHBvc3NpYmxlLgogICAgJDogZnVuY3Rpb24gKHNlbGVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLiRlbC5maW5kKHNlbGVjdG9yKTsKICAgIH0sCiAgICAvLyBJbml0aWFsaXplIGlzIGFuIGVtcHR5IGZ1bmN0aW9uIGJ5IGRlZmF1bHQuIE92ZXJyaWRlIGl0IHdpdGggeW91ciBvd24KICAgIC8vIGluaXRpYWxpemF0aW9uIGxvZ2ljLgogICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkge30sCiAgICAvLyAqKnJlbmRlcioqIGlzIHRoZSBjb3JlIGZ1bmN0aW9uIHRoYXQgeW91ciB2aWV3IHNob3VsZCBvdmVycmlkZSwgaW4gb3JkZXIKICAgIC8vIHRvIHBvcHVsYXRlIGl0cyBlbGVtZW50IChgdGhpcy5lbGApLCB3aXRoIHRoZSBhcHByb3ByaWF0ZSBIVE1MLiBUaGUKICAgIC8vIGNvbnZlbnRpb24gaXMgZm9yICoqcmVuZGVyKiogdG8gYWx3YXlzIHJldHVybiBgdGhpc2AuCiAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAogICAgLy8gUmVtb3ZlIHRoaXMgdmlldyBmcm9tIHRoZSBET00uIE5vdGUgdGhhdCB0aGUgdmlldyBpc24ndCBwcmVzZW50IGluIHRoZQogICAgLy8gRE9NIGJ5IGRlZmF1bHQsIHNvIGNhbGxpbmcgdGhpcyBtZXRob2QgbWF5IGJlIGEgbm8tb3AuCiAgICByZW1vdmU6IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy4kZWwucmVtb3ZlKCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKICAgIC8vIEZvciBzbWFsbCBhbW91bnRzIG9mIERPTSBFbGVtZW50cywgd2hlcmUgYSBmdWxsLWJsb3duIHRlbXBsYXRlIGlzbid0CiAgICAvLyBuZWVkZWQsIHVzZSAqKm1ha2UqKiB0byBtYW51ZmFjdHVyZSBlbGVtZW50cywgb25lIGF0IGEgdGltZS4KICAgIC8vCiAgICAvLyAgICAgdmFyIGVsID0gdGhpcy5tYWtlKCdsaScsIHsnY2xhc3MnOiAncm93J30sIHRoaXMubW9kZWwuZXNjYXBlKCd0aXRsZScpKTsKICAgIC8vCiAgICBtYWtlOiBmdW5jdGlvbiAodGFnTmFtZSwgYXR0cmlidXRlcywgY29udGVudCkgewogICAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZ05hbWUpOwogICAgICBpZiAoYXR0cmlidXRlcykgJChlbCkuYXR0cihhdHRyaWJ1dGVzKTsKICAgICAgaWYgKGNvbnRlbnQpICQoZWwpLmh0bWwoY29udGVudCk7CiAgICAgIHJldHVybiBlbDsKICAgIH0sCiAgICAvLyBDaGFuZ2UgdGhlIHZpZXcncyBlbGVtZW50IChgdGhpcy5lbGAgcHJvcGVydHkpLCBpbmNsdWRpbmcgZXZlbnQKICAgIC8vIHJlLWRlbGVnYXRpb24uCiAgICBzZXRFbGVtZW50OiBmdW5jdGlvbiAoZWxlbWVudCwgZGVsZWdhdGUpIHsKICAgICAgaWYgKHRoaXMuJGVsKSB0aGlzLnVuZGVsZWdhdGVFdmVudHMoKTsKICAgICAgdGhpcy4kZWwgPSBlbGVtZW50IGluc3RhbmNlb2YgJCA/IGVsZW1lbnQgOiAkKGVsZW1lbnQpOwogICAgICB0aGlzLmVsID0gdGhpcy4kZWxbMF07CiAgICAgIGlmIChkZWxlZ2F0ZSAhPT0gZmFsc2UpIHRoaXMuZGVsZWdhdGVFdmVudHMoKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAogICAgLy8gU2V0IGNhbGxiYWNrcywgd2hlcmUgYHRoaXMuZXZlbnRzYCBpcyBhIGhhc2ggb2YKICAgIC8vCiAgICAvLyAqeyJldmVudCBzZWxlY3RvciI6ICJjYWxsYmFjayJ9KgogICAgLy8KICAgIC8vICAgICB7CiAgICAvLyAgICAgICAnbW91c2Vkb3duIC50aXRsZSc6ICAnZWRpdCcsCiAgICAvLyAgICAgICAnY2xpY2sgLmJ1dHRvbic6ICAgICAnc2F2ZScKICAgIC8vICAgICAgICdjbGljayAub3Blbic6ICAgICAgIGZ1bmN0aW9uKGUpIHsgLi4uIH0KICAgIC8vICAgICB9CiAgICAvLwogICAgLy8gcGFpcnMuIENhbGxiYWNrcyB3aWxsIGJlIGJvdW5kIHRvIHRoZSB2aWV3LCB3aXRoIGB0aGlzYCBzZXQgcHJvcGVybHkuCiAgICAvLyBVc2VzIGV2ZW50IGRlbGVnYXRpb24gZm9yIGVmZmljaWVuY3kuCiAgICAvLyBPbWl0dGluZyB0aGUgc2VsZWN0b3IgYmluZHMgdGhlIGV2ZW50IHRvIGB0aGlzLmVsYC4KICAgIC8vIFRoaXMgb25seSB3b3JrcyBmb3IgZGVsZWdhdGUtYWJsZSBldmVudHM6IG5vdCBgZm9jdXNgLCBgYmx1cmAsIGFuZAogICAgLy8gbm90IGBjaGFuZ2VgLCBgc3VibWl0YCwgYW5kIGByZXNldGAgaW4gSW50ZXJuZXQgRXhwbG9yZXIuCiAgICBkZWxlZ2F0ZUV2ZW50czogZnVuY3Rpb24gKGV2ZW50cykgewogICAgICBpZiAoIShldmVudHMgfHwgKGV2ZW50cyA9IGdldFZhbHVlKHRoaXMsICdldmVudHMnKSkpKSByZXR1cm47CiAgICAgIHRoaXMudW5kZWxlZ2F0ZUV2ZW50cygpOwoKICAgICAgZm9yICh2YXIga2V5IGluIGV2ZW50cykgewogICAgICAgIHZhciBtZXRob2QgPSBldmVudHNba2V5XTsKICAgICAgICBpZiAoIV8uaXNGdW5jdGlvbihtZXRob2QpKSBtZXRob2QgPSB0aGlzW2V2ZW50c1trZXldXTsKICAgICAgICBpZiAoIW1ldGhvZCkgdGhyb3cgbmV3IEVycm9yKCdNZXRob2QgIicgKyBldmVudHNba2V5XSArICciIGRvZXMgbm90IGV4aXN0Jyk7CiAgICAgICAgdmFyIG1hdGNoID0ga2V5Lm1hdGNoKGRlbGVnYXRlRXZlbnRTcGxpdHRlcik7CiAgICAgICAgdmFyIGV2ZW50TmFtZSA9IG1hdGNoWzFdLAogICAgICAgICAgICBzZWxlY3RvciA9IG1hdGNoWzJdOwogICAgICAgIG1ldGhvZCA9IF8uYmluZChtZXRob2QsIHRoaXMpOwogICAgICAgIGV2ZW50TmFtZSArPSAnLmRlbGVnYXRlRXZlbnRzJyArIHRoaXMuY2lkOwoKICAgICAgICBpZiAoc2VsZWN0b3IgPT09ICcnKSB7CiAgICAgICAgICB0aGlzLiRlbC5iaW5kKGV2ZW50TmFtZSwgbWV0aG9kKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kZWwuZGVsZWdhdGUoc2VsZWN0b3IsIGV2ZW50TmFtZSwgbWV0aG9kKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICAvLyBDbGVhcnMgYWxsIGNhbGxiYWNrcyBwcmV2aW91c2x5IGJvdW5kIHRvIHRoZSB2aWV3IHdpdGggYGRlbGVnYXRlRXZlbnRzYC4KICAgIC8vIFlvdSB1c3VhbGx5IGRvbid0IG5lZWQgdG8gdXNlIHRoaXMsIGJ1dCBtYXkgd2lzaCB0byBpZiB5b3UgaGF2ZSBtdWx0aXBsZQogICAgLy8gQmFja2JvbmUgdmlld3MgYXR0YWNoZWQgdG8gdGhlIHNhbWUgRE9NIGVsZW1lbnQuCiAgICB1bmRlbGVnYXRlRXZlbnRzOiBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuJGVsLnVuYmluZCgnLmRlbGVnYXRlRXZlbnRzJyArIHRoaXMuY2lkKTsKICAgIH0sCiAgICAvLyBQZXJmb3JtcyB0aGUgaW5pdGlhbCBjb25maWd1cmF0aW9uIG9mIGEgVmlldyB3aXRoIGEgc2V0IG9mIG9wdGlvbnMuCiAgICAvLyBLZXlzIHdpdGggc3BlY2lhbCBtZWFuaW5nICoobW9kZWwsIGNvbGxlY3Rpb24sIGlkLCBjbGFzc05hbWUpKiwgYXJlCiAgICAvLyBhdHRhY2hlZCBkaXJlY3RseSB0byB0aGUgdmlldy4KICAgIF9jb25maWd1cmU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgIGlmICh0aGlzLm9wdGlvbnMpIG9wdGlvbnMgPSBfLmV4dGVuZCh7fSwgdGhpcy5vcHRpb25zLCBvcHRpb25zKTsKCiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gdmlld09wdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgdmFyIGF0dHIgPSB2aWV3T3B0aW9uc1tpXTsKICAgICAgICBpZiAob3B0aW9uc1thdHRyXSkgdGhpc1thdHRyXSA9IG9wdGlvbnNbYXR0cl07CiAgICAgIH0KCiAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7CiAgICB9LAogICAgLy8gRW5zdXJlIHRoYXQgdGhlIFZpZXcgaGFzIGEgRE9NIGVsZW1lbnQgdG8gcmVuZGVyIGludG8uCiAgICAvLyBJZiBgdGhpcy5lbGAgaXMgYSBzdHJpbmcsIHBhc3MgaXQgdGhyb3VnaCBgJCgpYCwgdGFrZSB0aGUgZmlyc3QKICAgIC8vIG1hdGNoaW5nIGVsZW1lbnQsIGFuZCByZS1hc3NpZ24gaXQgdG8gYGVsYC4gT3RoZXJ3aXNlLCBjcmVhdGUKICAgIC8vIGFuIGVsZW1lbnQgZnJvbSB0aGUgYGlkYCwgYGNsYXNzTmFtZWAgYW5kIGB0YWdOYW1lYCBwcm9wZXJ0aWVzLgogICAgX2Vuc3VyZUVsZW1lbnQ6IGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCF0aGlzLmVsKSB7CiAgICAgICAgdmFyIGF0dHJzID0gZ2V0VmFsdWUodGhpcywgJ2F0dHJpYnV0ZXMnKSB8fCB7fTsKICAgICAgICBpZiAodGhpcy5pZCkgYXR0cnMuaWQgPSB0aGlzLmlkOwogICAgICAgIGlmICh0aGlzLmNsYXNzTmFtZSkgYXR0cnNbJ2NsYXNzJ10gPSB0aGlzLmNsYXNzTmFtZTsKICAgICAgICB0aGlzLnNldEVsZW1lbnQodGhpcy5tYWtlKHRoaXMudGFnTmFtZSwgYXR0cnMpLCBmYWxzZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zZXRFbGVtZW50KHRoaXMuZWwsIGZhbHNlKTsKICAgICAgfQogICAgfQogIH0pOyAvLyBUaGUgc2VsZi1wcm9wYWdhdGluZyBleHRlbmQgZnVuY3Rpb24gdGhhdCBCYWNrYm9uZSBjbGFzc2VzIHVzZS4KCgogIHZhciBleHRlbmQgPSBmdW5jdGlvbiAocHJvdG9Qcm9wcywgY2xhc3NQcm9wcykgewogICAgdmFyIGNoaWxkID0gaW5oZXJpdHModGhpcywgcHJvdG9Qcm9wcywgY2xhc3NQcm9wcyk7CiAgICBjaGlsZC5leHRlbmQgPSB0aGlzLmV4dGVuZDsKICAgIHJldHVybiBjaGlsZDsKICB9OyAvLyBTZXQgdXAgaW5oZXJpdGFuY2UgZm9yIHRoZSBtb2RlbCwgY29sbGVjdGlvbiwgYW5kIHZpZXcuCgoKICBNb2RlbC5leHRlbmQgPSBDb2xsZWN0aW9uLmV4dGVuZCA9IFJvdXRlci5leHRlbmQgPSBWaWV3LmV4dGVuZCA9IGV4dGVuZDsgLy8gQmFja2JvbmUuc3luYwogIC8vIC0tLS0tLS0tLS0tLS0KICAvLyBNYXAgZnJvbSBDUlVEIHRvIEhUVFAgZm9yIG91ciBkZWZhdWx0IGBCYWNrYm9uZS5zeW5jYCBpbXBsZW1lbnRhdGlvbi4KCiAgdmFyIG1ldGhvZE1hcCA9IHsKICAgICdjcmVhdGUnOiAnUE9TVCcsCiAgICAndXBkYXRlJzogJ1BVVCcsCiAgICAnZGVsZXRlJzogJ0RFTEVURScsCiAgICAncmVhZCc6ICdHRVQnCiAgfTsgLy8gT3ZlcnJpZGUgdGhpcyBmdW5jdGlvbiB0byBjaGFuZ2UgdGhlIG1hbm5lciBpbiB3aGljaCBCYWNrYm9uZSBwZXJzaXN0cwogIC8vIG1vZGVscyB0byB0aGUgc2VydmVyLiBZb3Ugd2lsbCBiZSBwYXNzZWQgdGhlIHR5cGUgb2YgcmVxdWVzdCwgYW5kIHRoZQogIC8vIG1vZGVsIGluIHF1ZXN0aW9uLiBCeSBkZWZhdWx0LCBtYWtlcyBhIFJFU1RmdWwgQWpheCByZXF1ZXN0CiAgLy8gdG8gdGhlIG1vZGVsJ3MgYHVybCgpYC4gU29tZSBwb3NzaWJsZSBjdXN0b21pemF0aW9ucyBjb3VsZCBiZToKICAvLwogIC8vICogVXNlIGBzZXRUaW1lb3V0YCB0byBiYXRjaCByYXBpZC1maXJlIHVwZGF0ZXMgaW50byBhIHNpbmdsZSByZXF1ZXN0LgogIC8vICogU2VuZCB1cCB0aGUgbW9kZWxzIGFzIFhNTCBpbnN0ZWFkIG9mIEpTT04uCiAgLy8gKiBQZXJzaXN0IG1vZGVscyB2aWEgV2ViU29ja2V0cyBpbnN0ZWFkIG9mIEFqYXguCiAgLy8KICAvLyBUdXJuIG9uIGBCYWNrYm9uZS5lbXVsYXRlSFRUUGAgaW4gb3JkZXIgdG8gc2VuZCBgUFVUYCBhbmQgYERFTEVURWAgcmVxdWVzdHMKICAvLyBhcyBgUE9TVGAsIHdpdGggYSBgX21ldGhvZGAgcGFyYW1ldGVyIGNvbnRhaW5pbmcgdGhlIHRydWUgSFRUUCBtZXRob2QsCiAgLy8gYXMgd2VsbCBhcyBhbGwgcmVxdWVzdHMgd2l0aCB0aGUgYm9keSBhcyBgYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkYAogIC8vIGluc3RlYWQgb2YgYGFwcGxpY2F0aW9uL2pzb25gIHdpdGggdGhlIG1vZGVsIGluIGEgcGFyYW0gbmFtZWQgYG1vZGVsYC4KICAvLyBVc2VmdWwgd2hlbiBpbnRlcmZhY2luZyB3aXRoIHNlcnZlci1zaWRlIGxhbmd1YWdlcyBsaWtlICoqUEhQKiogdGhhdCBtYWtlCiAgLy8gaXQgZGlmZmljdWx0IHRvIHJlYWQgdGhlIGJvZHkgb2YgYFBVVGAgcmVxdWVzdHMuCgogIEJhY2tib25lLnN5bmMgPSBmdW5jdGlvbiAobWV0aG9kLCBtb2RlbCwgb3B0aW9ucykgewogICAgdmFyIHR5cGUgPSBtZXRob2RNYXBbbWV0aG9kXTsgLy8gRGVmYXVsdCBvcHRpb25zLCB1bmxlc3Mgc3BlY2lmaWVkLgoKICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7IC8vIERlZmF1bHQgSlNPTi1yZXF1ZXN0IG9wdGlvbnMuCgogICAgdmFyIHBhcmFtcyA9IHsKICAgICAgdHlwZTogdHlwZSwKICAgICAgZGF0YVR5cGU6ICdqc29uJwogICAgfTsgLy8gRW5zdXJlIHRoYXQgd2UgaGF2ZSBhIFVSTC4KCiAgICBpZiAoIW9wdGlvbnMudXJsKSB7CiAgICAgIHBhcmFtcy51cmwgPSBnZXRWYWx1ZShtb2RlbCwgJ3VybCcpIHx8IHVybEVycm9yKCk7CiAgICB9IC8vIEVuc3VyZSB0aGF0IHdlIGhhdmUgdGhlIGFwcHJvcHJpYXRlIHJlcXVlc3QgZGF0YS4KCgogICAgaWYgKCFvcHRpb25zLmRhdGEgJiYgbW9kZWwgJiYgKG1ldGhvZCA9PSAnY3JlYXRlJyB8fCBtZXRob2QgPT0gJ3VwZGF0ZScpKSB7CiAgICAgIHBhcmFtcy5jb250ZW50VHlwZSA9ICdhcHBsaWNhdGlvbi9qc29uJzsKICAgICAgcGFyYW1zLmRhdGEgPSBKU09OLnN0cmluZ2lmeShtb2RlbC50b0pTT04oKSk7CiAgICB9IC8vIEZvciBvbGRlciBzZXJ2ZXJzLCBlbXVsYXRlIEpTT04gYnkgZW5jb2RpbmcgdGhlIHJlcXVlc3QgaW50byBhbiBIVE1MLWZvcm0uCgoKICAgIGlmIChCYWNrYm9uZS5lbXVsYXRlSlNPTikgewogICAgICBwYXJhbXMuY29udGVudFR5cGUgPSAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJzsKICAgICAgcGFyYW1zLmRhdGEgPSBwYXJhbXMuZGF0YSA/IHsKICAgICAgICBtb2RlbDogcGFyYW1zLmRhdGEKICAgICAgfSA6IHt9OwogICAgfSAvLyBGb3Igb2xkZXIgc2VydmVycywgZW11bGF0ZSBIVFRQIGJ5IG1pbWlja2luZyB0aGUgSFRUUCBtZXRob2Qgd2l0aCBgX21ldGhvZGAKICAgIC8vIEFuZCBhbiBgWC1IVFRQLU1ldGhvZC1PdmVycmlkZWAgaGVhZGVyLgoKCiAgICBpZiAoQmFja2JvbmUuZW11bGF0ZUhUVFApIHsKICAgICAgaWYgKHR5cGUgPT09ICdQVVQnIHx8IHR5cGUgPT09ICdERUxFVEUnKSB7CiAgICAgICAgaWYgKEJhY2tib25lLmVtdWxhdGVKU09OKSBwYXJhbXMuZGF0YS5fbWV0aG9kID0gdHlwZTsKICAgICAgICBwYXJhbXMudHlwZSA9ICdQT1NUJzsKCiAgICAgICAgcGFyYW1zLmJlZm9yZVNlbmQgPSBmdW5jdGlvbiAoeGhyKSB7CiAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignWC1IVFRQLU1ldGhvZC1PdmVycmlkZScsIHR5cGUpOwogICAgICAgIH07CiAgICAgIH0KICAgIH0gLy8gRG9uJ3QgcHJvY2VzcyBkYXRhIG9uIGEgbm9uLUdFVCByZXF1ZXN0LgoKCiAgICBpZiAocGFyYW1zLnR5cGUgIT09ICdHRVQnICYmICFCYWNrYm9uZS5lbXVsYXRlSlNPTikgewogICAgICBwYXJhbXMucHJvY2Vzc0RhdGEgPSBmYWxzZTsKICAgIH0gLy8gTWFrZSB0aGUgcmVxdWVzdCwgYWxsb3dpbmcgdGhlIHVzZXIgdG8gb3ZlcnJpZGUgYW55IEFqYXggb3B0aW9ucy4KCgogICAgcmV0dXJuICQuYWpheChfLmV4dGVuZChwYXJhbXMsIG9wdGlvbnMpKTsKICB9OyAvLyBXcmFwIGFuIG9wdGlvbmFsIGVycm9yIGNhbGxiYWNrIHdpdGggYSBmYWxsYmFjayBlcnJvciBldmVudC4KCgogIEJhY2tib25lLndyYXBFcnJvciA9IGZ1bmN0aW9uIChvbkVycm9yLCBvcmlnaW5hbE1vZGVsLCBvcHRpb25zKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKG1vZGVsLCByZXNwKSB7CiAgICAgIHJlc3AgPSBtb2RlbCA9PT0gb3JpZ2luYWxNb2RlbCA/IHJlc3AgOiBtb2RlbDsKCiAgICAgIGlmIChvbkVycm9yKSB7CiAgICAgICAgb25FcnJvcihvcmlnaW5hbE1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBvcmlnaW5hbE1vZGVsLnRyaWdnZXIoJ2Vycm9yJywgb3JpZ2luYWxNb2RlbCwgcmVzcCwgb3B0aW9ucyk7CiAgICAgIH0KICAgIH07CiAgfTsgLy8gSGVscGVycwogIC8vIC0tLS0tLS0KICAvLyBTaGFyZWQgZW1wdHkgY29uc3RydWN0b3IgZnVuY3Rpb24gdG8gYWlkIGluIHByb3RvdHlwZS1jaGFpbiBjcmVhdGlvbi4KCgogIHZhciBjdG9yID0gZnVuY3Rpb24gKCkge307IC8vIEhlbHBlciBmdW5jdGlvbiB0byBjb3JyZWN0bHkgc2V0IHVwIHRoZSBwcm90b3R5cGUgY2hhaW4sIGZvciBzdWJjbGFzc2VzLgogIC8vIFNpbWlsYXIgdG8gYGdvb2cuaW5oZXJpdHNgLCBidXQgdXNlcyBhIGhhc2ggb2YgcHJvdG90eXBlIHByb3BlcnRpZXMgYW5kCiAgLy8gY2xhc3MgcHJvcGVydGllcyB0byBiZSBleHRlbmRlZC4KCgogIHZhciBpbmhlcml0cyA9IGZ1bmN0aW9uIChwYXJlbnQsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CiAgICB2YXIgY2hpbGQ7IC8vIFRoZSBjb25zdHJ1Y3RvciBmdW5jdGlvbiBmb3IgdGhlIG5ldyBzdWJjbGFzcyBpcyBlaXRoZXIgZGVmaW5lZCBieSB5b3UKICAgIC8vICh0aGUgImNvbnN0cnVjdG9yIiBwcm9wZXJ0eSBpbiB5b3VyIGBleHRlbmRgIGRlZmluaXRpb24pLCBvciBkZWZhdWx0ZWQKICAgIC8vIGJ5IHVzIHRvIHNpbXBseSBjYWxsIHRoZSBwYXJlbnQncyBjb25zdHJ1Y3Rvci4KCiAgICBpZiAocHJvdG9Qcm9wcyAmJiBwcm90b1Byb3BzLmhhc093blByb3BlcnR5KCdjb25zdHJ1Y3RvcicpKSB7CiAgICAgIGNoaWxkID0gcHJvdG9Qcm9wcy5jb25zdHJ1Y3RvcjsKICAgIH0gZWxzZSB7CiAgICAgIGNoaWxkID0gZnVuY3Rpb24gKCkgewogICAgICAgIHBhcmVudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfSAvLyBJbmhlcml0IGNsYXNzIChzdGF0aWMpIHByb3BlcnRpZXMgZnJvbSBwYXJlbnQuCgoKICAgIF8uZXh0ZW5kKGNoaWxkLCBwYXJlbnQpOyAvLyBTZXQgdGhlIHByb3RvdHlwZSBjaGFpbiB0byBpbmhlcml0IGZyb20gYHBhcmVudGAsIHdpdGhvdXQgY2FsbGluZwogICAgLy8gYHBhcmVudGAncyBjb25zdHJ1Y3RvciBmdW5jdGlvbi4KCgogICAgY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOwogICAgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgLy8gQWRkIHByb3RvdHlwZSBwcm9wZXJ0aWVzIChpbnN0YW5jZSBwcm9wZXJ0aWVzKSB0byB0aGUgc3ViY2xhc3MsCiAgICAvLyBpZiBzdXBwbGllZC4KCiAgICBpZiAocHJvdG9Qcm9wcykgXy5leHRlbmQoY2hpbGQucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgLy8gQWRkIHN0YXRpYyBwcm9wZXJ0aWVzIHRvIHRoZSBjb25zdHJ1Y3RvciBmdW5jdGlvbiwgaWYgc3VwcGxpZWQuCgogICAgaWYgKHN0YXRpY1Byb3BzKSBfLmV4dGVuZChjaGlsZCwgc3RhdGljUHJvcHMpOyAvLyBDb3JyZWN0bHkgc2V0IGNoaWxkJ3MgYHByb3RvdHlwZS5jb25zdHJ1Y3RvcmAuCgogICAgY2hpbGQucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gY2hpbGQ7IC8vIFNldCBhIGNvbnZlbmllbmNlIHByb3BlcnR5IGluIGNhc2UgdGhlIHBhcmVudCdzIHByb3RvdHlwZSBpcyBuZWVkZWQgbGF0ZXIuCgogICAgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsKICAgIHJldHVybiBjaGlsZDsKICB9OyAvLyBIZWxwZXIgZnVuY3Rpb24gdG8gZ2V0IGEgdmFsdWUgZnJvbSBhIEJhY2tib25lIG9iamVjdCBhcyBhIHByb3BlcnR5CiAgLy8gb3IgYXMgYSBmdW5jdGlvbi4KCgogIHZhciBnZXRWYWx1ZSA9IGZ1bmN0aW9uIChvYmplY3QsIHByb3ApIHsKICAgIGlmICghKG9iamVjdCAmJiBvYmplY3RbcHJvcF0pKSByZXR1cm4gbnVsbDsKICAgIHJldHVybiBfLmlzRnVuY3Rpb24ob2JqZWN0W3Byb3BdKSA/IG9iamVjdFtwcm9wXSgpIDogb2JqZWN0W3Byb3BdOwogIH07IC8vIFRocm93IGFuIGVycm9yIHdoZW4gYSBVUkwgaXMgbmVlZGVkLCBhbmQgbm9uZSBpcyBzdXBwbGllZC4KCgogIHZhciB1cmxFcnJvciA9IGZ1bmN0aW9uICgpIHsKICAgIHRocm93IG5ldyBFcnJvcignQSAidXJsIiBwcm9wZXJ0eSBvciBmdW5jdGlvbiBtdXN0IGJlIHNwZWNpZmllZCcpOwogIH07Cn0pLmNhbGwodGhpcyk7"},{"version":3,"sources":["/Users/ssaddique/Axway/KitchenSink-v2-update/kitchensink-v2/node_modules/alloy/Alloy/lib/alloy/backbone/0.9.2/backbone.js"],"names":["define","root","previousBackbone","Backbone","slice","Array","prototype","splice","exports","VERSION","_","require","$","jQuery","Zepto","ender","setDomLibrary","lib","noConflict","emulateHTTP","emulateJSON","eventSplitter","Events","on","events","callback","context","calls","event","node","tail","list","split","_callbacks","shift","next","off","cb","ctx","keys","trigger","args","all","rest","call","arguments","apply","concat","bind","unbind","Model","attributes","options","defaults","parse","getValue","extend","collection","_escapedAttributes","cid","uniqueId","changed","_silent","_pending","set","silent","_previousAttributes","clone","initialize","idAttribute","toJSON","get","attr","escape","html","val","has","key","value","attrs","isObject","unset","_validate","id","changes","now","escaped","prev","isEqual","change","clear","fetch","model","success","resp","status","xhr","error","wrapError","sync","save","current","wait","silentOptions","serverAttrs","method","isNew","destroy","triggerDestroy","url","base","urlError","charAt","length","encodeURIComponent","constructor","changing","_changing","isEmpty","hasChanged","changedAttributes","diff","old","previous","previousAttributes","isValid","validate","Collection","models","comparator","_reset","reset","map","add","i","index","cids","ids","dups","isArray","_prepareModel","Error","_byCid","_byId","push","_onModelEvent","at","sort","remove","l","getByCid","indexOf","_removeReference","pop","unshift","where","filter","boundComparator","sortBy","pluck","undefined","create","coll","nextModel","chain","methods","each","toArray","Router","routes","_bindRoutes","namedParam","splatParam","escapeRegExp","route","name","history","History","isRegExp","_routeToRegExp","fragment","_extractParameters","navigate","replace","RegExp","exec","handlers","bindAll","routeStripper","isExplorer","started","interval","getHash","windowOverride","loc","location","window","match","href","getFragment","forcePushState","_hasPushState","pathname","search","substr","start","_wantsHashChange","hashChange","_wantsPushState","pushState","docMode","document","documentMode","oldIE","navigator","userAgent","toLowerCase","iframe","hide","appendTo","contentWindow","checkUrl","_checkUrlInterval","setInterval","atRoot","hash","replaceState","title","protocol","host","loadUrl","stop","clearInterval","e","fragmentOverride","matched","any","handler","test","frag","_updateHash","open","close","assign","toString","View","_configure","_ensureElement","delegateEvents","delegateEventSplitter","viewOptions","tagName","selector","$el","find","render","make","content","el","createElement","setElement","element","delegate","undelegateEvents","isFunction","eventName","className","protoProps","classProps","child","inherits","methodMap","type","params","dataType","data","contentType","JSON","stringify","_method","beforeSend","setRequestHeader","processData","ajax","onError","originalModel","ctor","parent","staticProps","hasOwnProperty","__super__","object","prop"],"mappings":"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","sourcesContent":["/*** IMPORTS FROM imports-loader ***/\nvar define = false;\n\n//     Backbone.js 0.9.2\n\n//     (c) 2010-2012 Jeremy Ashkenas, DocumentCloud Inc.\n//     Backbone may be freely distributed under the MIT license.\n//     For all details and documentation:\n//     http://backbonejs.org\n\n(function(){\n\n// Initial Setup\n// -------------\n\n// Save a reference to the global object (`window` in the browser, `global`\n// on the server).\nvar root = this;\n\n// Save the previous value of the `Backbone` variable, so that it can be\n// restored later on, if `noConflict` is used.\nvar previousBackbone = root.Backbone;\n\n// Create a local reference to slice/splice.\nvar slice = Array.prototype.slice;\nvar splice = Array.prototype.splice;\n\n// The top-level namespace. All public Backbone classes and modules will\n// be attached to this. Exported for both CommonJS and the browser.\nvar Backbone;\nif (typeof exports !== 'undefined') {\n\tBackbone = exports;\n} else {\n\tBackbone = root.Backbone = {};\n}\n\n// Current version of the library. Keep in sync with `package.json`.\nBackbone.VERSION = '0.9.2';\n\n// Require Underscore, if we're on the server, and it's not already present.\nvar _ = root._;\nif (!_ && (typeof require !== 'undefined')) _ = require('/alloy/underscore');\n\n// For Backbone's purposes, jQuery, Zepto, or Ender owns the `$` variable.\nvar $ = root.jQuery || root.Zepto || root.ender;\n\n// Set the JavaScript library that will be used for DOM manipulation and\n// Ajax calls (a.k.a. the `$` variable). By default Backbone will use: jQuery,\n// Zepto, or Ender; but the `setDomLibrary()` method lets you inject an\n// alternate JavaScript library (or a mock library for testing your views\n// outside of a browser).\nBackbone.setDomLibrary = function(lib) {\n\t$ = lib;\n};\n\n// Runs Backbone.js in *noConflict* mode, returning the `Backbone` variable\n// to its previous owner. Returns a reference to this Backbone object.\nBackbone.noConflict = function() {\n\troot.Backbone = previousBackbone;\n\treturn this;\n};\n\n// Turn on `emulateHTTP` to support legacy HTTP servers. Setting this option\n// will fake `\"PUT\"` and `\"DELETE\"` requests via the `_method` parameter and\n// set a `X-Http-Method-Override` header.\nBackbone.emulateHTTP = false;\n\n// Turn on `emulateJSON` to support legacy servers that can't deal with direct\n// `application/json` requests ... will encode the body as\n// `application/x-www-form-urlencoded` instead and will send the model in a\n// form param named `model`.\nBackbone.emulateJSON = false;\n\n// Backbone.Events\n// -----------------\n\n// Regular expression used to split event strings\nvar eventSplitter = /\\s+/;\n\n// A module that can be mixed in to *any object* in order to provide it with\n// custom events. You may bind with `on` or remove with `off` callback functions\n// to an event; trigger`-ing an event fires all callbacks in succession.\n//\n//     var object = {};\n//     _.extend(object, Backbone.Events);\n//     object.on('expand', function(){ alert('expanded'); });\n//     object.trigger('expand');\n//\nvar Events = Backbone.Events = {\n\n\t// Bind one or more space separated events, `events`, to a `callback`\n\t// function. Passing `\"all\"` will bind the callback to all events fired.\n\ton: function(events, callback, context) {\n\n\tvar calls, event, node, tail, list;\n\tif (!callback) return this;\n\tevents = events.split(eventSplitter);\n\tcalls = this._callbacks || (this._callbacks = {});\n\n\t// Create an immutable callback list, allowing traversal during\n\t// modification.  The tail is an empty object that will always be used\n\t// as the next node.\n\twhile (event = events.shift()) {\n\t\tlist = calls[event];\n\t\tnode = list ? list.tail : {};\n\t\tnode.next = tail = {};\n\t\tnode.context = context;\n\t\tnode.callback = callback;\n\t\tcalls[event] = {tail: tail, next: list ? list.next : node};\n\t}\n\n\treturn this;\n\t},\n\n\t// Remove one or many callbacks. If `context` is null, removes all callbacks\n\t// with that function. If `callback` is null, removes all callbacks for the\n\t// event. If `events` is null, removes all bound callbacks for all events.\n\toff: function(events, callback, context) {\n\tvar event, calls, node, tail, cb, ctx;\n\n\t// No events, or removing *all* events.\n\tif (!(calls = this._callbacks)) return;\n\tif (!(events || callback || context)) {\n\t\tdelete this._callbacks;\n\t\treturn this;\n\t}\n\n\t// Loop through the listed events and contexts, splicing them out of the\n\t// linked list of callbacks if appropriate.\n\tevents = events ? events.split(eventSplitter) : _.keys(calls);\n\twhile (event = events.shift()) {\n\t\tnode = calls[event];\n\t\tdelete calls[event];\n\t\tif (!node || !(callback || context)) continue;\n\t\t// Create a new list, omitting the indicated callbacks.\n\t\ttail = node.tail;\n\t\twhile ((node = node.next) !== tail) {\n\t\tcb = node.callback;\n\t\tctx = node.context;\n\t\tif ((callback && cb !== callback) || (context && ctx !== context)) {\n\t\t\tthis.on(event, cb, ctx);\n\t\t}\n\t\t}\n\t}\n\n\treturn this;\n\t},\n\n\t// Trigger one or many events, firing all bound callbacks. Callbacks are\n\t// passed the same arguments as `trigger` is, apart from the event name\n\t// (unless you're listening on `\"all\"`, which will cause your callback to\n\t// receive the true name of the event as the first argument).\n\ttrigger: function(events) {\n\tvar event, node, calls, tail, args, all, rest;\n\tif (!(calls = this._callbacks)) return this;\n\tall = calls.all;\n\tevents = events.split(eventSplitter);\n\trest = slice.call(arguments, 1);\n\n\t// For each event, walk through the linked list of callbacks twice,\n\t// first to trigger the event, then to trigger any `\"all\"` callbacks.\n\twhile (event = events.shift()) {\n\t\tif (node = calls[event]) {\n\t\ttail = node.tail;\n\t\twhile ((node = node.next) !== tail) {\n\t\t\tnode.callback.apply(node.context || this, rest);\n\t\t}\n\t\t}\n\t\tif (node = all) {\n\t\ttail = node.tail;\n\t\targs = [event].concat(rest);\n\t\twhile ((node = node.next) !== tail) {\n\t\t\tnode.callback.apply(node.context || this, args);\n\t\t}\n\t\t}\n\t}\n\n\treturn this;\n\t}\n\n};\n\n// Aliases for backwards compatibility.\nEvents.bind   = Events.on;\nEvents.unbind = Events.off;\n\n// Backbone.Model\n// --------------\n\n// Create a new model, with defined attributes. A client id (`cid`)\n// is automatically generated and assigned for you.\nvar Model = Backbone.Model = function(attributes, options) {\n\tvar defaults;\n\tattributes || (attributes = {});\n\tif (options && options.parse) attributes = this.parse(attributes);\n\tif (defaults = getValue(this, 'defaults')) {\n\tattributes = _.extend({}, defaults, attributes);\n\t}\n\tif (options && options.collection) this.collection = options.collection;\n\tthis.attributes = {};\n\tthis._escapedAttributes = {};\n\tthis.cid = _.uniqueId('c');\n\tthis.changed = {};\n\tthis._silent = {};\n\tthis._pending = {};\n\tthis.set(attributes, {silent: true});\n\t// Reset change tracking.\n\tthis.changed = {};\n\tthis._silent = {};\n\tthis._pending = {};\n\tthis._previousAttributes = _.clone(this.attributes);\n\tthis.initialize.apply(this, arguments);\n};\n\n// Attach all inheritable methods to the Model prototype.\n_.extend(Model.prototype, Events, {\n\n\t// A hash of attributes whose current and previous value differ.\n\tchanged: null,\n\n\t// A hash of attributes that have silently changed since the last time\n\t// `change` was called.  Will become pending attributes on the next call.\n\t_silent: null,\n\n\t// A hash of attributes that have changed since the last `'change'` event\n\t// began.\n\t_pending: null,\n\n\t// The default name for the JSON `id` attribute is `\"id\"`. MongoDB and\n\t// CouchDB users may want to set this to `\"_id\"`.\n\tidAttribute: 'id',\n\n\t// Initialize is an empty function by default. Override it with your own\n\t// initialization logic.\n\tinitialize: function(){},\n\n\t// Return a copy of the model's `attributes` object.\n\ttoJSON: function(options) {\n\treturn _.clone(this.attributes);\n\t},\n\n\t// Get the value of an attribute.\n\tget: function(attr) {\n\treturn this.attributes[attr];\n\t},\n\n\t// Get the HTML-escaped value of an attribute.\n\tescape: function(attr) {\n\tvar html;\n\tif (html = this._escapedAttributes[attr]) return html;\n\tvar val = this.get(attr);\n\treturn this._escapedAttributes[attr] = _.escape(val == null ? '' : '' + val);\n\t},\n\n\t// Returns `true` if the attribute contains a value that is not null\n\t// or undefined.\n\thas: function(attr) {\n\treturn this.get(attr) != null;\n\t},\n\n\t// Set a hash of model attributes on the object, firing `\"change\"` unless\n\t// you choose to silence it.\n\tset: function(key, value, options) {\n\tvar attrs, attr, val;\n\n\t// Handle both\n\tif (_.isObject(key) || key == null) {\n\t\tattrs = key;\n\t\toptions = value;\n\t} else {\n\t\tattrs = {};\n\t\tattrs[key] = value;\n\t}\n\n\t// Extract attributes and options.\n\toptions || (options = {});\n\tif (!attrs) return this;\n\tif (attrs instanceof Model) attrs = attrs.attributes;\n\tif (options.unset) for (attr in attrs) attrs[attr] = void 0;\n\n\t// Run validation.\n\tif (!this._validate(attrs, options)) return false;\n\n\t// Check for changes of `id`.\n\tif (this.idAttribute in attrs) this.id = attrs[this.idAttribute];\n\n\tvar changes = options.changes = {};\n\tvar now = this.attributes;\n\tvar escaped = this._escapedAttributes;\n\tvar prev = this._previousAttributes || {};\n\n\t// For each `set` attribute...\n\tfor (attr in attrs) {\n\t\tval = attrs[attr];\n\n\t\t// If the new and current value differ, record the change.\n\t\tif (!_.isEqual(now[attr], val) || (options.unset && _.has(now, attr))) {\n\t\tdelete escaped[attr];\n\t\t(options.silent ? this._silent : changes)[attr] = true;\n\t\t}\n\n\t\t// Update or delete the current value.\n\t\toptions.unset ? delete now[attr] : now[attr] = val;\n\n\t\t// If the new and previous value differ, record the change.  If not,\n\t\t// then remove changes for this attribute.\n\t\tif (!_.isEqual(prev[attr], val) || (_.has(now, attr) != _.has(prev, attr))) {\n\t\tthis.changed[attr] = val;\n\t\tif (!options.silent) this._pending[attr] = true;\n\t\t} else {\n\t\tdelete this.changed[attr];\n\t\tdelete this._pending[attr];\n\t\t}\n\t}\n\n\t// Fire the `\"change\"` events.\n\tif (!options.silent) this.change(options);\n\treturn this;\n\t},\n\n\t// Remove an attribute from the model, firing `\"change\"` unless you choose\n\t// to silence it. `unset` is a noop if the attribute doesn't exist.\n\tunset: function(attr, options) {\n\t(options || (options = {})).unset = true;\n\treturn this.set(attr, null, options);\n\t},\n\n\t// Clear all attributes on the model, firing `\"change\"` unless you choose\n\t// to silence it.\n\tclear: function(options) {\n\t(options || (options = {})).unset = true;\n\treturn this.set(_.clone(this.attributes), options);\n\t},\n\n\t// Fetch the model from the server. If the server's representation of the\n\t// model differs from its current attributes, they will be overriden,\n\t// triggering a `\"change\"` event.\n\tfetch: function(options) {\n\toptions = options ? _.clone(options) : {};\n\tvar model = this;\n\tvar success = options.success;\n\toptions.success = function(resp, status, xhr) {\n\t\tif (!model.set(model.parse(resp, xhr), options)) return false;\n\t\tif (success) success(model, resp);\n\t};\n\toptions.error = Backbone.wrapError(options.error, model, options);\n\treturn (this.sync || Backbone.sync).call(this, 'read', this, options);\n\t},\n\n\t// Set a hash of model attributes, and sync the model to the server.\n\t// If the server returns an attributes hash that differs, the model's\n\t// state will be `set` again.\n\tsave: function(key, value, options) {\n\tvar attrs, current;\n\n\t// Handle both `(\"key\", value)` and `({key: value})` -style calls.\n\tif (_.isObject(key) || key == null) {\n\t\tattrs = key;\n\t\toptions = value;\n\t} else {\n\t\tattrs = {};\n\t\tattrs[key] = value;\n\t}\n\toptions = options ? _.clone(options) : {};\n\n\t// If we're \"wait\"-ing to set changed attributes, validate early.\n\tif (options.wait) {\n\t\tif (!this._validate(attrs, options)) return false;\n\t\tcurrent = _.clone(this.attributes);\n\t}\n\n\t// Regular saves `set` attributes before persisting to the server.\n\tvar silentOptions = _.extend({}, options, {silent: true});\n\tif (attrs && !this.set(attrs, options.wait ? silentOptions : options)) {\n\t\treturn false;\n\t}\n\n\t// After a successful server-side save, the client is (optionally)\n\t// updated with the server-side state.\n\tvar model = this;\n\tvar success = options.success;\n\toptions.success = function(resp, status, xhr) {\n\t\tvar serverAttrs = model.parse(resp, xhr);\n\t\tif (options.wait) {\n\t\tdelete options.wait;\n\t\tserverAttrs = _.extend(attrs || {}, serverAttrs);\n\t\t}\n\t\tif (!model.set(serverAttrs, options)) return false;\n\t\tif (success) {\n\t\tsuccess(model, resp);\n\t\t} else {\n\t\tmodel.trigger('sync', model, resp, options);\n\t\t}\n\t};\n\n\t// Finish configuring and sending the Ajax request.\n\toptions.error = Backbone.wrapError(options.error, model, options);\n\tvar method = this.isNew() ? 'create' : 'update';\n\tvar xhr = (this.sync || Backbone.sync).call(this, method, this, options);\n\tif (options.wait) this.set(current, silentOptions);\n\treturn xhr;\n\t},\n\n\t// Destroy this model on the server if it was already persisted.\n\t// Optimistically removes the model from its collection, if it has one.\n\t// If `wait: true` is passed, waits for the server to respond before removal.\n\tdestroy: function(options) {\n\toptions = options ? _.clone(options) : {};\n\tvar model = this;\n\tvar success = options.success;\n\n\tvar triggerDestroy = function() {\n\t\tmodel.trigger('destroy', model, model.collection, options);\n\t};\n\n\tif (this.isNew()) {\n\t\ttriggerDestroy();\n\t\treturn false;\n\t}\n\n\toptions.success = function(resp) {\n\t\tif (options.wait) triggerDestroy();\n\t\tif (success) {\n\t\tsuccess(model, resp);\n\t\t} else {\n\t\tmodel.trigger('sync', model, resp, options);\n\t\t}\n\t};\n\n\toptions.error = Backbone.wrapError(options.error, model, options);\n\tvar xhr = (this.sync || Backbone.sync).call(this, 'delete', this, options);\n\tif (!options.wait) triggerDestroy();\n\treturn xhr;\n\t},\n\n\t// Default URL for the model's representation on the server -- if you're\n\t// using Backbone's restful methods, override this to change the endpoint\n\t// that will be called.\n\turl: function() {\n\tvar base = getValue(this, 'urlRoot') || getValue(this.collection, 'url') || urlError();\n\tif (this.isNew()) return base;\n\treturn base + (base.charAt(base.length - 1) == '/' ? '' : '/') + encodeURIComponent(this.id);\n\t},\n\n\t// **parse** converts a response into the hash of attributes to be `set` on\n\t// the model. The default implementation is just to pass the response along.\n\tparse: function(resp, xhr) {\n\treturn resp;\n\t},\n\n\t// Create a new model with identical attributes to this one.\n\tclone: function() {\n\treturn new this.constructor(this.attributes);\n\t},\n\n\t// A model is new if it has never been saved to the server, and lacks an id.\n\tisNew: function() {\n\treturn this.id == null;\n\t},\n\n\t// Call this method to manually fire a `\"change\"` event for this model and\n\t// a `\"change:attribute\"` event for each changed attribute.\n\t// Calling this will cause all objects observing the model to update.\n\tchange: function(options) {\n\toptions || (options = {});\n\tvar changing = this._changing;\n\tthis._changing = true;\n\n\t// Silent changes become pending changes.\n\tfor (var attr in this._silent) this._pending[attr] = true;\n\n\t// Silent changes are triggered.\n\tvar changes = _.extend({}, options.changes, this._silent);\n\tthis._silent = {};\n\tfor (var attr in changes) {\n\t\tthis.trigger('change:' + attr, this, this.get(attr), options);\n\t}\n\tif (changing) return this;\n\n\t// Continue firing `\"change\"` events while there are pending changes.\n\twhile (!_.isEmpty(this._pending)) {\n\t\tthis._pending = {};\n\t\tthis.trigger('change', this, options);\n\t\t// Pending and silent changes still remain.\n\t\tfor (var attr in this.changed) {\n\t\tif (this._pending[attr] || this._silent[attr]) continue;\n\t\tdelete this.changed[attr];\n\t\t}\n\t\tthis._previousAttributes = _.clone(this.attributes);\n\t}\n\n\tthis._changing = false;\n\treturn this;\n\t},\n\n\t// Determine if the model has changed since the last `\"change\"` event.\n\t// If you specify an attribute name, determine if that attribute has changed.\n\thasChanged: function(attr) {\n\tif (!arguments.length) return !_.isEmpty(this.changed);\n\treturn _.has(this.changed, attr);\n\t},\n\n\t// Return an object containing all the attributes that have changed, or\n\t// false if there are no changed attributes. Useful for determining what\n\t// parts of a view need to be updated and/or what attributes need to be\n\t// persisted to the server. Unset attributes will be set to undefined.\n\t// You can also pass an attributes object to diff against the model,\n\t// determining if there *would be* a change.\n\tchangedAttributes: function(diff) {\n\tif (!diff) return this.hasChanged() ? _.clone(this.changed) : false;\n\tvar val, changed = false, old = this._previousAttributes;\n\tfor (var attr in diff) {\n\t\tif (_.isEqual(old[attr], (val = diff[attr]))) continue;\n\t\t(changed || (changed = {}))[attr] = val;\n\t}\n\treturn changed;\n\t},\n\n\t// Get the previous value of an attribute, recorded at the time the last\n\t// `\"change\"` event was fired.\n\tprevious: function(attr) {\n\tif (!arguments.length || !this._previousAttributes) return null;\n\treturn this._previousAttributes[attr];\n\t},\n\n\t// Get all of the attributes of the model at the time of the previous\n\t// `\"change\"` event.\n\tpreviousAttributes: function() {\n\treturn _.clone(this._previousAttributes);\n\t},\n\n\t// Check if the model is currently in a valid state. It's only possible to\n\t// get into an *invalid* state if you're using silent changes.\n\tisValid: function() {\n\treturn !this.validate(this.attributes);\n\t},\n\n\t// Run validation against the next complete set of model attributes,\n\t// returning `true` if all is well. If a specific `error` callback has\n\t// been passed, call that instead of firing the general `\"error\"` event.\n\t_validate: function(attrs, options) {\n\tif (options.silent || !this.validate) return true;\n\tattrs = _.extend({}, this.attributes, attrs);\n\tvar error = this.validate(attrs, options);\n\tif (!error) return true;\n\tif (options && options.error) {\n\t\toptions.error(this, error, options);\n\t} else {\n\t\tthis.trigger('error', this, error, options);\n\t}\n\treturn false;\n\t}\n\n});\n\n// Backbone.Collection\n// -------------------\n\n// Provides a standard collection class for our sets of models, ordered\n// or unordered. If a `comparator` is specified, the Collection will maintain\n// its models in sort order, as they're added and removed.\nvar Collection = Backbone.Collection = function(models, options) {\n\toptions || (options = {});\n\tif (options.model) this.model = options.model;\n\tif (options.comparator) this.comparator = options.comparator;\n\tthis._reset();\n\tthis.initialize.apply(this, arguments);\n\tif (models) this.reset(models, {silent: true, parse: options.parse});\n};\n\n// Define the Collection's inheritable methods.\n_.extend(Collection.prototype, Events, {\n\n\t// The default model for a collection is just a **Backbone.Model**.\n\t// This should be overridden in most cases.\n\tmodel: Model,\n\n\t// Initialize is an empty function by default. Override it with your own\n\t// initialization logic.\n\tinitialize: function(){},\n\n\t// The JSON representation of a Collection is an array of the\n\t// models' attributes.\n\ttoJSON: function(options) {\n\treturn this.map(function(model){ return model.toJSON(options); });\n\t},\n\n\t// Add a model, or list of models to the set. Pass **silent** to avoid\n\t// firing the `add` event for every new model.\n\tadd: function(models, options) {\n\tvar i, index, length, model, cid, id, cids = {}, ids = {}, dups = [];\n\toptions || (options = {});\n\tmodels = _.isArray(models) ? models.slice() : [models];\n\n\t// Begin by turning bare objects into model references, and preventing\n\t// invalid models or duplicate models from being added.\n\tfor (i = 0, length = models.length; i < length; i++) {\n\t\tif (!(model = models[i] = this._prepareModel(models[i], options))) {\n\t\tthrow new Error(\"Can't add an invalid model to a collection\");\n\t\t}\n\t\tcid = model.cid;\n\t\tid = model.id;\n\t\tif (cids[cid] || this._byCid[cid] || ((id != null) && (ids[id] || this._byId[id]))) {\n\t\tdups.push(i);\n\t\tcontinue;\n\t\t}\n\t\tcids[cid] = ids[id] = model;\n\t}\n\n\t// Remove duplicates.\n\ti = dups.length;\n\twhile (i--) {\n\t\tmodels.splice(dups[i], 1);\n\t}\n\n\t// Listen to added models' events, and index models for lookup by\n\t// `id` and by `cid`.\n\tfor (i = 0, length = models.length; i < length; i++) {\n\t\t(model = models[i]).on('all', this._onModelEvent, this);\n\t\tthis._byCid[model.cid] = model;\n\t\tif (model.id != null) this._byId[model.id] = model;\n\t}\n\n\t// Insert models into the collection, re-sorting if needed, and triggering\n\t// `add` events unless silenced.\n\tthis.length += length;\n\tindex = options.at != null ? options.at : this.models.length;\n\tsplice.apply(this.models, [index, 0].concat(models));\n\tif (this.comparator) this.sort({silent: true});\n\tif (options.silent) return this;\n\tfor (i = 0, length = this.models.length; i < length; i++) {\n\t\tif (!cids[(model = this.models[i]).cid]) continue;\n\t\toptions.index = i;\n\t\tmodel.trigger('add', model, this, options);\n\t}\n\treturn this;\n\t},\n\n\t// Remove a model, or a list of models from the set. Pass silent to avoid\n\t// firing the `remove` event for every model removed.\n\tremove: function(models, options) {\n\tvar i, l, index, model;\n\toptions || (options = {});\n\tmodels = _.isArray(models) ? models.slice() : [models];\n\tfor (i = 0, l = models.length; i < l; i++) {\n\t\tmodel = this.getByCid(models[i]) || this.get(models[i]);\n\t\tif (!model) continue;\n\t\tdelete this._byId[model.id];\n\t\tdelete this._byCid[model.cid];\n\t\tindex = this.indexOf(model);\n\t\tthis.models.splice(index, 1);\n\t\tthis.length--;\n\t\tif (!options.silent) {\n\t\toptions.index = index;\n\t\tmodel.trigger('remove', model, this, options);\n\t\t}\n\t\tthis._removeReference(model);\n\t}\n\treturn this;\n\t},\n\n\t// Add a model to the end of the collection.\n\tpush: function(model, options) {\n\tmodel = this._prepareModel(model, options);\n\tthis.add(model, options);\n\treturn model;\n\t},\n\n\t// Remove a model from the end of the collection.\n\tpop: function(options) {\n\tvar model = this.at(this.length - 1);\n\tthis.remove(model, options);\n\treturn model;\n\t},\n\n\t// Add a model to the beginning of the collection.\n\tunshift: function(model, options) {\n\tmodel = this._prepareModel(model, options);\n\tthis.add(model, _.extend({at: 0}, options));\n\treturn model;\n\t},\n\n\t// Remove a model from the beginning of the collection.\n\tshift: function(options) {\n\tvar model = this.at(0);\n\tthis.remove(model, options);\n\treturn model;\n\t},\n\n\t// Get a model from the set by id.\n\tget: function(id) {\n\tif (id == null) return void 0;\n\treturn this._byId[id.id != null ? id.id : id];\n\t},\n\n\t// Get a model from the set by client id.\n\tgetByCid: function(cid) {\n\treturn cid && this._byCid[cid.cid || cid];\n\t},\n\n\t// Get the model at the given index.\n\tat: function(index) {\n\treturn this.models[index];\n\t},\n\n\t// Return models with matching attributes. Useful for simple cases of `filter`.\n\twhere: function(attrs) {\n\tif (_.isEmpty(attrs)) return [];\n\treturn this.filter(function(model) {\n\t\tfor (var key in attrs) {\n\t\tif (attrs[key] !== model.get(key)) return false;\n\t\t}\n\t\treturn true;\n\t});\n\t},\n\n\t// Force the collection to re-sort itself. You don't need to call this under\n\t// normal circumstances, as the set will maintain sort order as each item\n\t// is added.\n\tsort: function(options) {\n\toptions || (options = {});\n\tif (!this.comparator) throw new Error('Cannot sort a set without a comparator');\n\tvar boundComparator = _.bind(this.comparator, this);\n\tif (this.comparator.length == 1) {\n\t\tthis.models = this.sortBy(boundComparator);\n\t} else {\n\t\tthis.models.sort(boundComparator);\n\t}\n\tif (!options.silent) this.trigger('reset', this, options);\n\treturn this;\n\t},\n\n\t// Pluck an attribute from each model in the collection.\n\tpluck: function(attr) {\n\treturn _.map(this.models, function(model){ return model.get(attr); });\n\t},\n\n\t// When you have more items than you want to add or remove individually,\n\t// you can reset the entire set with a new list of models, without firing\n\t// any `add` or `remove` events. Fires `reset` when finished.\n\treset: function(models, options) {\n\tmodels  || (models = []);\n\toptions || (options = {});\n\tfor (var i = 0, l = this.models.length; i < l; i++) {\n\t\tthis._removeReference(this.models[i]);\n\t}\n\tthis._reset();\n\tthis.add(models, _.extend({silent: true}, options));\n\tif (!options.silent) this.trigger('reset', this, options);\n\treturn this;\n\t},\n\n\t// Fetch the default set of models for this collection, resetting the\n\t// collection when they arrive. If `add: true` is passed, appends the\n\t// models to the collection instead of resetting.\n\tfetch: function(options) {\n\toptions = options ? _.clone(options) : {};\n\tif (options.parse === undefined) options.parse = true;\n\tvar collection = this;\n\tvar success = options.success;\n\toptions.success = function(resp, status, xhr) {\n\t\tcollection[options.add ? 'add' : 'reset'](collection.parse(resp, xhr), options);\n\t\tif (success) success(collection, resp);\n\t};\n\toptions.error = Backbone.wrapError(options.error, collection, options);\n\treturn (this.sync || Backbone.sync).call(this, 'read', this, options);\n\t},\n\n\t// Create a new instance of a model in this collection. Add the model to the\n\t// collection immediately, unless `wait: true` is passed, in which case we\n\t// wait for the server to agree.\n\tcreate: function(model, options) {\n\tvar coll = this;\n\toptions = options ? _.clone(options) : {};\n\tmodel = this._prepareModel(model, options);\n\tif (!model) return false;\n\tif (!options.wait) coll.add(model, options);\n\tvar success = options.success;\n\toptions.success = function(nextModel, resp, xhr) {\n\t\tif (options.wait) coll.add(nextModel, options);\n\t\tif (success) {\n\t\tsuccess(nextModel, resp);\n\t\t} else {\n\t\tnextModel.trigger('sync', model, resp, options);\n\t\t}\n\t};\n\tmodel.save(null, options);\n\treturn model;\n\t},\n\n\t// **parse** converts a response into a list of models to be added to the\n\t// collection. The default implementation is just to pass it through.\n\tparse: function(resp, xhr) {\n\treturn resp;\n\t},\n\n\t// Proxy to _'s chain. Can't be proxied the same way the rest of the\n\t// underscore methods are proxied because it relies on the underscore\n\t// constructor.\n\tchain: function () {\n\treturn _(this.models).chain();\n\t},\n\n\t// Reset all internal state. Called when the collection is reset.\n\t_reset: function(options) {\n\tthis.length = 0;\n\tthis.models = [];\n\tthis._byId  = {};\n\tthis._byCid = {};\n\t},\n\n\t// Prepare a model or hash of attributes to be added to this collection.\n\t_prepareModel: function(model, options) {\n\toptions || (options = {});\n\tif (!(model instanceof Model)) {\n\t\tvar attrs = model;\n\t\toptions.collection = this;\n\t\tmodel = new this.model(attrs, options);\n\t\tif (!model._validate(model.attributes, options)) model = false;\n\t} else if (!model.collection) {\n\t\tmodel.collection = this;\n\t}\n\treturn model;\n\t},\n\n\t// Internal method to remove a model's ties to a collection.\n\t_removeReference: function(model) {\n\tif (this == model.collection) {\n\t\tdelete model.collection;\n\t}\n\tmodel.off('all', this._onModelEvent, this);\n\t},\n\n\t// Internal method called every time a model in the set fires an event.\n\t// Sets need to update their indexes when models change ids. All other\n\t// events simply proxy through. \"add\" and \"remove\" events that originate\n\t// in other collections are ignored.\n\t_onModelEvent: function(event, model, collection, options) {\n\tif ((event == 'add' || event == 'remove') && collection != this) return;\n\tif (event == 'destroy') {\n\t\tthis.remove(model, options);\n\t}\n\tif (model && event === 'change:' + model.idAttribute) {\n\t\tdelete this._byId[model.previous(model.idAttribute)];\n\t\tthis._byId[model.id] = model;\n\t}\n\tthis.trigger.apply(this, arguments);\n\t}\n\n});\n\n// Underscore methods that we want to implement on the Collection.\nvar methods = ['forEach', 'each', 'map', 'reduce', 'reduceRight', 'find',\n\t'detect', 'filter', 'select', 'reject', 'every', 'all', 'some', 'any',\n\t'include', 'contains', 'invoke', 'max', 'min', 'sortBy', 'sortedIndex',\n\t'toArray', 'size', 'first', 'initial', 'rest', 'last', 'without', 'indexOf',\n\t'shuffle', 'lastIndexOf', 'isEmpty', 'groupBy'];\n\n// Mix in each Underscore method as a proxy to `Collection#models`.\n_.each(methods, function(method) {\n\tCollection.prototype[method] = function() {\n\treturn _[method].apply(_, [this.models].concat(_.toArray(arguments)));\n\t};\n});\n\n// Backbone.Router\n// -------------------\n\n// Routers map faux-URLs to actions, and fire events when routes are\n// matched. Creating a new one sets its `routes` hash, if not set statically.\nvar Router = Backbone.Router = function(options) {\n\toptions || (options = {});\n\tif (options.routes) this.routes = options.routes;\n\tthis._bindRoutes();\n\tthis.initialize.apply(this, arguments);\n};\n\n// Cached regular expressions for matching named param parts and splatted\n// parts of route strings.\nvar namedParam    = /:\\w+/g;\nvar splatParam    = /\\*\\w+/g;\nvar escapeRegExp  = /[-[\\]{}()+?.,\\\\^$|#\\s]/g;\n\n// Set up all inheritable **Backbone.Router** properties and methods.\n_.extend(Router.prototype, Events, {\n\n\t// Initialize is an empty function by default. Override it with your own\n\t// initialization logic.\n\tinitialize: function(){},\n\n\t// Manually bind a single named route to a callback. For example:\n\t//\n\t//     this.route('search/:query/p:num', 'search', function(query, num) {\n\t//       ...\n\t//     });\n\t//\n\troute: function(route, name, callback) {\n\tBackbone.history || (Backbone.history = new History);\n\tif (!_.isRegExp(route)) route = this._routeToRegExp(route);\n\tif (!callback) callback = this[name];\n\tBackbone.history.route(route, _.bind(function(fragment) {\n\t\tvar args = this._extractParameters(route, fragment);\n\t\tcallback && callback.apply(this, args);\n\t\tthis.trigger.apply(this, ['route:' + name].concat(args));\n\t\tBackbone.history.trigger('route', this, name, args);\n\t}, this));\n\treturn this;\n\t},\n\n\t// Simple proxy to `Backbone.history` to save a fragment into the history.\n\tnavigate: function(fragment, options) {\n\tBackbone.history.navigate(fragment, options);\n\t},\n\n\t// Bind all defined routes to `Backbone.history`. We have to reverse the\n\t// order of the routes here to support behavior where the most general\n\t// routes can be defined at the bottom of the route map.\n\t_bindRoutes: function() {\n\tif (!this.routes) return;\n\tvar routes = [];\n\tfor (var route in this.routes) {\n\t\troutes.unshift([route, this.routes[route]]);\n\t}\n\tfor (var i = 0, l = routes.length; i < l; i++) {\n\t\tthis.route(routes[i][0], routes[i][1], this[routes[i][1]]);\n\t}\n\t},\n\n\t// Convert a route string into a regular expression, suitable for matching\n\t// against the current location hash.\n\t_routeToRegExp: function(route) {\n\troute = route.replace(escapeRegExp, '\\\\$&')\n\t\t\t\t.replace(namedParam, '([^\\/]+)')\n\t\t\t\t.replace(splatParam, '(.*?)');\n\treturn new RegExp('^' + route + '$');\n\t},\n\n\t// Given a route, and a URL fragment that it matches, return the array of\n\t// extracted parameters.\n\t_extractParameters: function(route, fragment) {\n\treturn route.exec(fragment).slice(1);\n\t}\n\n});\n\n// Backbone.History\n// ----------------\n\n// Handles cross-browser history management, based on URL fragments. If the\n// browser does not support `onhashchange`, falls back to polling.\nvar History = Backbone.History = function() {\n\tthis.handlers = [];\n\t_.bindAll(this, 'checkUrl');\n};\n\n// Cached regex for cleaning leading hashes and slashes .\nvar routeStripper = /^[#\\/]/;\n\n// Cached regex for detecting MSIE.\nvar isExplorer = /msie [\\w.]+/;\n\n// Has the history handling already been started?\nHistory.started = false;\n\n// Set up all inheritable **Backbone.History** properties and methods.\n_.extend(History.prototype, Events, {\n\n\t// The default interval to poll for hash changes, if necessary, is\n\t// twenty times a second.\n\tinterval: 50,\n\n\t// Gets the true hash value. Cannot use location.hash directly due to bug\n\t// in Firefox where location.hash will always be decoded.\n\tgetHash: function(windowOverride) {\n\tvar loc = windowOverride ? windowOverride.location : window.location;\n\tvar match = loc.href.match(/#(.*)$/);\n\treturn match ? match[1] : '';\n\t},\n\n\t// Get the cross-browser normalized URL fragment, either from the URL,\n\t// the hash, or the override.\n\tgetFragment: function(fragment, forcePushState) {\n\tif (fragment == null) {\n\t\tif (this._hasPushState || forcePushState) {\n\t\tfragment = window.location.pathname;\n\t\tvar search = window.location.search;\n\t\tif (search) fragment += search;\n\t\t} else {\n\t\tfragment = this.getHash();\n\t\t}\n\t}\n\tif (!fragment.indexOf(this.options.root)) fragment = fragment.substr(this.options.root.length);\n\treturn fragment.replace(routeStripper, '');\n\t},\n\n\t// Start the hash change handling, returning `true` if the current URL matches\n\t// an existing route, and `false` otherwise.\n\tstart: function(options) {\n\tif (History.started) throw new Error(\"Backbone.history has already been started\");\n\tHistory.started = true;\n\n\t// Figure out the initial configuration. Do we need an iframe?\n\t// Is pushState desired ... is it available?\n\tthis.options          = _.extend({}, {root: '/'}, this.options, options);\n\tthis._wantsHashChange = this.options.hashChange !== false;\n\tthis._wantsPushState  = !!this.options.pushState;\n\tthis._hasPushState    = !!(this.options.pushState && window.history && window.history.pushState);\n\tvar fragment          = this.getFragment();\n\tvar docMode           = document.documentMode;\n\tvar oldIE             = (isExplorer.exec(navigator.userAgent.toLowerCase()) && (!docMode || docMode <= 7));\n\n\tif (oldIE) {\n\t\tthis.iframe = $('<iframe src=\"javascript:0\" tabindex=\"-1\" />').hide().appendTo('body')[0].contentWindow;\n\t\tthis.navigate(fragment);\n\t}\n\n\t// Depending on whether we're using pushState or hashes, and whether\n\t// 'onhashchange' is supported, determine how we check the URL state.\n\tif (this._hasPushState) {\n\t\t$(window).bind('popstate', this.checkUrl);\n\t} else if (this._wantsHashChange && ('onhashchange' in window) && !oldIE) {\n\t\t$(window).bind('hashchange', this.checkUrl);\n\t} else if (this._wantsHashChange) {\n\t\tthis._checkUrlInterval = setInterval(this.checkUrl, this.interval);\n\t}\n\n\t// Determine if we need to change the base url, for a pushState link\n\t// opened by a non-pushState browser.\n\tthis.fragment = fragment;\n\tvar loc = window.location;\n\tvar atRoot  = loc.pathname == this.options.root;\n\n\t// If we've started off with a route from a `pushState`-enabled browser,\n\t// but we're currently in a browser that doesn't support it...\n\tif (this._wantsHashChange && this._wantsPushState && !this._hasPushState && !atRoot) {\n\t\tthis.fragment = this.getFragment(null, true);\n\t\twindow.location.replace(this.options.root + '#' + this.fragment);\n\t\t// Return immediately as browser will do redirect to new url\n\t\treturn true;\n\n\t// Or if we've started out with a hash-based route, but we're currently\n\t// in a browser where it could be `pushState`-based instead...\n\t} else if (this._wantsPushState && this._hasPushState && atRoot && loc.hash) {\n\t\tthis.fragment = this.getHash().replace(routeStripper, '');\n\t\twindow.history.replaceState({}, document.title, loc.protocol + '//' + loc.host + this.options.root + this.fragment);\n\t}\n\n\tif (!this.options.silent) {\n\t\treturn this.loadUrl();\n\t}\n\t},\n\n\t// Disable Backbone.history, perhaps temporarily. Not useful in a real app,\n\t// but possibly useful for unit testing Routers.\n\tstop: function() {\n\t$(window).unbind('popstate', this.checkUrl).unbind('hashchange', this.checkUrl);\n\tclearInterval(this._checkUrlInterval);\n\tHistory.started = false;\n\t},\n\n\t// Add a route to be tested when the fragment changes. Routes added later\n\t// may override previous routes.\n\troute: function(route, callback) {\n\tthis.handlers.unshift({route: route, callback: callback});\n\t},\n\n\t// Checks the current URL to see if it has changed, and if it has,\n\t// calls `loadUrl`, normalizing across the hidden iframe.\n\tcheckUrl: function(e) {\n\tvar current = this.getFragment();\n\tif (current == this.fragment && this.iframe) current = this.getFragment(this.getHash(this.iframe));\n\tif (current == this.fragment) return false;\n\tif (this.iframe) this.navigate(current);\n\tthis.loadUrl() || this.loadUrl(this.getHash());\n\t},\n\n\t// Attempt to load the current URL fragment. If a route succeeds with a\n\t// match, returns `true`. If no defined routes matches the fragment,\n\t// returns `false`.\n\tloadUrl: function(fragmentOverride) {\n\tvar fragment = this.fragment = this.getFragment(fragmentOverride);\n\tvar matched = _.any(this.handlers, function(handler) {\n\t\tif (handler.route.test(fragment)) {\n\t\thandler.callback(fragment);\n\t\treturn true;\n\t\t}\n\t});\n\treturn matched;\n\t},\n\n\t// Save a fragment into the hash history, or replace the URL state if the\n\t// 'replace' option is passed. You are responsible for properly URL-encoding\n\t// the fragment in advance.\n\t//\n\t// The options object can contain `trigger: true` if you wish to have the\n\t// route callback be fired (not usually desirable), or `replace: true`, if\n\t// you wish to modify the current URL without adding an entry to the history.\n\tnavigate: function(fragment, options) {\n\tif (!History.started) return false;\n\tif (!options || options === true) options = {trigger: options};\n\tvar frag = (fragment || '').replace(routeStripper, '');\n\tif (this.fragment == frag) return;\n\n\t// If pushState is available, we use it to set the fragment as a real URL.\n\tif (this._hasPushState) {\n\t\tif (frag.indexOf(this.options.root) != 0) frag = this.options.root + frag;\n\t\tthis.fragment = frag;\n\t\twindow.history[options.replace ? 'replaceState' : 'pushState']({}, document.title, frag);\n\n\t// If hash changes haven't been explicitly disabled, update the hash\n\t// fragment to store history.\n\t} else if (this._wantsHashChange) {\n\t\tthis.fragment = frag;\n\t\tthis._updateHash(window.location, frag, options.replace);\n\t\tif (this.iframe && (frag != this.getFragment(this.getHash(this.iframe)))) {\n\t\t// Opening and closing the iframe tricks IE7 and earlier to push a history entry on hash-tag change.\n\t\t// When replace is true, we don't want this.\n\t\tif(!options.replace) this.iframe.document.open().close();\n\t\tthis._updateHash(this.iframe.location, frag, options.replace);\n\t\t}\n\n\t// If you've told us that you explicitly don't want fallback hashchange-\n\t// based history, then `navigate` becomes a page refresh.\n\t} else {\n\t\twindow.location.assign(this.options.root + fragment);\n\t}\n\tif (options.trigger) this.loadUrl(fragment);\n\t},\n\n\t// Update the hash location, either replacing the current entry, or adding\n\t// a new one to the browser history.\n\t_updateHash: function(location, fragment, replace) {\n\tif (replace) {\n\t\tlocation.replace(location.toString().replace(/(javascript:|#).*$/, '') + '#' + fragment);\n\t} else {\n\t\tlocation.hash = fragment;\n\t}\n\t}\n});\n\n// Backbone.View\n// -------------\n\n// Creating a Backbone.View creates its initial element outside of the DOM,\n// if an existing element is not provided...\nvar View = Backbone.View = function(options) {\n\tthis.cid = _.uniqueId('view');\n\tthis._configure(options || {});\n\tthis._ensureElement();\n\tthis.initialize.apply(this, arguments);\n\tthis.delegateEvents();\n};\n\n// Cached regex to split keys for `delegate`.\nvar delegateEventSplitter = /^(\\S+)\\s*(.*)$/;\n\n// List of view options to be merged as properties.\nvar viewOptions = ['model', 'collection', 'el', 'id', 'attributes', 'className', 'tagName'];\n\n// Set up all inheritable **Backbone.View** properties and methods.\n_.extend(View.prototype, Events, {\n\n\t// The default `tagName` of a View's element is `\"div\"`.\n\ttagName: 'div',\n\n\t// jQuery delegate for element lookup, scoped to DOM elements within the\n\t// current view. This should be prefered to global lookups where possible.\n\t$: function(selector) {\n\treturn this.$el.find(selector);\n\t},\n\n\t// Initialize is an empty function by default. Override it with your own\n\t// initialization logic.\n\tinitialize: function(){},\n\n\t// **render** is the core function that your view should override, in order\n\t// to populate its element (`this.el`), with the appropriate HTML. The\n\t// convention is for **render** to always return `this`.\n\trender: function() {\n\treturn this;\n\t},\n\n\t// Remove this view from the DOM. Note that the view isn't present in the\n\t// DOM by default, so calling this method may be a no-op.\n\tremove: function() {\n\tthis.$el.remove();\n\treturn this;\n\t},\n\n\t// For small amounts of DOM Elements, where a full-blown template isn't\n\t// needed, use **make** to manufacture elements, one at a time.\n\t//\n\t//     var el = this.make('li', {'class': 'row'}, this.model.escape('title'));\n\t//\n\tmake: function(tagName, attributes, content) {\n\tvar el = document.createElement(tagName);\n\tif (attributes) $(el).attr(attributes);\n\tif (content) $(el).html(content);\n\treturn el;\n\t},\n\n\t// Change the view's element (`this.el` property), including event\n\t// re-delegation.\n\tsetElement: function(element, delegate) {\n\tif (this.$el) this.undelegateEvents();\n\tthis.$el = (element instanceof $) ? element : $(element);\n\tthis.el = this.$el[0];\n\tif (delegate !== false) this.delegateEvents();\n\treturn this;\n\t},\n\n\t// Set callbacks, where `this.events` is a hash of\n\t//\n\t// *{\"event selector\": \"callback\"}*\n\t//\n\t//     {\n\t//       'mousedown .title':  'edit',\n\t//       'click .button':     'save'\n\t//       'click .open':       function(e) { ... }\n\t//     }\n\t//\n\t// pairs. Callbacks will be bound to the view, with `this` set properly.\n\t// Uses event delegation for efficiency.\n\t// Omitting the selector binds the event to `this.el`.\n\t// This only works for delegate-able events: not `focus`, `blur`, and\n\t// not `change`, `submit`, and `reset` in Internet Explorer.\n\tdelegateEvents: function(events) {\n\tif (!(events || (events = getValue(this, 'events')))) return;\n\tthis.undelegateEvents();\n\tfor (var key in events) {\n\t\tvar method = events[key];\n\t\tif (!_.isFunction(method)) method = this[events[key]];\n\t\tif (!method) throw new Error('Method \"' + events[key] + '\" does not exist');\n\t\tvar match = key.match(delegateEventSplitter);\n\t\tvar eventName = match[1], selector = match[2];\n\t\tmethod = _.bind(method, this);\n\t\teventName += '.delegateEvents' + this.cid;\n\t\tif (selector === '') {\n\t\tthis.$el.bind(eventName, method);\n\t\t} else {\n\t\tthis.$el.delegate(selector, eventName, method);\n\t\t}\n\t}\n\t},\n\n\t// Clears all callbacks previously bound to the view with `delegateEvents`.\n\t// You usually don't need to use this, but may wish to if you have multiple\n\t// Backbone views attached to the same DOM element.\n\tundelegateEvents: function() {\n\tthis.$el.unbind('.delegateEvents' + this.cid);\n\t},\n\n\t// Performs the initial configuration of a View with a set of options.\n\t// Keys with special meaning *(model, collection, id, className)*, are\n\t// attached directly to the view.\n\t_configure: function(options) {\n\tif (this.options) options = _.extend({}, this.options, options);\n\tfor (var i = 0, l = viewOptions.length; i < l; i++) {\n\t\tvar attr = viewOptions[i];\n\t\tif (options[attr]) this[attr] = options[attr];\n\t}\n\tthis.options = options;\n\t},\n\n\t// Ensure that the View has a DOM element to render into.\n\t// If `this.el` is a string, pass it through `$()`, take the first\n\t// matching element, and re-assign it to `el`. Otherwise, create\n\t// an element from the `id`, `className` and `tagName` properties.\n\t_ensureElement: function() {\n\tif (!this.el) {\n\t\tvar attrs = getValue(this, 'attributes') || {};\n\t\tif (this.id) attrs.id = this.id;\n\t\tif (this.className) attrs['class'] = this.className;\n\t\tthis.setElement(this.make(this.tagName, attrs), false);\n\t} else {\n\t\tthis.setElement(this.el, false);\n\t}\n\t}\n\n});\n\n// The self-propagating extend function that Backbone classes use.\nvar extend = function (protoProps, classProps) {\n\tvar child = inherits(this, protoProps, classProps);\n\tchild.extend = this.extend;\n\treturn child;\n};\n\n// Set up inheritance for the model, collection, and view.\nModel.extend = Collection.extend = Router.extend = View.extend = extend;\n\n// Backbone.sync\n// -------------\n\n// Map from CRUD to HTTP for our default `Backbone.sync` implementation.\nvar methodMap = {\n\t'create': 'POST',\n\t'update': 'PUT',\n\t'delete': 'DELETE',\n\t'read':   'GET'\n};\n\n// Override this function to change the manner in which Backbone persists\n// models to the server. You will be passed the type of request, and the\n// model in question. By default, makes a RESTful Ajax request\n// to the model's `url()`. Some possible customizations could be:\n//\n// * Use `setTimeout` to batch rapid-fire updates into a single request.\n// * Send up the models as XML instead of JSON.\n// * Persist models via WebSockets instead of Ajax.\n//\n// Turn on `Backbone.emulateHTTP` in order to send `PUT` and `DELETE` requests\n// as `POST`, with a `_method` parameter containing the true HTTP method,\n// as well as all requests with the body as `application/x-www-form-urlencoded`\n// instead of `application/json` with the model in a param named `model`.\n// Useful when interfacing with server-side languages like **PHP** that make\n// it difficult to read the body of `PUT` requests.\nBackbone.sync = function(method, model, options) {\n\tvar type = methodMap[method];\n\n\t// Default options, unless specified.\n\toptions || (options = {});\n\n\t// Default JSON-request options.\n\tvar params = {type: type, dataType: 'json'};\n\n\t// Ensure that we have a URL.\n\tif (!options.url) {\n\tparams.url = getValue(model, 'url') || urlError();\n\t}\n\n\t// Ensure that we have the appropriate request data.\n\tif (!options.data && model && (method == 'create' || method == 'update')) {\n\tparams.contentType = 'application/json';\n\tparams.data = JSON.stringify(model.toJSON());\n\t}\n\n\t// For older servers, emulate JSON by encoding the request into an HTML-form.\n\tif (Backbone.emulateJSON) {\n\tparams.contentType = 'application/x-www-form-urlencoded';\n\tparams.data = params.data ? {model: params.data} : {};\n\t}\n\n\t// For older servers, emulate HTTP by mimicking the HTTP method with `_method`\n\t// And an `X-HTTP-Method-Override` header.\n\tif (Backbone.emulateHTTP) {\n\tif (type === 'PUT' || type === 'DELETE') {\n\t\tif (Backbone.emulateJSON) params.data._method = type;\n\t\tparams.type = 'POST';\n\t\tparams.beforeSend = function(xhr) {\n\t\txhr.setRequestHeader('X-HTTP-Method-Override', type);\n\t\t};\n\t}\n\t}\n\n\t// Don't process data on a non-GET request.\n\tif (params.type !== 'GET' && !Backbone.emulateJSON) {\n\tparams.processData = false;\n\t}\n\n\t// Make the request, allowing the user to override any Ajax options.\n\treturn $.ajax(_.extend(params, options));\n};\n\n// Wrap an optional error callback with a fallback error event.\nBackbone.wrapError = function(onError, originalModel, options) {\n\treturn function(model, resp) {\n\tresp = model === originalModel ? resp : model;\n\tif (onError) {\n\t\tonError(originalModel, resp, options);\n\t} else {\n\t\toriginalModel.trigger('error', originalModel, resp, options);\n\t}\n\t};\n};\n\n// Helpers\n// -------\n\n// Shared empty constructor function to aid in prototype-chain creation.\nvar ctor = function(){};\n\n// Helper function to correctly set up the prototype chain, for subclasses.\n// Similar to `goog.inherits`, but uses a hash of prototype properties and\n// class properties to be extended.\nvar inherits = function(parent, protoProps, staticProps) {\n\tvar child;\n\n\t// The constructor function for the new subclass is either defined by you\n\t// (the \"constructor\" property in your `extend` definition), or defaulted\n\t// by us to simply call the parent's constructor.\n\tif (protoProps && protoProps.hasOwnProperty('constructor')) {\n\tchild = protoProps.constructor;\n\t} else {\n\tchild = function(){ parent.apply(this, arguments); };\n\t}\n\n\t// Inherit class (static) properties from parent.\n\t_.extend(child, parent);\n\n\t// Set the prototype chain to inherit from `parent`, without calling\n\t// `parent`'s constructor function.\n\tctor.prototype = parent.prototype;\n\tchild.prototype = new ctor();\n\n\t// Add prototype properties (instance properties) to the subclass,\n\t// if supplied.\n\tif (protoProps) _.extend(child.prototype, protoProps);\n\n\t// Add static properties to the constructor function, if supplied.\n\tif (staticProps) _.extend(child, staticProps);\n\n\t// Correctly set child's `prototype.constructor`.\n\tchild.prototype.constructor = child;\n\n\t// Set a convenience property in case the parent's prototype is needed later.\n\tchild.__super__ = parent.prototype;\n\n\treturn child;\n};\n\n// Helper function to get a value from a Backbone object as a property\n// or as a function.\nvar getValue = function(object, prop) {\n\tif (!(object && object[prop])) return null;\n\treturn _.isFunction(object[prop]) ? object[prop]() : object[prop];\n};\n\n// Throw an error when a URL is needed, and none is supplied.\nvar urlError = function() {\n\tthrow new Error('A \"url\" property or function must be specified');\n};\n\n}).call(this);\n\n"]}]}